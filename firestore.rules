rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Helper function to check if the user is the specific admin
    function isAdmin() {
      return request.auth != null && request.auth.token.email == 'braisrd11@gmail.com';
    }

    // Publicly readable content managed by admin
    match /events/{event} {
      allow read: if true;
      allow write: if true; // Temporary fix to allow custom login system to work
    }
    
    match /config/{document} {
      allow read: if true;
      allow write: if true; // Matches events logic for custom login
    }
    
    match /announcements/{announcement} {
      allow read: if true;
      allow write: if true; // Matches events logic
    }

    // Registrations: Everyone can write (to register), only admin can read all
    match /registrations/{registration} {
      allow create: if true;
      allow read, update, delete: if true; // Temporary for custom login
    }
    
    // NEW: Allow public write for FCM tokens (to receive notifications)
    match /fcm_tokens/{token} {
      allow read: if true;
      allow write: if true; // Public can subscribe
    }
    
    // Liga data
    match /players/{player} {
      allow read: if true;
      allow write: if true;
    }
    match /tournaments/{tournament} {
      allow read: if true;
      allow write: if true;
    }
    
    // Liga results (legacy or future)
    match /results/{result} {
      allow read: if true;
      allow write: if true;
    }
    
    // Transfer Market
    match /free_agents/{agent} {
      allow read: if true;
      allow write: if true;
    }
  }
}

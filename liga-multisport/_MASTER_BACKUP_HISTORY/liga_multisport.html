<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIGA MULTISPORT - Paso de Ecuador 25/26</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        celestial: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                            950: '#082f49',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'bounce-slow': 'bounce 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #082f49 100%);
            color: #e0f2fe;
            min-height: 100vh;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(56, 189, 248, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .premium-text {
            background: linear-gradient(to right, #bae6fd, #38bdf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Icons (Inline SVGs to avoid CDN issues) ---
        const IconProto = ({ d, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {d}
            </svg>
        );

        const Trophy = (p) => <IconProto {...p} d={<><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" /><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" /><path d="M4 22h16" /><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" /><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" /><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" /></>} />
        const Users = (p) => <IconProto {...p} d={<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></>} />
        const Shield = (p) => <IconProto {...p} d={<><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /></>} />
        const Lock = (p) => <IconProto {...p} d={<><rect width="18" height="11" x="3" y="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></>} />
        const Unlock = (p) => <IconProto {...p} d={<><rect width="18" height="11" x="3" y="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 9.9-1" /></>} />
        const Plus = (p) => <IconProto {...p} d={<><path d="M5 12h14" /><path d="M12 5v14" /></>} />
        const Trash2 = (p) => <IconProto {...p} d={<><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></>} />
        const Edit2 = (p) => <IconProto {...p} d={<><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" /></>} />
        const Save = (p) => <IconProto {...p} d={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></>} />
        const X = (p) => <IconProto {...p} d={<><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>} />
        const Search = (p) => <IconProto {...p} d={<><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></>} />
        const ChevronDown = (p) => <IconProto {...p} d={<><path d="m6 9 6 6 6-6" /></>} />
        const Info = (p) => <IconProto {...p} d={<><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></>} />
        const History = (p) => <IconProto {...p} d={<><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" /><path d="M3 3v9h9" /><path d="M12 7v5l4 2" /></>} />

        // --- Mock Data / Initial State ---
        const INITIAL_DESCRIPTION = `Se trata de una liga individual en la que daremos 100‚Ç¨ a la persona ganadora al final del curso.
Los puntos se obtienen participando en torneos y gan√°ndolos, siendo los puntos obtenidos:

‚Ä¢ **+1 punto** por participar
‚Ä¢ **+3 puntos** por quedar segundo/a
‚Ä¢ **+5 puntos** por quedar primero/a`;

        const App = () => {
            // State
            const [players, setPlayers] = useState(() => JSON.parse(localStorage.getItem('liga_players')) || []);
            const [tournaments, setTournaments] = useState(() => JSON.parse(localStorage.getItem('liga_tournaments')) || []);
            const [adminMode, setAdminMode] = useState(false);
            const [password, setPassword] = useState(() => localStorage.getItem('liga_password') || "4321");
            const [description, setDescription] = useState(() => localStorage.getItem('liga_description') || INITIAL_DESCRIPTION);

            // UI State
            const [showInfo, setShowInfo] = useState(false);
            const [searchQuery, setSearchQuery] = useState("");
            const [selectedTournamentFilter, setSelectedTournamentFilter] = useState("ALL"); // 'ALL' or tournament ID

            // Admin Forms State
            const [adminPassInput, setAdminPassInput] = useState("");
            const [newPlayerName, setNewPlayerName] = useState("");
            const [isAddingTournament, setIsAddingTournament] = useState(false);
            const [isEditingSettings, setIsEditingSettings] = useState(false);

            // New Tournament Form State
            const [tName, setTName] = useState("");
            const [tParticipants, setTParticipants] = useState(""); // comma separated
            const [tFirst, setTFirst] = useState("");
            const [tSecond, setTSecond] = useState("");

            useEffect(() => {
                localStorage.setItem('liga_players', JSON.stringify(players));
            }, [players]);

            useEffect(() => {
                localStorage.setItem('liga_tournaments', JSON.stringify(tournaments));
            }, [tournaments]);

            useEffect(() => {
                localStorage.setItem('liga_description', description);
            }, [description]);

            useEffect(() => {
                localStorage.setItem('liga_password', password);
            }, [password]);

            // --- Logic ---

            const normalizeName = (name) => name.trim().toLowerCase();

            const findOrAddPlayer = (rawName, currentPlayers) => {
                if (!rawName) return null;
                const norm = normalizeName(rawName);
                let player = currentPlayers.find(p => normalizeName(p.name) === norm);

                if (!player) {
                    player = {
                        id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                        name: rawName.trim(),
                        points: 0,
                        wins: [], // array of timestamps
                        history: []
                    };
                    return { player, isNew: true };
                }
                return { player, isNew: false };
            };

            const handleLogin = () => {
                if (adminPassInput === password) {
                    setAdminMode(true);
                    setAdminPassInput("");
                } else {
                    alert("Contrase√±a incorrecta");
                }
            };

            const handleChangePassword = (oldP, newP) => {
                if (oldP === password) {
                    setPassword(newP);
                    alert("Contrase√±a actualizada correctamente.");
                    setIsEditingSettings(false);
                } else {
                    alert("La contrase√±a actual no es correcta.");
                }
            }

            const handleDeletePlayer = (id) => {
                if (confirm("¬øSeguro que quieres eliminar a este jugador?")) {
                    setPlayers(prev => prev.filter(p => p.id !== id));
                }
            };

            const handleAddPlayer = () => {
                if (!newPlayerName.trim()) return;
                const result = findOrAddPlayer(newPlayerName, players);
                if (result.isNew) {
                    setPlayers(prev => [...prev, result.player]);
                    setNewPlayerName("");
                    alert("Jugador a√±adido");
                } else {
                    alert("Ese jugador ya existe");
                }
            };

            const handleUpdatePoints = (id, delta) => {
                setPlayers(prev => prev.map(p =>
                    p.id === id ? { ...p, points: Math.max(0, p.points + delta) } : p
                ));
            };

            const handleSaveTournament = () => {
                if (!tName || !tFirst) {
                    alert("Debes poner al menos un nombre de torneo y un ganador.");
                    return;
                }

                let tempPlayers = [...players];
                const timestamp = Date.now();
                const newTournament = {
                    id: timestamp.toString(),
                    name: tName,
                    date: new Date().toISOString(),
                    firstPlace: tFirst.trim(),
                    secondPlace: tSecond.trim(),
                    participants: tParticipants.split(',').map(s => s.trim()).filter(Boolean)
                };

                // Helper to process a player update
                const processPlayer = (name, pointsToAdd, isWin) => {
                    const res = findOrAddPlayer(name, tempPlayers);
                    let p = res.player;

                    p.points += pointsToAdd;
                    p.history = p.history || [];
                    p.history.push({ tournament: tName, points: pointsToAdd, date: timestamp });
                    p.wins = p.wins || [];
                    if (isWin) {
                        p.wins.push(timestamp);
                    }

                    if (res.isNew) {
                        tempPlayers.push(p);
                    } else {
                        // Update existing in temp array
                        const idx = tempPlayers.findIndex(pl => pl.id === p.id);
                        tempPlayers[idx] = p;
                    }
                };

                // Logic: 
                // First: +5
                // Second: +3
                // Participants: +1 (ONLY if not first or second)

                // 1. First Place
                processPlayer(tFirst, 5, true);

                // 2. Second Place
                if (tSecond) {
                    if (normalizeName(tSecond) !== normalizeName(tFirst)) {
                        processPlayer(tSecond, 3, false);
                    }
                }

                // 3. Participants
                const winnerNorm = normalizeName(tFirst);
                const secondNorm = tSecond ? normalizeName(tSecond) : "";

                newTournament.participants.forEach(partName => {
                    const pNorm = normalizeName(partName);
                    // Only add participation point if NOT winner and NOT second
                    if (pNorm !== winnerNorm && pNorm !== secondNorm) {
                        processPlayer(partName, 1, false);
                    }
                });

                setPlayers(tempPlayers);
                setTournaments(prev => [newTournament, ...prev]);
                setIsAddingTournament(false);
                setTName(""); setTFirst(""); setTSecond(""); setTParticipants("");
            };

            // --- Computed Data ---

            // Players sorted by: Points (Desc) -> Last Win Timestamp (Desc) -> Name (Asc)
            const sortedPlayers = useMemo(() => {
                let list = [...players];

                // Filtering
                if (searchQuery) {
                    const q = normalizeName(searchQuery);
                    list = list.filter(p => normalizeName(p.name).includes(q));
                }

                return list.sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;

                    // Tie-breaker: Most recent win
                    const lastWinA = a.wins && a.wins.length > 0 ? Math.max(...a.wins) : 0;
                    const lastWinB = b.wins && b.wins.length > 0 ? Math.max(...b.wins) : 0;

                    if (lastWinB !== lastWinA) return lastWinB - lastWinA;

                    return a.name.localeCompare(b.name);
                });
            }, [players, searchQuery]);

            const tournamentResults = useMemo(() => {
                if (selectedTournamentFilter === 'ALL') return null;
                const tourney = tournaments.find(t => t.id === selectedTournamentFilter);
                if (!tourney) return null;

                return tourney;
            }, [selectedTournamentFilter, tournaments]);

            // --- Render Components ---

            const InfoModal = () => (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm" onClick={() => setShowInfo(false)}>
                    <div className="glass-panel p-8 max-w-lg w-full rounded-2xl relative" onClick={e => e.stopPropagation()}>
                        <button onClick={() => setShowInfo(false)} className="absolute top-4 right-4 text-celestial-400 hover:text-white">
                            <X className="w-6 h-6" />
                        </button>
                        <h2 className="text-3xl font-bold mb-6 premium-text flex items-center gap-3">
                            <Info className="w-8 h-8" /> ¬øQu√© es LIGA MULTISPORT?
                        </h2>
                        <div className="prose prose-invert text-celestial-100 whitespace-pre-line leading-relaxed text-lg">
                            {description}
                        </div>
                    </div>
                </div>
            );

            const AdminSettings = () => {
                const [oldP, setOldP] = useState("");
                const [newP, setNewP] = useState("");
                const [descEdit, setDescEdit] = useState(description);

                return (
                    <div className="mt-8 p-6 bg-celestial-900/30 rounded-xl border border-celestial-700/50">
                        <h3 className="text-xl font-bold text-white mb-4 flex gap-2"><Shield className="w-5 h-5" /> Configuraci√≥n Admin</h3>

                        <div className="grid md:grid-cols-2 gap-8">
                            <div>
                                <h4 className="font-semibold text-celestial-300 mb-2">Cambiar Contrase√±a</h4>
                                <input type="password" placeholder="Contrase√±a Actual" className="w-full mb-2 p-2 rounded bg-celestial-950 border border-celestial-700 focus:outline-none focus:border-celestial-400"
                                    value={oldP} onChange={e => setOldP(e.target.value)} />
                                <input type="password" placeholder="Nueva Contrase√±a" className="w-full mb-2 p-2 rounded bg-celestial-950 border border-celestial-700 focus:outline-none focus:border-celestial-400"
                                    value={newP} onChange={e => setNewP(e.target.value)} />
                                <button onClick={() => handleChangePassword(oldP, newP)} className="bg-celestial-600 hover:bg-celestial-500 text-white px-4 py-2 rounded">
                                    Actualizar Contrase√±a
                                </button>
                            </div>

                            <div>
                                <h4 className="font-semibold text-celestial-300 mb-2">Editar Descripci√≥n (Info)</h4>
                                <textarea className="w-full h-32 mb-2 p-2 rounded bg-celestial-950 border border-celestial-700 focus:outline-none focus:border-celestial-400 text-sm"
                                    value={descEdit} onChange={e => setDescEdit(e.target.value)} />
                                <button onClick={() => { setDescription(descEdit); alert("Descripci√≥n guardada"); }} className="bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-2 rounded flex items-center gap-2">
                                    <Save className="w-4 h-4" /> Guardar Texto
                                </button>
                            </div>
                        </div>
                        <button onClick={() => setIsEditingSettings(false)} className="mt-4 text-sm text-celestial-400 hover:text-white underline">Cerrar Configuraci√≥n</button>
                    </div>
                )
            };

            return (
                <div className="min-h-screen font-sans pb-20">
                    {showInfo && <InfoModal />}

                    {/* Header */}
                    <header className="p-6 md:p-8 flex justify-between items-center bg-gradient-to-b from-celestial-950/80 to-transparent sticky top-0 z-40 backdrop-blur-md">
                        <div>
                            <h1 className="text-3xl md:text-5xl font-extrabold tracking-tight text-white mb-1 drop-shadow-lg">
                                LIGA <span className="premium-text">MULTISPORT</span>
                            </h1>
                            <p className="text-celestial-300 text-sm md:text-base tracking-widest uppercase opacity-80">Paso de Ecuador 25/26</p>
                        </div>
                        <div className="flex gap-4">
                            <button
                                onClick={() => setShowInfo(true)}
                                className="group relative p-3 rounded-full bg-celestial-500/10 hover:bg-celestial-500/20 border border-celestial-400/30 transition-all duration-300"
                                title="Informaci√≥n"
                            >
                                <Info className="w-6 h-6 text-celestial-300 group-hover:text-white group-hover:scale-110 transition-transform" />
                                <span className="absolute -bottom-10 right-0 w-max bg-celestial-900/90 px-3 py-1 rounded text-xs hidden group-hover:block">¬øQu√© es esto?</span>
                            </button>
                            <button
                                onClick={() => setAdminMode(!adminMode)}
                                className={`p-3 rounded-full border transition-all duration-300 ${adminMode ? 'bg-red-500/20 border-red-500/50 text-red-300' : 'bg-celestial-500/10 border-celestial-400/30 text-celestial-300'}`}
                                title="Admin Mode"
                            >
                                {adminMode ? <Unlock className="w-6 h-6" /> : <Lock className="w-6 h-6" />}
                            </button>
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto px-4">

                        {/* Admin Login Placeholder/Logic */}
                        {adminMode && !adminPassInput && password !== "4321" && ( /* placeholder */ null)}

                        {/* Admin Panel */}
                        {adminMode && (
                            <div className="glass-panel rounded-2xl p-6 mb-12 animate-fade-in">
                                <div className="flex justify-between items-center mb-6 border-b border-celestial-700/50 pb-4">
                                    <h2 className="text-2xl font-bold text-white flex gap-2 items-center"><Edit2 className="w-6 h-6 text-emerald-400" /> Panel de Control</h2>
                                    <div className="flex gap-2">
                                        <button onClick={() => setIsEditingSettings(!isEditingSettings)} className="text-sm bg-celestial-800 hover:bg-celestial-700 px-3 py-1 rounded">Configuraci√≥n</button>
                                        <button onClick={() => setAdminMode(false)} className="text-sm bg-red-500/20 text-red-300 hover:bg-red-500/40 px-3 py-1 rounded">Salir</button>
                                    </div>
                                </div>

                                {isEditingSettings ? <AdminSettings /> : (
                                    <>
                                        {/* Quick Add Player */}
                                        <div className="flex gap-2 mb-8">
                                            <input
                                                value={newPlayerName}
                                                onChange={(e) => setNewPlayerName(e.target.value)}
                                                placeholder="Nombre del nuevo jugador..."
                                                className="flex-1 bg-celestial-950/50 border border-celestial-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-celestial-400 outline-none transition-all placeholder-celestial-600"
                                            />
                                            <button onClick={handleAddPlayer} className="bg-emerald-600 hover:bg-emerald-500 text-white px-6 rounded-lg font-bold flex items-center gap-2 transition-colors">
                                                <Plus className="w-5 h-5" /> A√±adir
                                            </button>
                                        </div>

                                        {/* Add Tournament Button */}
                                        <button
                                            onClick={() => setIsAddingTournament(!isAddingTournament)}
                                            className="w-full py-4 mb-4 rounded-xl border-2 border-dashed border-celestial-700 hover:border-celestial-400 bg-celestial-900/20 hover:bg-celestial-900/40 text-celestial-300 hover:text-white transition-all flex justify-center items-center gap-2 font-semibold"
                                        >
                                            <Trophy className="w-5 h-5" /> {isAddingTournament ? "Cancelar Torneo" : "Registrar Nuevo Torneo"}
                                        </button>

                                        {isAddingTournament && (
                                            <div className="bg-celestial-900/50 p-6 rounded-xl border border-celestial-600 mb-8">
                                                <div className="grid gap-4">
                                                    <input value={tName} onChange={e => setTName(e.target.value)} placeholder="Nombre del Torneo (ej: Ping Pong)" className="w-full p-3 rounded bg-celestial-950 border border-celestial-700" />
                                                    <div className="grid grid-cols-2 gap-4">
                                                        <div>
                                                            <label className="text-sm text-yellow-400 font-bold mb-1 block">ü•á Ganador (+5)</label>
                                                            <input value={tFirst} onChange={e => setTFirst(e.target.value)} placeholder="Nombre exacto" className="w-full p-3 rounded bg-celestial-950 border border-celestial-700" />
                                                        </div>
                                                        <div>
                                                            <label className="text-sm text-gray-300 font-bold mb-1 block">ü•à Segundo (+3)</label>
                                                            <input value={tSecond} onChange={e => setTSecond(e.target.value)} placeholder="Nombre exacto" className="w-full p-3 rounded bg-celestial-950 border border-celestial-700" />
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <label className="text-sm text-celestial-300 font-bold mb-1 block">Participantes (+1)</label>
                                                        <textarea value={tParticipants} onChange={e => setTParticipants(e.target.value)} placeholder="Nombres separados por comas (ej: Juan, Pepe, Maria...)" className="w-full p-3 rounded bg-celestial-950 border border-celestial-700 h-24" />
                                                        <p className="text-xs text-celestial-400 mt-1">* Si pones al ganador/segundo aqu√≠ tambi√©n, el sistema detectar√° el duplicado y solo sumar√° la puntuaci√≥n m√°s alta.</p>
                                                    </div>
                                                    <button onClick={handleSaveTournament} className="bg-gradient-to-r from-celestial-600 to-emerald-600 hover:from-celestial-500 hover:to-emerald-500 text-white font-bold py-3 rounded shadow-lg transform active:scale-95 transition-all">
                                                        Guardar Torneo y Recalcular
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </>
                                )}
                            </div>
                        )}

                        {!adminMode && (
                            <div className="mb-6" /> // spacer
                        )}

                        {/* Login Modal Overlay for non-admin on protected trigger */}
                        {(!adminMode && !password) && ( /* simple logic */ null)}
                        {!adminMode && adminPassInput !== undefined && false && (null)}

                        {/* Top Filters */}
                        <div className="flex flex-col md:flex-row gap-4 mb-8">
                            <div className="relative flex-1">
                                <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-celestial-500 w-5 h-5" />
                                <input
                                    type="text"
                                    placeholder="Buscar jugador..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    className="w-full pl-12 pr-4 py-4 rounded-xl bg-celestial-900/20 border border-celestial-700/50 focus:border-celestial-400 focus:bg-celestial-900/40 outline-none text-white transition-all shadow-inner"
                                />
                            </div>
                            <div className="relative md:w-64">
                                <select
                                    value={selectedTournamentFilter}
                                    onChange={(e) => setSelectedTournamentFilter(e.target.value)}
                                    className="w-full h-full pl-4 pr-10 py-4 rounded-xl bg-celestial-900/20 border border-celestial-700/50 focus:border-celestial-400 text-celestial-200 outline-none appearance-none cursor-pointer"
                                >
                                    <option value="ALL">Clasificaci√≥n Global</option>
                                    {tournaments.map(t => (
                                        <option key={t.id} value={t.id}>üèÜ {t.name}</option>
                                    ))}
                                </select>
                                <ChevronDown className="absolute right-4 top-1/2 transform -translate-y-1/2 text-celestial-500 w-5 h-5 pointer-events-none" />
                            </div>
                        </div>

                        {/* CONTENT AREA */}
                        {selectedTournamentFilter === 'ALL' ? (
                            /* GLOBAL RANKING VIEW */
                            <div className="space-y-4">
                                {sortedPlayers.length === 0 ? (
                                    <div className="text-center py-20 text-celestial-500 italic">No hay jugadores registrados a√∫n.</div>
                                ) : (
                                    <>
                                        {/* LEADER CARD */}
                                        {!searchQuery && sortedPlayers.length > 0 && (
                                            <div className="relative overflow-hidden rounded-2xl bg-gradient-to-br from-yellow-500/20 to-orange-600/20 border border-yellow-500/30 p-8 flex flex-col md:flex-row items-center justify-between shadow-[0_0_40px_-10px_rgba(234,179,8,0.3)] mb-8 transform hover:scale-[1.01] transition-transform duration-500">
                                                <div className="absolute top-0 right-0 p-32 bg-yellow-500/10 blur-3xl rounded-full -translate-y-1/2 translate-x-1/2"></div>
                                                <div className="flex items-center gap-6 z-10">
                                                    <div className="w-20 h-20 md:w-24 md:h-24 bg-gradient-to-br from-yellow-300 to-yellow-600 rounded-full flex items-center justify-center shadow-lg text-celestial-950">
                                                        <Trophy className="w-10 h-10 md:w-12 md:h-12" fill="currentColor text-current" />
                                                    </div>
                                                    <div>
                                                        <span className="text-yellow-400 font-bold tracking-wider text-sm uppercase mb-1 block">L√≠der Actual</span>
                                                        <h2 className="text-3xl md:text-5xl font-extrabold text-white">{sortedPlayers[0].name}</h2>
                                                        {adminMode && (
                                                            <div className="flex gap-2 mt-2">
                                                                <button onClick={() => handleUpdatePoints(sortedPlayers[0].id, 1)} className="p-1 rounded bg-green-500/20 hover:bg-green-500/40 text-green-300"><Plus size={16} /></button>
                                                                <button onClick={() => handleUpdatePoints(sortedPlayers[0].id, -1)} className="p-1 rounded bg-red-500/20 hover:bg-red-500/40 text-red-300">-</button>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                                <div className="text-center md:text-right mt-6 md:mt-0 z-10 relative">
                                                    <span className="text-6xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-b from-white to-yellow-200 drop-shadow-sm">
                                                        {sortedPlayers[0].points}
                                                    </span>
                                                    <span className="block text-celestial-200 font-medium">PUNTOS TOTALES</span>
                                                </div>
                                            </div>
                                        )}

                                        {/* TABLE */}
                                        <div className="glass-panel rounded-2xl overflow-hidden">
                                            <table className="w-full text-left">
                                                <thead className="bg-celestial-900/50 text-celestial-300 text-xs uppercase tracking-wider">
                                                    <tr>
                                                        <th className="p-6 font-semibold">Pos</th>
                                                        <th className="p-6 font-semibold w-full">Jugador</th>
                                                        <th className="p-6 font-semibold text-right">Puntos</th>
                                                        {adminMode && <th className="p-6 text-right">Acciones</th>}
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-celestial-700/30">
                                                    {sortedPlayers.map((player, index) => {
                                                        const isLeader = index === 0 && !searchQuery;
                                                        if (isLeader) return null; // Skip leader in list if showing banner
                                                        // Fix rank calculation if skipping
                                                        const rank = searchQuery ? index + 1 : index + 1;

                                                        return (
                                                            <tr key={player.id} className="hover:bg-celestial-500/5 transition-colors group">
                                                                <td className="p-6">
                                                                    <span className={`w-8 h-8 flex items-center justify-center rounded-full font-bold text-sm ${rank === 2 ? 'bg-slate-300 text-slate-900' : rank === 3 ? 'bg-orange-700 text-orange-100' : 'bg-celestial-900 text-celestial-400'}`}>
                                                                        {rank}
                                                                    </span>
                                                                </td>
                                                                <td className="p-6">
                                                                    <span className="font-semibold text-lg text-white group-hover:text-celestial-200 transition-colors">{player.name}</span>
                                                                </td>
                                                                <td className="p-6 text-right">
                                                                    <span className="font-bold text-xl text-celestial-50">{player.points}</span>
                                                                </td>
                                                                {adminMode && (
                                                                    <td className="p-6 text-right">
                                                                        <div className="flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                                                            <button onClick={() => handleUpdatePoints(player.id, 1)} className="p-2 rounded hover:bg-celestial-600 text-celestial-300 hover:text-white" title="+1 Punto"><Plus className="w-4 h-4" /></button>
                                                                            <button onClick={() => handleUpdatePoints(player.id, -1)} className="p-2 rounded hover:bg-celestial-600 text-celestial-300 hover:text-white" title="-1 Punto">-</button>
                                                                            <button onClick={() => handleDeletePlayer(player.id)} className="p-2 rounded hover:bg-red-900/50 text-red-400 hover:text-red-200" title="Eliminar"><Trash2 className="w-4 h-4" /></button>
                                                                        </div>
                                                                    </td>
                                                                )}
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                        </div>
                                    </>
                                )}
                            </div>
                        ) : (
                            /* TOURNAMENT SPECIFIC VIEW */
                            <div className="space-y-6 animate-fade-in">
                                {tournamentResults && (
                                    <>
                                        <div className="glass-panel p-8 rounded-2xl border-l-4 border-celestial-400">
                                            <div className="flex justify-between items-start">
                                                <div>
                                                    <h3 className="text-celestial-400 uppercase tracking-widest text-sm font-bold mb-2">Resultados del Torneo</h3>
                                                    <h2 className="text-4xl font-extrabold text-white mb-4">{tournamentResults.name}</h2>
                                                    <p className="text-celestial-300 text-sm flex items-center gap-2"><History className="w-4 h-4" /> Celebrado el: {new Date(tournamentResults.date).toLocaleDateString()}</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid md:grid-cols-3 gap-6">
                                            {/* Winner Card */}
                                            <div className="col-span-3 md:col-span-1 bg-gradient-to-b from-yellow-500/20 to-transparent p-6 rounded-2xl border border-yellow-500/30 flex flex-col items-center justify-center text-center">
                                                <Trophy className="w-16 h-16 text-yellow-400 mb-4 animate-bounce-slow" />
                                                <h3 className="text-xl font-bold text-white mb-1">{tournamentResults.firstPlace}</h3>
                                                <span className="px-3 py-1 bg-yellow-500/20 text-yellow-300 text-xs font-bold rounded-full uppercase">Ganador (+5)</span>
                                            </div>

                                            {/* Second Place */}
                                            {tournamentResults.secondPlace && (
                                                <div className="col-span-3 md:col-span-1 bg-gradient-to-b from-slate-400/20 to-transparent p-6 rounded-2xl border border-slate-400/30 flex flex-col items-center justify-center text-center">
                                                    <div className="w-12 h-12 rounded-full bg-slate-400/20 flex items-center justify-center mb-4 text-slate-200 font-bold text-xl">2</div>
                                                    <h3 className="text-xl font-bold text-white mb-1">{tournamentResults.secondPlace}</h3>
                                                    <span className="px-3 py-1 bg-slate-400/20 text-slate-300 text-xs font-bold rounded-full uppercase">Finalista (+3)</span>
                                                </div>
                                            )}
                                        </div>

                                        {/* Participants List */}
                                        <div className="glass-panel p-6 rounded-2xl">
                                            <h4 className="text-celestial-300 font-bold mb-4 flex items-center gap-2"><Users className="w-5 h-5" /> Otros Participantes (+1)</h4>
                                            <div className="flex flex-wrap gap-2">
                                                {tournamentResults.participants.map((p, i) => (
                                                    (normalizeName(p) !== normalizeName(tournamentResults.firstPlace) && normalizeName(p) !== normalizeName(tournamentResults.secondPlace || "")) && (
                                                        <span key={i} className="px-3 py-2 bg-celestial-900/50 rounded-lg text-celestial-100 text-sm border border-celestial-700/50">
                                                            {p}
                                                        </span>
                                                    )
                                                ))}
                                            </div>
                                        </div>
                                    </>
                                )}
                            </div>
                        )}

                        {/* Admin Login Modal Logic for footer */}
                        {!adminMode && (
                            <div className="mt-20 text-center opacity-30 hover:opacity-100 transition-opacity">
                                <form onSubmit={(e) => { e.preventDefault(); handleLogin(); }}>
                                    <input
                                        type="password"
                                        placeholder="Acceso Admin..."
                                        className="bg-transparent border-b border-celestial-700 text-center focus:outline-none text-xs text-celestial-400"
                                        value={adminPassInput}
                                        onChange={e => setAdminPassInput(e.target.value)}
                                    />
                                </form>
                            </div>
                        )}

                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
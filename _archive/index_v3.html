<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paso de Ecuador 25/26 - INEF</title>

    <!-- Tailwind CSS v3 (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: '#0a0a0f',
                        card: '#13131f',
                        celestial: '#38bdf8',
                        celestialDark: '#0284c7',
                        ligaPrimary: '#6366f1',
                        ligaSecondary: '#ec4899',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, limit, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCmuNrhWE8Aw24_qUK23Qo4u_W5M6cAFN4",
            authDomain: "liga-multisport.firebaseapp.com",
            projectId: "liga-multisport",
            storageBucket: "liga-multisport.firebasestorage.app",
            messagingSenderId: "983340811794",
            appId: "1:983340811794:web:a86d9e3dbb620accebbacb",
            measurementId: "G-TPNXY1LNX9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.db = db;
        window.collection = collection;
        window.addDoc = addDoc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.doc = doc;
        window.getDoc = getDoc;
        window.setDoc = setDoc;
        window.onSnapshot = onSnapshot;
        window.query = query;
        window.orderBy = orderBy;
        window.limit = limit; // FIXED: Added limit
        console.log("Firebase Initialized");
    </script>

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Outfit:wght@300;500;700;900&display=swap"
        rel="stylesheet">

    <style>
        body {
            background-color: #0a0a0f;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Outfit', sans-serif;
        }

        .bg-celestial {
            background: radial-gradient(circle at 50% 0%, rgba(56, 189, 248, 0.15) 0%, transparent 60%), radial-gradient(circle at 10% 80%, rgba(56, 189, 248, 0.05) 0%, transparent 50%);
        }

        .glass-panel {
            background: rgba(19, 19, 31, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .clip-diagonal {
            clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0a0f;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.5, 0, 0, 1);
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>

<body class="bg-celestial">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const HOLIDAYS = [
            { date: '2025-01-01', name: 'AÃ±o Nuevo' }, { date: '2025-01-06', name: 'Reyes' },
            { date: '2025-04-18', name: 'Viernes Santo' }, { date: '2025-05-01', name: 'DÃ­a del Trabajo' },
            { date: '2025-08-15', name: 'AsunciÃ³n' }, { date: '2025-10-12', name: 'Fiesta Nacional' },
            { date: '2025-11-01', name: 'Todos los Santos' }, { date: '2025-12-06', name: 'ConstituciÃ³n' },
            { date: '2025-12-08', name: 'Inmaculada' }, { date: '2025-12-25', name: 'Navidad' }
        ];

        const DEFAULT_EVENT_TYPES = [
            { id: 'party', name: 'Fiesta', color: '#ec4899', icon: 'ðŸŽ‰' },
            { id: 'tournament', name: 'Torneo', color: '#f59e0b', icon: 'ðŸ†' },
            { id: 'tickets', name: 'Entradas', color: '#8b5cf6', icon: 'ðŸŽ«' },
            { id: 'special', name: 'Evento Especial', color: '#10b981', icon: 'â­' }
        ];

        const Icon = ({ d, className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{d}</svg>;
        // Restore React.Fragment usage for icons
        const CalendarIcon = (p) => <Icon {...p} d={<React.Fragment><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></React.Fragment>} />;
        const MapPin = (p) => <Icon {...p} d={<React.Fragment><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></React.Fragment>} />;
        const Lock = (p) => <Icon {...p} d={<React.Fragment><rect width="18" height="11" x="3" y="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></React.Fragment>} />;
        const Trash = (p) => <Icon {...p} d={<React.Fragment><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /></React.Fragment>} />;
        const ExternalLink = (p) => <Icon {...p} d={<React.Fragment><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" x2="21" y1="14" y2="3" /></React.Fragment>} />;
        const Checks = (p) => <Icon {...p} d={<React.Fragment><path d="M18 6 7 17l-5-5" /><path d="m22 10-7.5 7.5L13 16" /></React.Fragment>} />;
        const ChevronLeft = (p) => <Icon {...p} d={<path d="m15 18-6-6 6-6" />} />;
        const ChevronRight = (p) => <Icon {...p} d={<path d="m9 18 6-6-6-6" />} />;
        const Settings = (p) => <Icon {...p} d={<React.Fragment><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></React.Fragment>} />;
        const Upload = (p) => <Icon {...p} d={<React.Fragment><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" x2="12" y1="3" y2="15" /></React.Fragment>} />;
        const Plus = (p) => <Icon {...p} d={<React.Fragment><path d="M5 12h14" /><path d="M12 5v14" /></React.Fragment>} />;
        const X = (p) => <Icon {...p} d={<React.Fragment><path d="M18 6 6 18" /><path d="m6 6 12 12" /></React.Fragment>} />;

        const useScrollReveal = () => {
            useEffect(() => {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('active');
                        }
                    });
                }, { threshold: 0.1 });
                document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
                return () => observer.disconnect();
            }, []);
        };

        const convertToBase64 = (file) => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        const Modal = ({ isOpen, onClose, children, size = 'md' }) => {
            if (!isOpen) return null;
            const sizeClass = size === 'lg' ? 'max-w-4xl' : size === 'xl' ? 'max-w-6xl' : 'max-w-2xl';
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto">
                    <div className={`bg-[#13131f] border border-white/10 rounded-2xl w-full ${sizeClass} my-8 max-h-[90vh] overflow-y-auto animate-fade-in-up relative`}>
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-white z-10 p-2 bg-black/20 rounded-full"><X className="w-5 h-5" /></button>
                        {children}
                    </div>
                </div>
            );
        };

        const ImageUploader = ({ value, onChange }) => {
            const handleFile = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                if (file.size > 500000) return alert('MÃ¡x 500KB');
                try { onChange(await convertToBase64(file)); } catch (err) { alert('Error img'); }
            };
            return (
                <div className="space-y-2">
                    <div className="flex gap-2">
                        <input type="text" value={value || ''} onChange={e => onChange(e.target.value)} placeholder="URL o Archivo ->" className="flex-1 bg-black/40 p-3 rounded border border-white/10 text-white" />
                        <label className="cursor-pointer bg-white/10 hover:bg-white/20 p-3 rounded border border-white/10 flex items-center justify-center"><Upload className="w-5 h-5" /><input type="file" className="hidden" accept="image/*" onChange={handleFile} /></label>
                    </div>
                    {value && <img src={value} className="h-20 rounded object-cover border border-white/10" />}
                </div>
            );
        };

        const CustomFormBuilder = ({ fields, onChange }) => {
            const addField = () => onChange([...fields, { id: Date.now(), label: '', type: 'text', options: '' }]);
            const updateField = (id, k, v) => onChange(fields.map(f => f.id === id ? { ...f, [k]: v } : f));
            return (
                <div className="space-y-4 border border-white/10 p-4 rounded bg-black/20">
                    <div className="flex justify-between items-center"><h4 className="font-bold text-sm uppercase text-gray-400">Campos</h4><button type="button" onClick={addField} className="text-celestial text-sm font-bold flex items-center gap-1"><Plus className="w-4 h-4" /> AÃ±adir</button></div>
                    {fields.map(f => (
                        <div key={f.id} className="grid grid-cols-12 gap-2 items-center bg-white/5 p-2 rounded">
                            <input value={f.label} onChange={e => updateField(f.id, 'label', e.target.value)} placeholder="Etiqueta" className="col-span-4 bg-black/40 p-2 rounded text-sm" />
                            <select value={f.type} onChange={e => updateField(f.id, 'type', e.target.value)} className="col-span-3 bg-black/40 p-2 rounded text-sm text-gray-300"><option value="text">Texto</option><option value="number">Num</option><option value="select">Lista</option></select>
                            <input value={f.options} onChange={e => updateField(f.id, 'options', e.target.value)} placeholder="Opciones..." className="col-span-4 bg-black/40 p-2 rounded text-sm" />
                            <button type="button" onClick={() => onChange(fields.filter(x => x.id !== f.id))} className="col-span-1 text-red-400"><X className="w-4 h-4" /></button>
                        </div>
                    ))}
                </div>
            );
        };

        const AdminDashboard = ({ isOpen, onClose, events, eventTypes, onAddEvent, onDeleteEvent, onAddEventType, onDeleteEventType, specialSections, onUpdateSpecialSections }) => {
            const [tab, setTab] = useState('events');
            const [formData, setFormData] = useState({ title: '', date: '', location: '', typeId: 'party', description: '', imageUrl: '', actionType: 'none', actionLabel: '', actionLink: '', customFields: [] });
            const [newType, setNewType] = useState({ name: '', color: '#38bdf8', icon: 'ðŸ“Œ' });

            const handleSubmit = (e) => { e.preventDefault(); onAddEvent(formData); setFormData({ title: '', date: '', location: '', typeId: 'party', description: '', imageUrl: '', actionType: 'none', actionLabel: '', actionLink: '', customFields: [] }); };

            return (
                <Modal isOpen={isOpen} onClose={onClose} size="xl">
                    <div className="p-8">
                        <div className="flex justify-between items-center mb-6"><h2 className="text-3xl font-bold">Admin</h2><div className="flex bg-black/40 p-1 rounded-lg">{['events', 'types', 'special'].map(t => <button key={t} onClick={() => setTab(t)} className={`px-4 py-2 rounded-md font-bold text-sm ${tab === t ? 'bg-celestial text-black' : 'text-gray-400'}`}>{t}</button>)}</div></div>

                        {tab === 'events' && (
                            <div className="grid lg:grid-cols-2 gap-8">
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <input value={formData.title} onChange={e => setFormData({ ...formData, title: e.target.value })} placeholder="TÃ­tulo" required className="w-full bg-black/40 p-3 rounded border border-white/10" />
                                    <div className="grid grid-cols-2 gap-4">
                                        <input value={formData.date} onChange={e => setFormData({ ...formData, date: e.target.value })} type="date" required className="bg-black/40 p-3 rounded border border-white/10" />
                                        <select value={formData.typeId} onChange={e => setFormData({ ...formData, typeId: e.target.value })} className="bg-black/40 p-3 rounded border border-white/10">{eventTypes.map(t => <option key={t.id} value={t.id}>{t.icon} {t.name}</option>)}</select>
                                    </div>
                                    <input value={formData.location} onChange={e => setFormData({ ...formData, location: e.target.value })} placeholder="UbicaciÃ³n" className="w-full bg-black/40 p-3 rounded border border-white/10" />
                                    <textarea value={formData.description} onChange={e => setFormData({ ...formData, description: e.target.value })} placeholder="DescripciÃ³n" className="w-full bg-black/40 p-3 rounded border border-white/10" rows="3" />
                                    <ImageUploader value={formData.imageUrl} onChange={v => setFormData({ ...formData, imageUrl: v })} />

                                    <select value={formData.actionType} onChange={e => setFormData({ ...formData, actionType: e.target.value })} className="w-full bg-black/40 p-3 rounded border border-white/10">
                                        <option value="none">Sin botÃ³n</option><option value="survey">Encuesta</option><option value="form">Formulario</option><option value="link">Enlace</option>
                                    </select>
                                    {['survey', 'form', 'link'].includes(formData.actionType) && <input value={formData.actionLabel} onChange={e => setFormData({ ...formData, actionLabel: e.target.value })} placeholder="Texto botÃ³n" className="w-full bg-black/40 p-3 rounded border border-white/10" />}
                                    {formData.actionType === 'link' && <input value={formData.actionLink} onChange={e => setFormData({ ...formData, actionLink: e.target.value })} placeholder="https://..." className="w-full bg-black/40 p-3 rounded border border-white/10" />}
                                    {formData.actionType === 'form' && <CustomFormBuilder fields={formData.customFields} onChange={f => setFormData({ ...formData, customFields: f })} />}

                                    <button className="w-full bg-celestial text-black py-3 rounded font-bold">Crear</button>
                                </form>
                                <div className="border-l border-white/10 pl-8 space-y-2 max-h-[600px] overflow-y-auto">
                                    {events.map(e => <div key={e.id} className="flex justify-between bg-white/5 p-3 rounded group"><div><div className="font-bold">{e.title}</div><div className="text-xs text-gray-400">{e.date}</div></div><button onClick={() => onDeleteEvent(e.id)} className="text-red-500 opacity-0 group-hover:opacity-100"><Trash className="w-4 h-4" /></button></div>)}
                                </div>
                            </div>
                        )}

                        {tab === 'types' && (
                            <div>
                                <div className="grid grid-cols-4 gap-4 mb-6"><input value={newType.name} onChange={e => setNewType({ ...newType, name: e.target.value })} placeholder="Nombre" className="col-span-2 bg-black/40 p-3 rounded border border-white/10" /><input value={newType.color} onChange={e => setNewType({ ...newType, color: e.target.value })} type="color" className="bg-black/40 p-2 h-full w-full rounded" /><input value={newType.icon} onChange={e => setNewType({ ...newType, icon: e.target.value })} placeholder="Emoji" className="bg-black/40 p-3 rounded border border-white/10 text-center" /></div>
                                <button onClick={() => { onAddEventType({ ...newType, id: Date.now().toString() }); setNewType({ name: '', color: '#38bdf8', icon: 'ðŸ“Œ' }); }} className="w-full bg-white/10 py-3 rounded font-bold mb-8">AÃ±adir Tipo</button>
                                <div className="grid md:grid-cols-3 gap-4">{eventTypes.map(t => <div key={t.id} className="flex items-center justify-between p-4 rounded-lg bg-[#0a0a0f] border border-white/10" style={{ borderLeft: `4px solid ${t.color}` }}><div className="flex gap-3"><span className="text-2xl">{t.icon}</span><span className="font-bold">{t.name}</span></div>{!['party', 'tournament', 'tickets', 'special'].includes(t.id) && <button onClick={() => onDeleteEventType(t.id)} className="text-red-500"><Trash className="w-4 h-4" /></button>}</div>)}</div>
                            </div>
                        )}

                        {tab === 'special' && (
                            <div className="space-y-6">
                                <div className="flex justify-between"><h3 className="font-bold">Secciones</h3><button onClick={() => onUpdateSpecialSections([...specialSections, { id: Date.now(), title: '', description: '', imageUrl: '', link: '', active: true }])} className="bg-white/10 px-4 py-2 rounded">+ Nueva</button></div>
                                {specialSections.map(s => (
                                    <div key={s.id} className="bg-white/5 p-4 rounded border border-white/10 space-y-3">
                                        <div className="flex justify-between"><label className="flex gap-2 font-bold"><input type="checkbox" checked={s.active} onChange={e => onUpdateSpecialSections(specialSections.map(x => x.id === s.id ? { ...x, active: e.target.checked } : x))} /> Visible</label><button onClick={() => onUpdateSpecialSections(specialSections.filter(x => x.id !== s.id))} className="text-red-400 text-xs">ELIMINAR</button></div>
                                        <input value={s.title} onChange={e => onUpdateSpecialSections(specialSections.map(x => x.id === s.id ? { ...x, title: e.target.value } : x))} placeholder="TÃ­tulo" className="w-full bg-black/40 p-2 rounded" />
                                        <textarea value={s.description} onChange={e => onUpdateSpecialSections(specialSections.map(x => x.id === s.id ? { ...x, description: e.target.value } : x))} placeholder="Desc" className="w-full bg-black/40 p-2 rounded" />
                                        <ImageUploader value={s.imageUrl} onChange={v => onUpdateSpecialSections(specialSections.map(x => x.id === s.id ? { ...x, imageUrl: v } : x))} />
                                        <input value={s.link} onChange={e => onUpdateSpecialSections(specialSections.map(x => x.id === s.id ? { ...x, link: e.target.value } : x))} placeholder="Link" className="w-full bg-black/40 p-2 rounded" />
                                    </div>
                                ))}
                                <button onClick={() => { window.setDoc(window.doc(window.db, 'config', 'specialSections'), { sections: specialSections }); alert('Guardado'); }} className="w-full bg-celestial text-black py-3 rounded font-bold">GUARDAR CONFIGURACIÃ“N</button>
                            </div>
                        )}
                    </div>
                </Modal>
            );
        };

        const AdminLogin = ({ onClose, onSuccess }) => {
            const [pass, setPass] = useState('');
            const handleLogin = (e) => { e.preventDefault(); if (pass === (localStorage.getItem('liga_password') || '4321')) onSuccess(); else alert('Error'); };
            return <Modal isOpen={true} onClose={onClose}><div className="p-8 text-center"><h2 className="text-2xl font-bold mb-4">Admin</h2><form onSubmit={handleLogin}><input type="password" autoFocus className="w-full bg-black/40 border border-white/10 rounded-lg p-3 text-center text-white text-xl tracking-widest mb-4" value={pass} onChange={e => setPass(e.target.value)} /><button className="px-6 py-2 bg-celestial text-black font-bold rounded-lg">Entrar</button></form></div></Modal>;
        };

        const EventRegistrationModal = ({ event, onClose }) => {
            const [formData, setFormData] = useState({});
            const handleSubmit = async (e) => {
                e.preventDefault();
                try { await window.addDoc(window.collection(window.db, "event_registrations"), { eventId: event.id, eventTitle: event.title, submittedAt: new Date().toISOString(), ...formData }); alert('Enviado'); onClose(); }
                catch (err) { alert('Error'); }
            };
            return (
                <Modal isOpen={true} onClose={onClose}>
                    <div className="p-8">
                        <h2 className="text-2xl font-bold mb-4">InscripciÃ³n: {event.title}</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            {event.customFields?.map(f => (
                                <div key={f.id}><label className="block text-sm font-bold text-gray-400 mb-1">{f.label}</label>
                                    {f.type === 'select' ? <select required className="w-full bg-black/40 p-3 rounded" onChange={e => setFormData({ ...formData, [f.label]: e.target.value })}><option value="">Select...</option>{f.options.split(',').map(o => <option key={o} value={o.trim()}>{o.trim()}</option>)}</select>
                                        : <input required type={f.type} className="w-full bg-black/40 p-3 rounded" onChange={e => setFormData({ ...formData, [f.label]: e.target.value })} />}
                                </div>
                            ))}
                            <button className="w-full bg-celestial text-black font-bold py-3 rounded mt-4">Enviar</button>
                        </form>
                    </div>
                </Modal>
            );
        };

        function App() {
            useScrollReveal(); // Animation hook active!
            const [isAdmin, setIsAdmin] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const [showAdminPanel, setShowAdminPanel] = useState(false);
            const [regFormEvent, setRegFormEvent] = useState(null);

            const [events, setEvents] = useState([]);
            const [eventTypes, setEventTypes] = useState(DEFAULT_EVENT_TYPES);
            const [specialSections, setSpecialSections] = useState([]);
            const [ligaLeader, setLigaLeader] = useState(null);

            const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());
            const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
            const [selectedDay, setSelectedDay] = useState(null);

            useEffect(() => {
                if (!window.db) return;
                const u1 = window.onSnapshot(window.query(window.collection(window.db, "events"), window.orderBy("date", "asc")), s => setEvents(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                const u2 = window.onSnapshot(window.doc(window.db, "config", "eventTypes"), d => d.exists() && setEventTypes(d.data().types || DEFAULT_EVENT_TYPES));
                const u3 = window.onSnapshot(window.doc(window.db, "config", "specialSections"), d => d.exists() && setSpecialSections(d.data().sections || []));
                const u4 = window.onSnapshot(window.query(window.collection(window.db, "players"), window.orderBy("points", "desc"), window.limit(1)), s => !s.empty && setLigaLeader(s.docs[0].data()));
                return () => { u1(); u2(); u3(); u4(); };
            }, []);

            const monthData = useMemo(() => {
                const dt = new Date(currentYear, currentMonth, 1);
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                const startOff = dt.getDay() === 0 ? 6 : dt.getDay() - 1;
                return { days: Array(startOff).fill(null).concat([...Array(daysInMonth).keys()].map(i => i + 1)), name: dt.toLocaleString('es-ES', { month: 'long' }).toUpperCase() };
            }, [currentMonth, currentYear]);

            const upcoming = events.filter(e => new Date(e.date) >= new Date(new Date().setHours(0, 0, 0, 0)));
            const renderAction = (evt) => {
                const cls = "mt-4 w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-transform active:scale-95";
                if (evt.actionType === 'link') return <a href={evt.actionLink} target="_blank" className={`${cls} bg-white/5 border border-white/10`}><ExternalLink className="w-5 h-5" /> Ver MÃ¡s</a>;
                if (evt.actionType === 'survey') {
                    const voted = localStorage.getItem(`voted_${evt.id}`);
                    return <button onClick={async () => { if (voted) return; await window.updateDoc(window.doc(window.db, "events", evt.id), { surveyCount: (evt.surveyCount || 0) + 1 }); localStorage.setItem(`voted_${evt.id}`, 'true'); alert('OK'); }} disabled={!!voted} className={`${cls} ${voted ? 'bg-green-500/20 text-green-400' : 'bg-celestial text-black'}`}><Checks className="w-5 h-5" /> {voted ? 'Listo' : 'AsistirÃ©'}</button>;
                }
                if (evt.actionType === 'form') return <button onClick={() => setRegFormEvent(evt)} className={`${cls} bg-gradient-to-r from-ligaPrimary to-ligaSecondary text-white`}>Inscribirse</button>;
                return null;
            };

            return (
                <div className="min-h-screen flex flex-col relative font-sans">
                    {showLogin && <AdminLogin onClose={() => setShowLogin(false)} onSuccess={() => { setIsAdmin(true); setShowLogin(false); setShowAdminPanel(true); }} />}
                    {showAdminPanel && <AdminDashboard isOpen={true} onClose={() => setShowAdminPanel(false)} events={events} eventTypes={eventTypes} onAddEvent={d => window.addDoc(window.collection(window.db, "events"), { ...d, typeColor: (eventTypes.find(t => t.id === d.typeId) || eventTypes[0]).color, typeIcon: (eventTypes.find(t => t.id === d.typeId) || eventTypes[0]).icon, typeName: (eventTypes.find(t => t.id === d.typeId) || eventTypes[0]).name })} onDeleteEvent={id => window.deleteDoc(window.doc(window.db, "events", id))} onAddEventType={t => { const u = [...eventTypes, t]; setEventTypes(u); window.setDoc(window.doc(window.db, "config", "eventTypes"), { types: u }) }} onDeleteEventType={id => { const u = eventTypes.filter(t => t.id !== id); setEventTypes(u); window.setDoc(window.doc(window.db, "config", "eventTypes"), { types: u }) }} specialSections={specialSections} onUpdateSpecialSections={setSpecialSections} />}
                    {regFormEvent && <EventRegistrationModal event={regFormEvent} onClose={() => setRegFormEvent(null)} />}

                    <div className="fixed top-4 right-4 z-50 flex gap-2">
                        {isAdmin && <button onClick={() => setShowAdminPanel(true)} className="p-3 bg-celestial text-black rounded-full shadow-lg"><Settings className="w-5 h-5" /></button>}
                        <button onClick={() => isAdmin ? setIsAdmin(false) : setShowLogin(true)} className={`p-3 rounded-full shadow-lg ${isAdmin ? 'bg-red-500 text-white' : 'bg-white/5 text-gray-400'}`}><Lock className="w-5 h-5" /></button>
                    </div>

                    <section className="min-h-[90vh] flex flex-col items-center justify-center p-6 relative clip-diagonal bg-[#0a0a0f]">
                        <div className="absolute inset-0 bg-celestial/10 blur-[120px] pointer-events-none"></div>
                        <div className="relative w-72 h-72 md:w-96 md:h-96 mb-8 animate-float"><img src="./liga-multisport/logo.png" className="w-full h-full object-contain drop-shadow-[0_0_50px_rgba(56,189,248,0.2)]" /></div>
                        <h1 className="text-6xl md:text-8xl font-black text-center tracking-tighter mb-4 reveal"><span className="text-white">PASO DE </span><span className="text-celestial text-glow">ECUADOR</span></h1>
                        <p className="text-xl md:text-3xl text-gray-400 font-light tracking-[0.2em] mb-12 reveal">INEF 25/26</p>
                        <a href="#events" className="px-10 py-4 rounded-full bg-celestial text-black font-black text-lg hover:shadow-[0_0_30px_rgba(56,189,248,0.5)] reveal">VER EVENTOS</a>
                    </section>

                    {specialSections.filter(s => s.active).map(s => (
                        <section key={s.id} className="py-12 px-4 md:px-8 max-w-7xl mx-auto w-full reveal">
                            <div className="glass-panel p-8 md:p-12 rounded-3xl border-l-4 border-celestial relative overflow-hidden group">
                                {s.imageUrl && <div className="absolute right-0 top-0 bottom-0 w-full md:w-1/2 opacity-20"><img src={s.imageUrl} className="w-full h-full object-cover" /></div>}
                                <div className="relative z-10 max-w-2xl"><h2 className="text-4xl font-bold mb-4 text-white">{s.title}</h2><p className="text-lg text-gray-300 mb-8 whitespace-pre-line">{s.description}</p>{s.link && <a href={s.link} target="_blank" className="inline-flex items-center gap-2 px-6 py-3 bg-white/10 rounded-full">Ver Detalles <ExternalLink className="w-5 h-5" /></a>}</div>
                            </div>
                        </section>
                    ))}

                    <section id="events" className="py-20 px-4 md:px-8 max-w-7xl mx-auto w-full">
                        <h2 className="text-5xl font-black mb-16 flex items-center gap-6 reveal"><span className="w-3 h-16 bg-celestial rounded-full"></span>PRÃ“XIMAMENTE</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            {upcoming.map((evt, i) => (
                                <div key={evt.id} className="glass-panel p-6 rounded-3xl flex flex-col reveal group relative hover:bg-[#161626] transition-colors" style={{ transitionDelay: `${i * 100}ms` }}>
                                    <div className="absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-bold uppercase border bg-black/50" style={{ color: evt.typeColor, borderColor: evt.typeColor }}>{evt.typeIcon} {evt.typeName}</div>
                                    {evt.imageUrl && <div className="w-full h-56 mb-6 rounded-2xl overflow-hidden"><img src={evt.imageUrl} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" /></div>}
                                    <div className="text-celestial font-bold text-sm mb-2">{new Date(evt.date).toLocaleDateString()}</div>
                                    <h3 className="text-3xl font-bold text-white mb-3">{evt.title}</h3>
                                    {evt.location && <div className="flex gap-2 text-gray-400 text-sm mb-4"><MapPin className="w-4 h-4" /> {evt.location}</div>}
                                    {evt.description && <p className="text-gray-400 text-sm mb-6 line-clamp-3">{evt.description}</p>}
                                    <div className="mt-auto">{renderAction(evt)}</div>
                                </div>
                            ))}
                            {upcoming.length === 0 && <div className="col-span-full py-32 text-center text-gray-500 bg-white/5 rounded-3xl border border-dashed border-white/5 reveal">No hay eventos prÃ³ximos</div>}
                        </div>
                    </section>

                    <div className="relative py-40 bg-[#050507]">
                        <section className="relative z-10 max-w-7xl mx-auto px-6 grid lg:grid-cols-2 gap-16 items-center">
                            <div className="reveal">
                                <div className="inline-block px-4 py-1 mb-6 rounded-full bg-gradient-to-r from-ligaPrimary to-ligaSecondary text-white text-xs font-bold uppercase">Premio Final 100â‚¬</div>
                                <h2 className="text-6xl md:text-8xl font-black mb-8 leading-[0.9]"><span className="text-white">LIGA</span><br /><span className="bg-gradient-to-r from-ligaPrimary to-ligaSecondary bg-clip-text text-transparent">MULTISPORT</span></h2>
                                <a href="./liga-multisport/index.html" className="inline-flex gap-4 px-10 py-5 rounded-2xl bg-white text-black font-black text-xl hover:scale-105">VER CLASIFICACIÃ“N <ExternalLink className="w-6 h-6" /></a>
                            </div>
                            <div className="relative reveal">
                                <div className="glass-panel p-8 rounded-[2rem] border border-white/10 transform rotate-[-3deg] hover:rotate-0 transition-transform">
                                    <div className="flex items-center gap-6 mb-6 pb-6 border-b border-white/10"><div className="w-16 h-16 rounded-full bg-yellow-500 flex items-center justify-center text-2xl">ðŸ‘‘</div><div><div className="text-sm text-gray-400 uppercase font-bold">LÃ­der Actual</div><div className="text-3xl font-black">{ligaLeader ? ligaLeader.name : 'Cargando...'}</div><div className="text-ligaPrimary font-bold">{ligaLeader ? ligaLeader.points + ' Puntos' : '-'}</div></div></div>
                                </div>
                            </div>
                        </section>
                    </div>

                    <section className="py-20 px-4 md:px-8 max-w-5xl mx-auto w-full reveal">
                        <div className="glass-panel p-8 md:p-12 rounded-[2.5rem]">
                            <div className="flex justify-between items-center mb-10"><h2 className="text-3xl font-black uppercase text-celestial">{monthData.name} <span className="text-white/30">{currentYear}</span></h2><div className="flex gap-2"><button onClick={() => { if (currentMonth === 0) { setCurrentMonth(11); setCurrentYear(currentYear - 1) } else { setCurrentMonth(currentMonth - 1) } }} className="p-3 bg-white/5 rounded-xl"><ChevronLeft className="w-6 h-6" /></button><button onClick={() => { if (currentMonth === 11) { setCurrentMonth(0); setCurrentYear(currentYear + 1) } else { setCurrentMonth(currentMonth + 1) } }} className="p-3 bg-white/5 rounded-xl"><ChevronRight className="w-6 h-6" /></button></div></div>
                            <div className="grid grid-cols-7 gap-y-6 gap-x-2 text-center">
                                {['L', 'M', 'X', 'J', 'V', 'S', 'D'].map(d => <div key={d} className="font-bold text-gray-500 text-sm">{d}</div>)}
                                {monthData.days.map((d, i) => {
                                    if (!d) return <div key={i}></div>;
                                    const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`, dayEvts = events.filter(e => e.date === dateStr), hol = HOLIDAYS.find(h => h.date === dateStr);
                                    return <div key={i} onClick={() => setSelectedDay({ date: dateStr, events: dayEvts, holiday: hol })} className={`min-h-[80px] rounded-2xl p-2 cursor-pointer ${hol ? 'bg-red-500/10 text-red-400' : [0, 6].includes(new Date(currentYear, currentMonth, d).getDay()) ? 'bg-celestial/5' : 'hover:bg-white/5'}`}><div className="text-xl font-bold mb-2">{d}</div><div className="flex flex-col gap-1">{dayEvts.map(e => <div key={e.id} className="h-1.5 md:h-auto md:px-2 md:py-0.5 rounded-full text-[10px] font-bold truncate" style={{ backgroundColor: e.typeColor, color: '#000' }}><span className="hidden md:inline">{e.title}</span></div>)}</div></div>
                                })}
                            </div>
                        </div>
                    </section>

                    {selectedDay && (
                        <Modal isOpen={true} onClose={() => setSelectedDay(null)}>
                            <div className="p-8">
                                <h2 className="text-3xl font-black mb-1 capitalize">{new Date(selectedDay.date).toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}</h2>
                                {selectedDay.holiday && <div className="inline-block px-3 py-1 bg-red-500/20 text-red-300 rounded-lg text-sm font-bold mb-6">{selectedDay.holiday.name}</div>}
                                <div className="space-y-4">
                                    {selectedDay.events.map(evt => (
                                        <div key={evt.id} className="bg-white/5 p-5 rounded-2xl border-l-4 space-y-2" style={{ borderColor: evt.typeColor }}>
                                            <div className="flex justify-between items-start">
                                                <div><div className="font-bold text-xl">{evt.title}</div><div className="text-sm opacity-70 flex items-center gap-2">{evt.typeIcon} {evt.typeName}</div></div>
                                                <a href={`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(evt.title)}&dates=${evt.date.replace(/-/g, '')}T000000/${evt.date.replace(/-/g, '')}T235959&details=${encodeURIComponent(evt.description)}&location=${encodeURIComponent(evt.location)}`} target="_blank" className="p-2 bg-white/10 rounded-lg hover:bg-white/20"><CalendarIcon className="w-5 h-5" /></a>
                                            </div>
                                            {renderAction(evt)}
                                        </div>
                                    ))}
                                    {selectedDay.events.length === 0 && !selectedDay.holiday && <p className="text-center text-gray-500 py-8 italic">No hay eventos.</p>}
                                </div>
                            </div>
                        </Modal>
                    )}

                    <footer className="mt-auto py-12 border-t border-white/5 bg-[#050507] text-center text-gray-600 text-sm">Â© 2025 Paso de Ecuador INEF 25/26</footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
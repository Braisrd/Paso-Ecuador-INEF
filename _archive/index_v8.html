<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paso de Ecuador 25/26 - INEF</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { dark: '#0a0a0f', card: '#13131f', celestial: '#38bdf8', celestialDark: '#0284c7', ligaPrimary: '#6366f1', ligaSecondary: '#ec4899', }, fontFamily: { sans: ['Inter', 'sans-serif'], display: ['Outfit', 'sans-serif'], }, animation: { 'float': 'float 6s ease-in-out infinite', 'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite', 'fade-in-up': 'fadeInUp 0.8s ease-out forwards', }, keyframes: { float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-20px)' }, }, fadeInUp: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' }, } } } } }
    </script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, limit, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyCmuNrhWE8Aw24_qUK23Qo4u_W5M6cAFN4", authDomain: "liga-multisport.firebaseapp.com", projectId: "liga-multisport", storageBucket: "liga-multisport.firebasestorage.app", messagingSenderId: "983340811794", appId: "1:983340811794:web:a86d9e3dbb620accebbacb", measurementId: "G-TPNXY1LNX9" };
        const app = initializeApp(firebaseConfig); window.db = getFirestore(app); window.collection = collection; window.addDoc = addDoc; window.updateDoc = updateDoc; window.deleteDoc = deleteDoc; window.doc = doc; window.getDoc = getDoc; window.setDoc = setDoc; window.onSnapshot = onSnapshot; window.query = query; window.orderBy = orderBy; window.limit = limit;
    </script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Outfit:wght@300;500;700;900&display=swap"
        rel="stylesheet">
    <style>
        body {
            background-color: #0a0a0f;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Outfit', sans-serif;
        }

        .bg-celestial {
            background: radial-gradient(circle at 50% 0%, rgba(56, 189, 248, 0.15) 0%, transparent 60%), radial-gradient(circle at 10% 80%, rgba(56, 189, 248, 0.05) 0%, transparent 50%);
        }

        .glass-panel {
            background: rgba(19, 19, 31, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .clip-diagonal {
            clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0a0f;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        input[type="date"] {
            color-scheme: dark;
        }
    </style>
</head>

<body class="bg-celestial">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, Fragment } = React;

        const HOLIDAYS = [{ date: '2025-01-01', name: 'A√±o Nuevo' }, { date: '2025-01-06', name: 'Reyes' }, { date: '2025-04-18', name: 'Viernes Santo' }, { date: '2025-05-01', name: 'D√≠a del Trabajo' }, { date: '2025-08-15', name: 'Asunci√≥n' }, { date: '2025-10-12', name: 'Fiesta Nacional' }, { date: '2025-11-01', name: 'Todos los Santos' }, { date: '2025-12-06', name: 'Constituci√≥n' }, { date: '2025-12-08', name: 'Inmaculada' }, { date: '2025-12-25', name: 'Navidad' }];
        const DEFAULT_EVENT_TYPES = [{ id: 'party', name: 'Fiesta', color: '#ec4899', icon: 'üéâ' }, { id: 'tournament', name: 'Torneo', color: '#f59e0b', icon: 'üèÜ' }, { id: 'tickets', name: 'Entradas', color: '#8b5cf6', icon: 'üé´' }, { id: 'special', name: 'Evento Especial', color: '#10b981', icon: '‚≠ê' }];

        const Icon = ({ d, className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{d}</svg>;
        // Use Fragment explicitly to avoid crash
        const CalendarIcon = (p) => <Icon {...p} d={<Fragment><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></Fragment>} />;
        const MapPin = (p) => <Icon {...p} d={<Fragment><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></Fragment>} />;
        const Lock = (p) => <Icon {...p} d={<Fragment><rect width="18" height="11" x="3" y="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></Fragment>} />;
        const Trash = (p) => <Icon {...p} d={<Fragment><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /></Fragment>} />;
        const Edit = (p) => <Icon {...p} d={<Fragment><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" /></Fragment>} />;
        const ExternalLink = (p) => <Icon {...p} d={<Fragment><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" x2="21" y1="14" y2="3" /></Fragment>} />;
        const Checks = (p) => <Icon {...p} d={<Fragment><path d="M18 6 7 17l-5-5" /><path d="m22 10-7.5 7.5L13 16" /></Fragment>} />;
        const ChevronLeft = (p) => <Icon {...p} d={<path d="m15 18-6-6 6-6" />} />;
        const ChevronRight = (p) => <Icon {...p} d={<path d="m9 18 6-6-6-6" />} />;
        const Settings = (p) => <Icon {...p} d={<Fragment><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></Fragment>} />;
        const Upload = (p) => <Icon {...p} d={<Fragment><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" x2="12" y1="3" y2="15" /></Fragment>} />;
        const Plus = (p) => <Icon {...p} d={<Fragment><path d="M5 12h14" /><path d="M12 5v14" /></Fragment>} />;
        const X = (p) => <Icon {...p} d={<Fragment><path d="M18 6 6 18" /><path d="m6 6 12 12" /></Fragment>} />;

        const compressImage = async (file) => { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = (event) => { const img = new Image(); img.src = event.target.result; img.onload = () => { const canvas = document.createElement('canvas'); let width = img.width; let height = img.height; const MAX_WIDTH = 1200; const MAX_HEIGHT = 1200; if (width > height) { if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; } } else { if (height > MAX_HEIGHT) { width *= MAX_HEIGHT / height; height = MAX_HEIGHT; } } canvas.width = width; canvas.height = height; const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, width, height); resolve(canvas.toDataURL('image/jpeg', 0.7)); }; }; reader.onerror = error => reject(error); }); };

        const Modal = ({ isOpen, onClose, children, size = 'md' }) => {
            if (!isOpen) return null;
            const sizeClass = size === 'lg' ? 'max-w-4xl' : size === 'xl' ? 'max-w-6xl' : 'max-w-2xl';
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto" onClick={onClose}>
                    <div className={`bg-[#13131f] border border-white/10 rounded-2xl w-full ${sizeClass} my-8 max-h-[90vh] overflow-y-auto relative shadow-2xl`} onClick={e => e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-white z-10 p-2 bg-black/20 rounded-full hover:bg-black/50 transition-colors"><X className="w-5 h-5" /></button>
                        {children}
                    </div>
                </div>
            );
        };

        const ActionButton = ({ event, onOpenForm }) => {
            const [loading, setLoading] = useState(false);
            const [voted, setVoted] = useState(() => localStorage.getItem(`voted_${event.id}`) === 'true');
            const [pollVote, setPollVote] = useState(() => localStorage.getItem(`poll_vote_${event.id}`));
            const handleSurveyClick = async (e) => {
                e.preventDefault(); e.stopPropagation(); if (loading) return; setLoading(true); const isVoted = voted; setVoted(!isVoted);
                try { if (isVoted) { if (confirm('¬øRetirar tu voto?')) { await window.updateDoc(window.doc(window.db, "events", event.id), { surveyCount: Math.max(0, (event.surveyCount || 0) - 1) }); localStorage.removeItem(`voted_${event.id}`); } else { setVoted(true); } } else { await window.updateDoc(window.doc(window.db, "events", event.id), { surveyCount: (event.surveyCount || 0) + 1 }); localStorage.setItem(`voted_${event.id}`, 'true'); alert('Has confirmado tu asistencia.'); } } catch (err) { alert('Error de conexi√≥n'); setVoted(isVoted); } finally { setTimeout(() => setLoading(false), 500); }
            };
            const handlePollVote = async (opt) => {
                if (loading) return; setLoading(true); const key = `poll_vote_${event.id}`; const current = localStorage.getItem(key); const counts = { ...(event.pollCounts || {}) };
                try {
                    if (current === opt) { counts[opt] = Math.max(0, (counts[opt] || 0) - 1); await window.updateDoc(window.doc(window.db, "events", event.id), { pollCounts: counts }); localStorage.removeItem(key); setPollVote(null); }
                    else { if (current) counts[current] = Math.max(0, (counts[current] || 0) - 1); counts[opt] = (counts[opt] || 0) + 1; await window.updateDoc(window.doc(window.db, "events", event.id), { pollCounts: counts }); localStorage.setItem(key, opt); setPollVote(opt); }
                } catch (e) { alert('Error'); } finally { setLoading(false); }
            };
            const cls = "mt-4 w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-transform active:scale-95 shadow-lg";
            if (event.actionType === 'link') return <a href={event.actionLink} target="_blank" onClick={e => e.stopPropagation()} className={`${cls} bg-white/5 border border-white/10 hover:bg-white/10 text-white`}><ExternalLink className="w-5 h-5" /> {event.actionLabel || 'Ver M√°s'}</a>;
            if (event.actionType === 'survey') return <button onClick={handleSurveyClick} disabled={loading} className={`${cls} ${voted ? 'bg-green-500/20 text-green-400 border border-green-500/50' : 'bg-celestial text-black hover:bg-celestialDark'} ${loading ? 'opacity-50 cursor-wait' : ''}`}><Checks className="w-5 h-5" /> {voted ? 'Asistencia Confirmada' : (event.actionLabel || 'Asistir√©')} {event.showSurveyCount && <span className="ml-2 bg-black/20 px-2 rounded-full text-xs">{(event.surveyCount || 0) + (voted && !event.surveyCount ? 1 : 0)}</span>}</button>;
            if (event.actionType === 'form') return <button onClick={(e) => { e.stopPropagation(); onOpenForm(event); }} className={`${cls} bg-gradient-to-r from-ligaPrimary to-ligaSecondary text-white hover:opacity-90`}>{event.actionLabel || 'Inscribirse'}</button>;
            if (event.actionType === 'poll') return <div className="grid grid-cols-2 gap-2 mt-4 w-full">{event.pollOptions?.map(opt => <button key={opt} onClick={(e) => { e.stopPropagation(); handlePollVote(opt); }} disabled={loading} className={`p-3 rounded-xl font-bold border transition-all ${pollVote === opt ? 'bg-celestial text-black border-celestial scale-95' : 'bg-white/5 border-white/10 hover:bg-white/10'} ${loading ? 'opacity-50' : ''}`}>{opt}</button>)}</div>;
            return null;
        };

        const ButtonBuilder = ({ buttons, onChange }) => {
            const addBtn = () => onChange([...(buttons || []), { id: Date.now(), label: 'Bot√≥n', link: '', style: 'primary', type: 'link' }]);
            const updateBtn = (id, k, v) => onChange(buttons.map(b => b.id === id ? { ...b, [k]: v } : b));
            const removeBtn = (id) => onChange(buttons.filter(b => b.id !== id));
            return (
                <div className="space-y-3 bg-black/20 p-3 rounded border border-white/10">
                    <div className="flex justify-between items-center"><label className="text-sm font-bold text-gray-400">Botones de Acci√≥n</label><button type="button" onClick={addBtn} className="text-xs bg-celestial text-black px-2 py-1 rounded font-bold">+ A√±adir</button></div>
                    {(buttons || []).map(b => (
                        <div key={b.id} className="grid grid-cols-12 gap-2 bg-white/5 p-2 rounded items-center">
                            <input value={b.label} onChange={e => updateBtn(b.id, 'label', e.target.value)} placeholder="Texto" className="col-span-3 bg-black/40 p-2 rounded text-sm" />
                            <select value={b.type || 'link'} onChange={e => updateBtn(b.id, 'type', e.target.value)} className="col-span-2 bg-black/40 p-2 rounded text-sm"><option value="link">Enlace</option><option value="form">Formulario</option><option value="vote">Votar</option></select>
                            <input value={b.link} onChange={e => updateBtn(b.id, 'link', e.target.value)} placeholder={b.type === 'form' ? 'Campos (opcional)' : 'Link / #id'} disabled={b.type === 'vote'} className="col-span-3 bg-black/40 p-2 rounded text-sm" />
                            <select value={b.style} onChange={e => updateBtn(b.id, 'style', e.target.value)} className="col-span-3 bg-black/40 p-2 rounded text-sm"><option value="primary">Azul (Principal)</option><option value="secondary">Blanco (Secundario)</option><option value="outline">Borde (Discreto)</option><option value="gradient">Gradiente (Destacado)</option></select>
                            <button type="button" onClick={() => removeBtn(b.id)} className="col-span-1 text-red-500 flex justify-center"><X className="w-4 h-4" /></button>
                        </div>
                    ))}
                    {(!buttons || buttons.length === 0) && <p className="text-xs text-center text-gray-600">Sin botones.</p>}
                </div>
            );
        };

        const ImageUploader = ({ value, onChange }) => {
            const handleFile = async (files) => { const file = files[0]; if (!file) return; try { const compressed = await compressImage(file); onChange(compressed); } catch (err) { alert('Error al procesar la imagen'); } };
            return (
                <div className="space-y-2">
                    <div className="flex gap-2" onDragOver={e => e.preventDefault()} onDrop={e => { e.preventDefault(); handleFile(e.dataTransfer.files); }}>
                        <input type="text" value={value || ''} onChange={e => onChange(e.target.value)} onPaste={e => { if (e.clipboardData.files.length) handleFile(e.clipboardData.files); }} placeholder="Imagen (URL, Pegar o Arrastrar)" className="flex-1 bg-black/40 p-3 rounded border border-white/10 text-white" />
                        <label className="cursor-pointer bg-white/10 hover:bg-white/20 p-3 rounded border border-white/10 flex items-center justify-center"><Upload className="w-5 h-5" /><input type="file" className="hidden" accept="image/*" onChange={e => handleFile(e.target.files)} /></label>
                    </div>
                    {value && <img src={value} className="h-24 rounded object-contain border border-white/10 bg-black/40 w-full" />}
                </div>
            );
        };

        const CustomFormBuilder = ({ fields, onChange }) => {
            const addField = () => onChange([...fields, { id: Date.now(), label: '', type: 'text', options: '' }]);
            const updateField = (id, k, v) => onChange(fields.map(f => f.id === id ? { ...f, [k]: v } : f));
            return (
                <div className="space-y-4 border border-white/10 p-4 rounded bg-black/20">
                    <div className="flex justify-between items-center"><h4 className="font-bold text-sm uppercase text-gray-400">Campos del Formulario</h4><button type="button" onClick={addField} className="text-celestial text-sm font-bold flex items-center gap-1"><Plus className="w-4 h-4" /> A√±adir Campo</button></div>
                    {fields.map(f => (
                        <div key={f.id} className="grid grid-cols-12 gap-2 items-center bg-white/5 p-2 rounded">
                            <input value={f.label} onChange={e => updateField(f.id, 'label', e.target.value)} placeholder="Etiqueta" className="col-span-4 bg-black/40 p-2 rounded text-sm" />
                            <select value={f.type} onChange={e => updateField(f.id, 'type', e.target.value)} className="col-span-3 bg-black/40 p-2 rounded text-sm text-gray-300"><option value="text">Texto</option><option value="number">N√∫mero</option><option value="select">Desplegable</option></select>
                            <input value={f.options} onChange={e => updateField(f.id, 'options', e.target.value)} placeholder="Opciones" className="col-span-4 bg-black/40 p-2 rounded text-sm" disabled={f.type !== 'select'} />
                            <button type="button" onClick={() => onChange(fields.filter(x => x.id !== f.id))} className="col-span-1 text-red-400 flex justify-center"><X className="w-4 h-4" /></button>
                        </div>
                    ))}
                    {fields.length === 0 && <p className="text-xs text-center text-gray-500">A√±ade campos para el formulario.</p>}
                </div>
            );
        };

        const AdminDashboard = ({ isOpen, onClose, events, eventTypes, onSaveEvent, onDeleteEvent, onAddEventType, onDeleteEventType, specialSections, onUpdateSpecialSections, onOpenStats }) => {
            const [tab, setTab] = useState('events');
            const INITIAL_FORM = { title: '', date: '', time: '', location: '', typeId: 'party', description: '', imageUrl: '', actionType: 'none', actionLabel: '', actionLink: '', customFields: [], showSurveyCount: false, pollOptions: [] };
            const [formData, setFormData] = useState(INITIAL_FORM);
            const [editingId, setEditingId] = useState(null);
            const [newType, setNewType] = useState({ name: '', color: '#38bdf8', icon: 'üìå' });
            const safeUpdateSection = (newSections) => onUpdateSpecialSections(newSections.map(s => ({ ...s, buttons: s.buttons || [] })));

            return (
                <Modal isOpen={isOpen} onClose={onClose} size="xl">
                    <div className="p-8">
                        <div className="flex justify-between items-center mb-6"><h2 className="text-3xl font-bold">Panel Admin</h2><div className="flex bg-black/40 p-1 rounded-lg">{[{ id: 'events', l: 'Eventos' }, { id: 'types', l: 'Tipos' }, { id: 'special', l: 'Secciones' }].map(t => <button key={t.id} onClick={() => setTab(t.id)} className={`px-4 py-2 rounded-md font-bold text-sm ${tab === t.id ? 'bg-celestial text-black' : 'text-gray-400'}`}>{t.l}</button>)}</div></div>
                        {tab === 'events' && (
                            <div className="grid lg:grid-cols-2 gap-8">
                                <form onSubmit={e => { e.preventDefault(); onSaveEvent(formData, editingId); setFormData(INITIAL_FORM); setEditingId(null); }} className="space-y-4">
                                    <h3 className="font-bold text-celestial">{editingId ? 'Editando Evento' : 'Nuevo Evento'}</h3>
                                    <input value={formData.title} onChange={e => setFormData({ ...formData, title: e.target.value })} placeholder="T√≠tulo" required className="w-full bg-black/40 p-3 rounded" />
                                    <div className="grid grid-cols-3 gap-4"><input value={formData.date} onChange={e => setFormData({ ...formData, date: e.target.value })} type="date" required className="bg-black/40 p-3 rounded cursor-pointer" /><input value={formData.time} onChange={e => setFormData({ ...formData, time: e.target.value })} type="time" className="bg-black/40 p-3 rounded cursor-pointer text-white" /><select value={formData.typeId} onChange={e => setFormData({ ...formData, typeId: e.target.value })} className="bg-black/40 p-3 rounded">{eventTypes.map(t => <option key={t.id} value={t.id}>{t.icon} {t.name}</option>)}</select></div>
                                    <input value={formData.location} onChange={e => setFormData({ ...formData, location: e.target.value })} placeholder="Ubicaci√≥n" className="w-full bg-black/40 p-3 rounded" />
                                    <textarea value={formData.description} onChange={e => setFormData({ ...formData, description: e.target.value })} placeholder="Descripci√≥n" className="w-full bg-black/40 p-3 rounded" rows="3" />
                                    <ImageUploader value={formData.imageUrl} onChange={v => setFormData({ ...formData, imageUrl: v })} />
                                    <div className="bg-white/5 p-4 rounded border border-white/10"><label className="block text-sm font-bold text-gray-400 mb-2">Acci√≥n Principal</label><select value={formData.actionType} onChange={e => setFormData({ ...formData, actionType: e.target.value })} className="w-full bg-black/40 p-3 rounded mb-3"><option value="none">Sin bot√≥n</option><option value="survey">Encuesta R√°pida</option><option value="form">Formulario</option><option value="link">Enlace Externo</option><option value="poll">Votaci√≥n</option></select>{['survey', 'form', 'link'].includes(formData.actionType) && <input value={formData.actionLabel} onChange={e => setFormData({ ...formData, actionLabel: e.target.value })} placeholder="Texto del bot√≥n" className="w-full bg-black/40 p-3 rounded mb-3" />}{formData.actionType === 'link' && <input value={formData.actionLink} onChange={e => setFormData({ ...formData, actionLink: e.target.value })} placeholder="Link" className="w-full bg-black/40 p-3 rounded" />}{formData.actionType === 'form' && <CustomFormBuilder fields={formData.customFields} onChange={f => setFormData({ ...formData, customFields: f })} />}{formData.actionType === 'survey' && <label className="flex items-center gap-2 mt-2 text-sm text-gray-400"><input type="checkbox" checked={formData.showSurveyCount || false} onChange={e => setFormData({ ...formData, showSurveyCount: e.target.checked })} /> Mostrar contador</label>}
                                        {formData.actionType === 'poll' && <div className="bg-black/30 p-2 rounded mb-3 space-y-2"><label className="text-sm font-bold text-gray-400">Opciones</label>{(formData.pollOptions || []).map((opt, i) => <div key={i} className="flex gap-2"><input value={opt} onChange={e => { const u = [...formData.pollOptions]; u[i] = e.target.value; setFormData({ ...formData, pollOptions: u }) }} className="w-full bg-black/40 p-2 rounded" /><button type="button" onClick={() => setFormData({ ...formData, pollOptions: formData.pollOptions.filter((_, idx) => idx !== i) })} className="text-red-500">X</button></div>)}<button type="button" onClick={() => setFormData({ ...formData, pollOptions: [...(formData.pollOptions || []), ''] })} className="text-xs bg-white/10 px-2 py-1 rounded">+ Opci√≥n</button></div>}</div>
                                    <button className="w-full bg-celestial text-black py-3 rounded font-bold">{editingId ? 'Guardar Cambios' : 'Crear Evento'}</button>
                                </form>
                                <div className="space-y-2 max-h-[600px] overflow-y-auto">{events.map(e => <div key={e.id} className="flex justify-between items-center bg-white/5 p-3 rounded group hover:bg-white/10"><div><div className="font-bold">{e.title}</div><div className="text-xs text-gray-400">{e.date}</div></div><div className="flex gap-1 opacity-0 group-hover:opacity-100"><button onClick={() => onOpenStats(e)} className="text-green-500 p-2 text-xs border border-green-500 rounded">DATA</button><button onClick={() => { setFormData({ ...e }); setEditingId(e.id); }} className="text-celestial p-2"><Edit className="w-4 h-4" /></button><button onClick={() => onDeleteEvent(e.id)} className="text-red-500 p-2"><Trash className="w-4 h-4" /></button></div></div>)}</div>
                            </div>
                        )}
                        {tab === 'types' && (<div className="grid grid-cols-4 gap-4"><input value={newType.name} onChange={e => setNewType({ ...newType, name: e.target.value })} placeholder="Nombre" className="col-span-2 bg-black/40 p-3 rounded" /><input value={newType.color} onChange={e => setNewType({ ...newType, color: e.target.value })} type="color" className="bg-black/40 p-2 h-full w-full rounded" /><input value={newType.icon} onChange={e => setNewType({ ...newType, icon: e.target.value })} placeholder="Emoji" className="bg-black/40 p-3 rounded text-center" /><button onClick={() => { onAddEventType({ ...newType, id: Date.now().toString() }); setNewType({ name: '', color: '#38bdf8', icon: 'üìå' }); }} className="col-span-4 bg-white/10 py-3 rounded font-bold">A√±adir Tipo</button><div className="col-span-4 grid md:grid-cols-3 gap-4">{eventTypes.map(t => <div key={t.id} className="flex items-center justify-between p-4 rounded bg-[#0a0a0f] border border-white/10" style={{ borderLeft: `4px solid ${t.color}` }}><span>{t.icon} {t.name}</span>{!['party', 'tournament', 'tickets', 'special'].includes(t.id) && <button onClick={() => onDeleteEventType(t.id)} className="text-red-500"><Trash className="w-4 h-4" /></button>}</div>)}</div></div>)}
                        {tab === 'special' && (<div className="space-y-6"><div className="flex justify-between"><h3 className="font-bold">Secciones</h3><button onClick={() => safeUpdateSection([...specialSections, { id: Date.now(), title: '', description: '', imageUrl: '', active: true, buttons: [], startDate: '', endDate: '', warningDays: '' }])} className="bg-white/10 px-4 py-2 rounded">+ Nueva</button></div>{specialSections.map(s => (<div key={s.id} className="bg-white/5 p-4 rounded border border-white/10 space-y-3 relative"><div className="flex justify-between"><label className="flex gap-2 font-bold"><input type="checkbox" checked={s.active} onChange={e => safeUpdateSection(specialSections.map(x => x.id === s.id ? { ...x, active: e.target.checked } : x))} /> Visible</label><button onClick={() => safeUpdateSection(specialSections.filter(x => x.id !== s.id))} className="text-red-400 text-xs">ELIMINAR</button></div><input value={s.title} onChange={e => safeUpdateSection(specialSections.map(x => x.id === s.id ? { ...x, title: e.target.value } : x))} placeholder="T√≠tulo" className="w-full bg-black/40 p-2 rounded" /><textarea value={s.description} onChange={e => safeUpdateSection(specialSections.map(x => x.id === s.id ? { ...x, description: e.target.value } : x))} placeholder="Descripci√≥n..." className="w-full bg-black/40 p-2 rounded" rows="2" /><div className="grid grid-cols-3 gap-2"><div className="space-y-1"><label className="text-xs text-gray-400">Fecha Inicio</label><input type="date" value={s.startDate || ''} onChange={e => safeUpdateSection(specialSections.map(x => x.id === s.id ? { ...x, startDate: e.target.value } : x))} className="w-full bg-black/40 p-2 rounded text-xs" /></div><div className="space-y-1"><label className="text-xs text-gray-400">Fecha Fin</label><input type="date" value={s.endDate || ''} onChange={e => safeUpdateSection(specialSections.map(x => x.id === s.id ? { ...x, endDate: e.target.value } : x))} className="w-full bg-black/40 p-2 rounded text-xs" /></div><div className="space-y-1"><label className="text-xs text-gray-400">D√≠as Aviso</label><input type="number" placeholder="Ej: 5" value={s.warningDays || ''} onChange={e => safeUpdateSection(specialSections.map(x => x.id === s.id ? { ...x, warningDays: e.target.value } : x))} className="w-full bg-black/40 p-2 rounded text-xs" /></div></div><ImageUploader value={s.imageUrl} onChange={v => safeUpdateSection(specialSections.map(x => x.id === s.id ? { ...x, imageUrl: v } : x))} /><ButtonBuilder buttons={s.buttons || []} onChange={btns => safeUpdateSection(specialSections.map(x => x.id === s.id ? { ...x, buttons: btns } : x))} /></div>))}<button onClick={() => { window.setDoc(window.doc(window.db, 'config', 'specialSections'), { sections: specialSections }); alert('Guardado'); }} className="w-full bg-celestial text-black py-3 rounded font-bold">GUARDAR CAMBIOS</button></div>)}
                    </div>
                </Modal>
            );
        };

        const AdminLogin = ({ onClose, onSuccess }) => {
            const [pass, setPass] = useState('');
            const handleLogin = (e) => { e.preventDefault(); if (pass === (localStorage.getItem('liga_password') || '4321')) onSuccess(); else alert('Contrase√±a incorrecta'); };
            return <Modal isOpen={true} onClose={onClose}><div className="p-8 text-center"><h2 className="text-2xl font-bold mb-4">Acceso Admin</h2><form onSubmit={handleLogin}><input type="password" autoFocus className="w-full bg-black/40 border border-white/10 rounded-lg p-3 text-center text-white text-xl tracking-widest mb-4 placeholder-gray-600" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={pass} onChange={e => setPass(e.target.value)} /><div className="flex gap-2 justify-center"><button type="button" onClick={onClose} className="px-4 py-2 text-gray-400">Cancelar</button><button className="px-6 py-2 bg-celestial text-black font-bold rounded-lg hover:opacity-90">Entrar</button></div></form></div></Modal>;
        };

        const EventStatsModal = ({ event, onClose }) => {
            const [regs, setRegs] = useState([]);
            useEffect(() => { const u = window.onSnapshot(window.query(window.collection(window.db, "event_registrations"), window.where("eventId", "==", event.id)), s => setRegs(s.docs.map(d => d.data()))); return () => u(); }, [event.id]);
            const exportToCSV = () => {
                const headers = ["Nombre", "Email", "Comentarios", ...(event.customFields || []).map(f => f.label), "Fecha Registro"];
                const rows = regs.map(r => [r.nombre, r.email, r.comentarios, ...(event.customFields || []).map(f => r[f.label]), r.submittedAt].join("\t"));
                const csv = [headers.join("\t"), ...rows].join("\n");
                const blob = new Blob([csv], { type: 'text/tab-separated-values' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `${event.title}_data.xls`; a.click();
            };
            return (
                <Modal isOpen={true} onClose={onClose} size="lg"><div className="p-8 h-[80vh] flex flex-col">
                    <h2 className="text-2xl font-bold mb-4">Estad√≠sticas: {event.title}</h2>
                    <div className="grid grid-cols-2 gap-4 mb-6">
                        <div className="bg-white/5 p-4 rounded border border-white/10"> <div className="text-sm text-gray-400">Asistentes (Simple)</div> <div className="text-3xl font-bold text-celestial">{event.surveyCount || 0}</div> </div>
                        <div className="bg-white/5 p-4 rounded border border-white/10"> <div className="text-sm text-gray-400">Formularios</div> <div className="text-3xl font-bold text-purple-400">{regs.length}</div> </div>
                    </div>
                    {event.pollCounts && <div className="mb-6"><h3 className="font-bold mb-2 text-gray-400">Votaci√≥n</h3><div className="space-y-2">{Object.entries(event.pollCounts).map(([k, v]) => <div key={k} className="flex justify-between bg-white/5 p-2 rounded"><span>{k}</span><span className="font-bold">{v}</span></div>)}</div></div>}
                    <div className="flex justify-between items-center mb-2"><h3 className="font-bold text-gray-400">Registros</h3><button onClick={exportToCSV} className="text-xs bg-green-600 text-white px-2 py-1 rounded">Exportar Excel</button></div>
                    <div className="flex-1 overflow-auto bg-black/40 rounded p-2 text-xs font-mono whitespace-pre">{regs.map((r, i) => <div key={i} className="mb-1 border-b border-white/5 pb-1">{JSON.stringify(r)}</div>)}</div>
                </div></Modal>
            );
        };

        const EventRegistrationModal = ({ event, onClose }) => {
            const [formData, setFormData] = useState({});
            const handleSubmit = async (e) => { e.preventDefault(); try { await window.addDoc(window.collection(window.db, "event_registrations"), { eventId: event.id, eventTitle: event.title, submittedAt: new Date().toISOString(), ...formData }); alert('¬°Inscripci√≥n Enviada!'); onClose(); } catch (err) { alert('Error al enviar.'); } };
            return <Modal isOpen={true} onClose={onClose}><div className="p-8"><h2 className="text-2xl font-bold mb-4">Inscripci√≥n: {event.title}</h2><form onSubmit={handleSubmit} className="space-y-4">
                <div><label className="block text-sm font-bold text-gray-400 mb-1">Nombre Completo</label><input required className="w-full bg-black/40 p-3 rounded" onChange={e => setFormData({ ...formData, nombre: e.target.value })} /></div>
                <div><label className="block text-sm font-bold text-gray-400 mb-1">Email</label><input required type="email" className="w-full bg-black/40 p-3 rounded" onChange={e => setFormData({ ...formData, email: e.target.value })} /></div>
                {event.customFields?.map(f => (<div key={f.id}><label className="block text-sm font-bold text-gray-400 mb-1">{f.label}</label>{f.type === 'select' ? <select required className="w-full bg-black/40 p-3 rounded" onChange={e => setFormData({ ...formData, [f.label]: e.target.value })}><option value="">Selecciona...</option>{f.options.split(',').map(o => <option key={o} value={o.trim()}>{o.trim()}</option>)}</select> : <input required type={f.type} className="w-full bg-black/40 p-3 rounded" onChange={e => setFormData({ ...formData, [f.label]: e.target.value })} />}</div>))}
                <div><label className="block text-sm font-bold text-gray-400 mb-1">Comentarios</label><textarea className="w-full bg-black/40 p-3 rounded" rows="2" onChange={e => setFormData({ ...formData, comentarios: e.target.value })} /></div>
                <button className="w-full bg-celestial text-black font-bold py-3 rounded mt-4 hover:bg-celestialDark transition-colors">Confirmar Inscripci√≥n</button></form></div></Modal>;
        };

        const renderButtonStyle = (b) => {
            const base = "inline-flex items-center gap-2 px-6 py-3 rounded-full font-bold transition-all hover:scale-105 ";
            if (b.style === 'primary') return base + "bg-celestial text-black hover:shadow-[0_0_20px_rgba(56,189,248,0.4)]";
            if (b.style === 'secondary') return base + "bg-white text-black hover:bg-gray-200";
            if (b.style === 'outline') return base + "border border-white/20 text-white hover:bg-white/10";
            if (b.style === 'gradient') return base + "bg-gradient-to-r from-ligaPrimary to-ligaSecondary text-white shadow-lg";
            return base + "bg-white/10 text-white";
        };

        const EventDetailModal = ({ event, onClose, onOpenForm }) => (
            <Modal isOpen={true} onClose={onClose} size="lg">
                <div className="relative">
                    {event.imageUrl && <div className="w-full h-64 md:h-80"><img src={event.imageUrl} className="w-full h-full object-cover" /></div>}
                    <div className="p-8"><div className="inline-block px-3 py-1 mb-4 rounded-full text-xs font-bold uppercase border" style={{ color: event.typeColor, borderColor: event.typeColor, backgroundColor: `${event.typeColor}20` }}>{event.typeIcon} {event.typeName}</div><h2 className="text-4xl font-black mb-2 text-white leading-tight">{event.title}</h2><div className="flex items-center gap-2 text-celestial font-bold mb-4"><CalendarIcon className="w-5 h-5" /> {new Date(event.date).toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })} {event.time && <span> | {event.time}</span>}</div>{event.location && <div className="flex items-center gap-2 text-gray-400 mb-6"><MapPin className="w-5 h-5" /> {event.location}</div>}<div className="bg-white/5 p-6 rounded-2xl border border-white/10 mb-6"><p className="text-gray-300 leading-relaxed whitespace-pre-wrap">{event.description}</p></div><div className="flex flex-col gap-3"><ActionButton event={event} onOpenForm={onOpenForm} /><a href={`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(event.title)}&dates=${event.date.replace(/-/g, '')}T${event.time ? event.time.replace(':', '') + '00' : '000000'}/${event.date.replace(/-/g, '')}T${event.time ? event.time.replace(':', '') + '00' : '235959'}&details=${encodeURIComponent(event.description)}&location=${encodeURIComponent(event.location)}`} target="_blank" className="w-full py-3 rounded-xl border border-white/20 hover:bg-white/10 flex items-center justify-center gap-2 text-gray-300 transition-colors"><CalendarIcon className="w-5 h-5" /> A√±adir a Google Calendar</a></div></div>
                </div>
            </Modal>
        );

        const SectionDetailModal = ({ section, onClose, onOpenForm }) => (
            <Modal isOpen={true} onClose={onClose} size="lg">
                <div className="relative">
                    {section.imageUrl && <div className="w-full h-64 md:h-80"><img src={section.imageUrl} className="w-full h-full object-cover" /></div>}
                    <div className="p-8">
                        <h2 className="text-4xl font-black mb-4 text-white">{section.title}</h2>
                        <div className="bg-white/5 p-6 rounded-2xl border border-white/10 mb-6"><p className="text-gray-300 leading-relaxed whitespace-pre-wrap">{section.description}</p></div>
                        <div className="flex flex-col gap-3">
                            {section.buttons?.map(b => {
                                const click = (e) => {
                                    e.stopPropagation();
                                    if (b.type === 'form') {
                                        // Open standard form with section as context
                                        onOpenForm({ id: `section_${section.id}_${b.id}`, title: `${section.title} - ${b.label}`, customFields: [] });
                                    } else if (b.type === 'vote') {
                                        const key = `section_vote_${section.id}_${b.id}`;
                                        if (localStorage.getItem(key)) return alert('Ya has votado');
                                        localStorage.setItem(key, 'true');
                                        // Increment firestore counter (just a dummy update for now since we dont have a specific collection for section interaction, but could be added to specialSections array)
                                        alert('Voto registrado (Simulaci√≥n)');
                                    } else {
                                        window.open(b.link, '_blank');
                                    }
                                };
                                return <button key={b.id} onClick={click} className={renderButtonStyle(b) + " justify-center w-full"}>{b.label} {b.type === 'link' && <ExternalLink className="w-5 h-5" />}</button>
                            })}
                            {!section.buttons?.length && section.link && <a href={section.link} target="_blank" className="w-full py-3 rounded-xl bg-celestial text-black font-bold flex items-center justify-center gap-2 hover:bg-celestialDark">{section.linkText || 'Ver M√°s'} <ExternalLink className="w-5 h-5" /></a>}
                        </div>
                    </div>
                </div>
            </Modal>
        );

        function App() {
            const [isAdmin, setIsAdmin] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const [showAdminPanel, setShowAdminPanel] = useState(false);
            const [regFormEvent, setRegFormEvent] = useState(null);
            const [statsEvent, setStatsEvent] = useState(null);
            const [expandedEvent, setExpandedEvent] = useState(null);
            const [expandedSection, setExpandedSection] = useState(null);
            const [events, setEvents] = useState([]);
            const [eventTypes, setEventTypes] = useState(DEFAULT_EVENT_TYPES);
            const [specialSections, setSpecialSections] = useState([]);
            const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());
            const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
            const [selectedDay, setSelectedDay] = useState(null);

            useEffect(() => {
                if (!window.db) return;
                const u1 = window.onSnapshot(window.query(window.collection(window.db, "events"), window.orderBy("date", "asc")), s => setEvents(s.docs.map(d => ({ id: d.id, ...d.data() }))));
                const u2 = window.onSnapshot(window.doc(window.db, "config", "eventTypes"), d => setEventTypes(d.exists() ? (d.data().types || DEFAULT_EVENT_TYPES) : DEFAULT_EVENT_TYPES));
                const u3 = window.onSnapshot(window.doc(window.db, "config", "specialSections"), d => setSpecialSections(d.exists() ? (d.data().sections || []) : []));
                return () => { u1(); u2(); u3(); };
            }, []);

            const monthData = useMemo(() => {
                const dt = new Date(currentYear, currentMonth, 1);
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                const startOff = dt.getDay() === 0 ? 6 : dt.getDay() - 1;
                return { days: Array(startOff).fill(null).concat([...Array(daysInMonth).keys()].map(i => i + 1)), name: dt.toLocaleString('es-ES', { month: 'long' }).toUpperCase() };
            }, [currentMonth, currentYear]);

            const upcoming = events.filter(e => new Date(e.date) >= new Date(new Date().setHours(0, 0, 0, 0)));
            const handleDayNav = (dir) => {
                if (!selectedDay) return;
                const curr = new Date(selectedDay.date);
                curr.setDate(curr.getDate() + dir);
                const dateStr = curr.toISOString().split('T')[0];
                setSelectedDay({ date: dateStr, events: events.filter(e => e.date === dateStr), holiday: HOLIDAYS.find(h => h.date === dateStr) });
            };

            return (
                <div className="min-h-screen flex flex-col relative font-sans">
                    {/* Modals Order Fixed: Calendar (Bottom) -> Sections -> Events -> Admin (Top) */}
                    {selectedDay && (
                        <Modal isOpen={true} onClose={() => setSelectedDay(null)}>
                            <div className="p-8">
                                <div className="flex justify-between items-center mb-6"><button onClick={() => handleDayNav(-1)} className="p-3 bg-white/5 rounded-full hover:bg-white/20"><ChevronLeft className="w-6 h-6" /></button><div className="text-center"><h2 className="text-3xl font-black capitalize">{new Date(selectedDay.date).toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}</h2>{selectedDay.holiday && <div className="inline-block mt-2 px-3 py-1 bg-red-500/20 text-red-300 rounded-lg text-sm font-bold">{selectedDay.holiday.name}</div>}</div><button onClick={() => handleDayNav(1)} className="p-3 bg-white/5 rounded-full hover:bg-white/20"><ChevronRight className="w-6 h-6" /></button></div>
                                <div className="space-y-4">{selectedDay.events.map(evt => (<div key={evt.id} onClick={() => setExpandedEvent(evt)} className="bg-white/5 p-5 rounded-2xl border-l-4 space-y-2 cursor-pointer hover:bg-white/10 transition-colors" style={{ borderColor: evt.typeColor }}><div className="flex justify-between items-start"><div><div className="font-bold text-xl">{evt.title}</div><div className="text-sm opacity-70 flex items-center gap-2">{evt.typeIcon} {evt.typeName}</div></div><button className="text-xs text-celestial border border-celestial px-2 py-1 rounded-full uppercase">Ver Detalle</button></div></div>))}{selectedDay.events.length === 0 && !selectedDay.holiday && <p className="text-center text-gray-500 py-8 italic">No hay eventos.</p>}</div>
                            </div>
                        </Modal>
                    )}
                    {expandedSection && <SectionDetailModal section={expandedSection} onClose={() => setExpandedSection(null)} onOpenForm={(e) => { setExpandedSection(null); setRegFormEvent(e); }} />}
                    {expandedEvent && <EventDetailModal event={expandedEvent} onClose={() => setExpandedEvent(null)} onOpenForm={(e) => { setExpandedEvent(null); setRegFormEvent(e); }} />}
                    {regFormEvent && <EventRegistrationModal event={regFormEvent} onClose={() => setRegFormEvent(null)} />}
                    {statsEvent && <EventStatsModal event={statsEvent} onClose={() => setStatsEvent(null)} />}
                    {showLogin && <AdminLogin onClose={() => setShowLogin(false)} onSuccess={() => { setIsAdmin(true); setShowLogin(false); setShowAdminPanel(true); }} />}
                    {showAdminPanel && <AdminDashboard isOpen={true} onClose={() => setShowAdminPanel(false)} events={events} eventTypes={eventTypes} onOpenStats={setStatsEvent} onSaveEvent={async (data, id) => { const et = eventTypes.find(t => t.id === data.typeId); const ed = { ...data, typeColor: et?.color || '#38bdf8', typeIcon: et?.icon || 'üìå', typeName: et?.name || 'Evento' }; if (id) await window.updateDoc(window.doc(window.db, "events", id), ed); else await window.addDoc(window.collection(window.db, "events"), { ...ed, surveyCount: 0 }); alert('Guardado'); }} onDeleteEvent={id => confirm('¬øEliminar?') && window.deleteDoc(window.doc(window.db, "events", id))} onAddEventType={t => { const u = [...eventTypes, t]; setEventTypes(u); window.setDoc(window.doc(window.db, "config", "eventTypes"), { types: u }) }} onDeleteEventType={id => { const u = eventTypes.filter(t => t.id !== id); setEventTypes(u); window.setDoc(window.doc(window.db, "config", "eventTypes"), { types: u }) }} specialSections={specialSections} onUpdateSpecialSections={setSpecialSections} />}
                    {showAdminPanel && <div className="fixed top-0 left-0 hidden"></div> /* Hack to access stats inside dashboard context if needed, but we pass setStatsEvent via props currently? No, we need to modify AdminDashboard to accept onOpenStats */}

                    <div className="fixed top-4 right-4 z-50 flex gap-2">
                        {isAdmin && <button onClick={() => setShowAdminPanel(true)} className="p-3 bg-celestial text-black rounded-full shadow-lg hover:bg-celestialDark transition-colors"><Settings className="w-5 h-5" /></button>}
                        <button onClick={() => isAdmin ? setIsAdmin(false) : setShowLogin(true)} className={`p-3 rounded-full shadow-lg transition-colors ${isAdmin ? 'bg-red-500 text-white' : 'bg-white/5 text-gray-400 hover:text-white'}`}><Lock className="w-5 h-5" /></button>
                    </div>

                    <section className="min-h-[85vh] flex flex-col items-center justify-center p-6 relative clip-diagonal bg-[#0a0a0f]">
                        <div className="absolute inset-0 bg-celestial/10 blur-[100px] pointer-events-none"></div>
                        <div className="relative w-64 h-64 md:w-80 md:h-80 mb-8 animate-float"><img src="./liga-multisport/logo.png" className="w-full h-full object-contain drop-shadow-[0_0_30px_rgba(56,189,248,0.3)]" /></div>
                        <h1 className="text-5xl md:text-8xl font-black text-center tracking-tighter mb-4"><span className="text-white">PASO DE </span><span className="text-celestial text-glow">ECUADOR</span></h1>
                        <p className="text-xl md:text-2xl text-gray-400 font-light tracking-wide mb-12">INEF 25/26</p>
                        <a href="#events" className="px-8 py-3 rounded-full bg-celestial text-black font-bold text-lg hover:shadow-[0_0_20px_rgba(56,189,248,0.4)] transition-all">Pr√≥ximos Eventos</a>
                    </section>

                    {specialSections.filter(s => {
                        if (!s.active) return false;
                        const now = new Date(); now.setHours(0, 0, 0, 0);
                        if (s.startDate && new Date(s.startDate) > now) return false;
                        if (s.endDate && new Date(s.endDate) < now) return false;
                        return true;
                    }).map(s => {
                        const now = new Date(); now.setHours(0, 0, 0, 0);
                        const end = s.endDate ? new Date(s.endDate) : null;
                        const isLastDays = end && s.warningDays && (end - now) / (1000 * 60 * 60 * 24) <= s.warningDays && (end - now) >= 0;
                        return (
                            <section key={s.id} className="py-12 px-4 md:px-8 max-w-7xl mx-auto w-full">
                                <div className="glass-panel p-8 md:p-12 rounded-3xl border-l-4 border-celestial relative overflow-hidden group cursor-pointer" onClick={() => setExpandedSection(s)}>
                                    {isLastDays && <div className="absolute top-4 right-4 bg-red-500 text-white px-4 py-1 rounded-full text-sm font-bold animate-pulse z-20 shadow-lg border border-red-400">‚ö†Ô∏è √öltimos D√≠as</div>}
                                    {s.imageUrl && <div className="absolute right-0 top-0 bottom-0 w-full md:w-1/3 opacity-20"><img src={s.imageUrl} className="w-full h-full object-cover" /></div>}
                                    <div className="relative z-10 max-w-3xl">
                                        <h2 className="text-4xl font-bold mb-4">{s.title}</h2>
                                        <p className="text-lg text-gray-300 mb-6 whitespace-pre-line line-clamp-3">{s.description}</p>
                                        <div className="flex flex-wrap gap-4">
                                            <button className="inline-flex items-center gap-2 px-6 py-3 rounded-full font-bold bg-celestial text-black hover:bg-celestialDark transition-colors">Ver Completo <ExternalLink className="w-5 h-5" /></button>
                                            {(s.buttons || []).map(b => <button key={b.id} className={renderButtonStyle(b)} onClick={e => { e.stopPropagation(); window.open(b.link, '_blank'); }}>{b.label}</button>)}
                                        </div>
                                    </div>
                                </div>
                            </section>
                        )
                    })}

                    <section id="events" className="py-20 px-4 md:px-8 max-w-7xl mx-auto w-full">
                        <h2 className="text-4xl font-bold mb-12 flex items-center gap-4"><span className="w-2 h-12 bg-celestial rounded-full"></span>Pr√≥ximamente</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {upcoming.map(evt => (
                                <div key={evt.id} onClick={() => setExpandedEvent(evt)} className="glass-panel p-6 rounded-3xl hover:bg-[#1c1c2e] transition-all group relative overflow-hidden flex flex-col cursor-pointer transform hover:-translate-y-2 hover:shadow-2xl hover:shadow-celestial/10">
                                    <div className="absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-bold uppercase border bg-black/50 backdrop-blur-md z-10" style={{ color: evt.typeColor, borderColor: evt.typeColor }}>{evt.typeIcon} {evt.typeName}</div>
                                    {evt.imageUrl && <div className="w-full h-48 mb-4 rounded-xl overflow-hidden"><img src={evt.imageUrl} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" /></div>}
                                    <div className="text-celestial font-bold tracking-wider text-sm mb-2">{new Date(evt.date).toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric', month: 'short' })} {evt.time && <span>‚Ä¢ {evt.time}</span>}</div>
                                    <h3 className="text-2xl font-bold text-white mb-2 leading-tight">{evt.title}</h3>
                                    {evt.location && <div className="flex items-center gap-2 text-gray-400 text-sm mb-3"><MapPin className="w-4 h-4" /> {evt.location}</div>}
                                    {evt.description && <p className="text-gray-400 text-sm mb-4 line-clamp-3">{evt.description}</p>}
                                    <div className="mt-auto" onClick={e => e.stopPropagation()}><ActionButton event={evt} onOpenForm={setRegFormEvent} /></div>
                                </div>
                            ))}
                        </div>
                    </section>

                    <div className="relative py-32 bg-[#050507]">
                        <div className="absolute inset-x-0 top-0 h-32 bg-gradient-to-b from-[#0a0a0f] to-[#050507]"></div>
                        <section className="relative z-10 max-w-7xl mx-auto px-6 grid md:grid-cols-2 gap-12 items-center"><div><h2 className="text-5xl md:text-7xl font-black mb-6 tracking-tighter"><span className="bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">LIGA</span><br /><span className="bg-gradient-to-r from-ligaPrimary to-ligaSecondary bg-clip-text text-transparent drop-shadow-[0_0_15px_rgba(99,102,241,0.5)]">MULTISPORT</span></h2><p className="text-gray-400 text-lg mb-8 leading-relaxed max-w-md">Compite en torneos, acumula puntos y lidera el ranking anual.</p><a href="./liga-multisport/index.html" className="inline-flex items-center gap-3 px-8 py-4 rounded-full bg-gradient-to-r from-ligaPrimary to-ligaSecondary text-white font-black text-xl hover:scale-105 transition-transform shadow-[0_0_30px_rgba(236,72,153,0.4)]">VER CLASIFICACI√ìN <ExternalLink className="w-6 h-6" /></a></div><div className="relative group"><div className="absolute inset-0 bg-gradient-to-r from-ligaPrimary to-ligaSecondary blur-[60px] opacity-20 group-hover:opacity-40 transition-opacity"></div><div className="glass-panel p-6 rounded-3xl border-t border-white/10 transform rotate-[-3deg] group-hover:rotate-0 transition-all duration-500 md:translate-x-12"><div className="flex items-center gap-4 mb-4 border-b border-white/10 pb-4"><div className="w-10 h-10 rounded-full bg-gradient-to-br from-yellow-400 to-orange-600 flex items-center justify-center font-bold text-black border-2 border-yellow-200">#1</div><div><div className="text-sm text-gray-400">L√≠der Actual</div><div className="font-bold text-xl">Tu Nombre Aqu√≠</div></div></div><div className="space-y-3 opacity-50"><div className="h-4 bg-white/20 rounded w-3/4"></div><div className="h-4 bg-white/20 rounded w-full"></div></div></div></div></section><div className="absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-[#0a0a0f] to-[#050507]"></div>
                    </div>

                    <section className="py-20 px-4 md:px-8 max-w-5xl mx-auto w-full">
                        <div className="glass-panel p-8 rounded-[2.5rem]">
                            <div className="flex justify-between items-center mb-8"><h2 className="text-3xl font-bold uppercase tracking-widest text-celestial">{monthData.name} <span className="text-white/30">{currentYear}</span></h2><div className="flex gap-2"><button onClick={() => { if (currentMonth === 0) { setCurrentMonth(11); setCurrentYear(currentYear - 1); } else { setCurrentMonth(currentMonth - 1); } }} className="p-2 bg-white/5 hover:bg-white/10 rounded-lg transition-colors"><ChevronLeft className="w-6 h-6" /></button><button onClick={() => { if (currentMonth === 11) { setCurrentMonth(0); setCurrentYear(currentYear + 1); } else { setCurrentMonth(currentMonth + 1); } }} className="p-2 bg-white/5 hover:bg-white/10 rounded-lg transition-colors"><ChevronRight className="w-6 h-6" /></button></div></div>
                            <div className="grid grid-cols-7 gap-2 md:gap-4 text-center">
                                {['L', 'M', 'X', 'J', 'V', 'S', 'D'].map(d => <div key={d} className="font-bold text-gray-500 py-2">{d}</div>)}
                                {monthData.days.map((d, i) => {
                                    if (!d) return <div key={i}></div>;
                                    const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                                    const dayEvents = events.filter(e => e.date === dateStr);
                                    const holiday = HOLIDAYS.find(h => h.date === dateStr);
                                    const isWeekend = [0, 6].includes(new Date(currentYear, currentMonth, d).getDay());
                                    // NEW: Icons overlay at top-right
                                    const uniqueIcons = [...new Set(dayEvents.map(e => e.typeIcon))].slice(0, 3);

                                    return (
                                        <div key={i} onClick={() => setSelectedDay({ date: dateStr, events: dayEvents, holiday })} className={`aspect-square flex flex-col items-center justify-start pt-2 rounded-xl text-lg font-bold relative group transition-all cursor-pointer border border-transparent ${holiday ? 'bg-red-500/10 text-red-400 border-red-500/20' : isWeekend ? 'bg-blue-500/10 text-blue-300' : 'hover:bg-white/5 text-gray-300'} ${dayEvents.length > 0 ? 'ring-1 ring-celestial/50 bg-celestial/5' : ''}`}>
                                            {d}
                                            {/* Icons Overlay */}
                                            <div className="absolute top-1 right-1 flex gap-0.5">{uniqueIcons.map((ic, ix) => <span key={ix} className="text-[10px] leading-none">{ic}</span>)}</div>
                                            {/* Pills (Text only now, smaller) */}
                                            <div className="flex flex-col gap-1 w-full px-1 mt-auto pb-1">{dayEvents.slice(0, 3).map((evt, idx) => (<div key={idx} className="h-1.5 md:h-5 md:px-2 md:py-0.5 rounded-full text-[10px] uppercase tracking-wider font-bold truncate w-full text-left flex items-center" style={{ backgroundColor: evt.typeColor, color: '#000' }} title={evt.title}><span className="hidden md:inline">{evt.title}</span></div>))}</div>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>
                    </section>

                    <footer className="mt-auto py-12 border-t border-white/5 bg-[#050507]"><div className="flex flex-col items-center gap-8"><div className="flex gap-6"><a href="https://www.instagram.com/pasoecuadorinef26/" target="_blank" className="p-4 bg-white/5 rounded-full hover:bg-gradient-to-br hover:from-purple-600 hover:to-orange-500 transition-all hover:scale-110"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="20" x="2" y="2" rx="5" ry="5" /><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" /><line x1="17.5" x2="17.51" y1="6.5" y2="6.5" /></svg></a><a href="https://www.tiktok.com/@pasoecuadorinef26" target="_blank" className="p-4 bg-white/5 rounded-full hover:bg-black hover:border hover:border-celestial hover:text-celestial transition-all hover:scale-110"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 12a4 4 0 1 0 4 4V4a5 5 0 0 0 5 5" /></svg></a></div><div className="text-gray-600 text-sm">¬© 2025 Paso de Ecuador INEF 25/26</div></div></footer>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root')); root.render(<App />);
    </script>
</body>

</html>
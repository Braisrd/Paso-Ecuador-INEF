var t={};const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const e=t[s],i=s+1<t.length,o=i?t[s+1]:0,a=s+2<t.length,c=a?t[s+2]:0,u=e>>2,l=(3&e)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<t.length;){const e=n[t.charAt(i++)],o=i<t.length?n[t.charAt(i)]:0;++i;const a=i<t.length?n[t.charAt(i)]:64;++i;const c=i<t.length?n[t.charAt(i)]:64;if(++i,null==e||null==o||null==a||null==c)throw new r;const u=e<<2|o>>4;if(s.push(u),64!==a){const t=o<<4&240|a>>2;if(s.push(t),64!==c){const t=a<<6&192|c;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(t){return function(t){const r=e(t);return n.encodeByteArray(r,!0)}(t).replace(/\./g,"")};const i=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,o=()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(r){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(r){console.error("base64Decode failed: ",r)}return null}(t[1]);return e&&JSON.parse(e)},a=()=>{try{return i()||(()=>{if("undefined"==typeof process)return;const e=t.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||o()}catch(e){return void"Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e)}},c=t=>{const e=(t=>{var e,n;return null==(n=null==(e=a())?void 0:e.emulatorHosts)?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error("Invalid host ".concat(e," with no separate hostname and port!"));const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]},u=()=>{var t;return null==(t=a())?void 0:t.config};class l{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch(()=>{}),1===t.length?t(e):t(e,n))}}}function h(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function d(t){return(await fetch(t,{credentials:"include"})).ok}function f(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}const p={};let g=!1;function m(t,e){if("undefined"==typeof window||"undefined"==typeof document||!h(window.location.host)||p[t]===e||p[t]||g)return;function n(t){return"__firebase__banner__".concat(t)}p[t]=e;const r="__firebase__banner",s=function(){const t={prod:[],emulator:[]};for(const e of Object.keys(p))p[e]?t.emulator.push(e):t.prod.push(e);return t}().prod.length>0;function i(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{g=!0,function(){const t=document.getElementById(r);t&&t.remove()}()},t}function o(){const t=function(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}(r),e=n("text"),o=document.getElementById(e)||document.createElement("span"),a=n("learnmore"),c=document.getElementById(a)||document.createElement("a"),u=n("preprendIcon"),l=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;!function(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}(e),function(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}(c,a);const n=i();!function(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}(l,u),e.append(l,o,c,n),document.body.appendChild(e)}s?(o.innerText="Preview backend disconnected.",l.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(l.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}function y(){return!function(){var t;const e=null==(t=a())?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(n){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function v(){try{return"object"==typeof indexedDB}catch(t){return!1}}function w(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null==(t=s.error)?void 0:t.message)||"")}}catch(n){e(n)}})}class _ extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,_.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,b.prototype.create)}}class b{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r="".concat(this.service,"/").concat(t),s=this.errors[t],i=s?function(t,e){return t.replace(E,(t,n)=>{const r=e[n];return null!=r?String(r):"<".concat(n,"?>")})}(s,n):"Error",o="".concat(this.serviceName,": ").concat(i," (").concat(r,").");return new _(r,o,n)}}const E=/\{\$([^}]+)}/g;function T(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(I(n)&&I(i)){if(!T(n,i))return!1}else if(n!==i)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function I(t){return null!==t&&"object"==typeof t}function S(t){return t&&t._delegate?t._delegate:t}class C{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const A="[DEFAULT]";class k{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new l;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(n){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!=(e=null==t?void 0:t.optional)&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error("Mismatching Component ".concat(t.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:A})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:r});n.resolve(t)}catch(e){}}}}clearInstance(t=A){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...t.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return null!=this.component}isInitialized(t=A){return this.instances.has(t)}getOptions(t=A){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[s,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&i.resolve(r)}return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!=(n=this.onInitCallbacks.get(r))?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch(r){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===A?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(s){}var r;return n||null}normalizeInstanceIdentifier(t=A){return this.component?this.component.multipleInstances?t:A:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class D{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component ".concat(t.name," has already been registered with ").concat(this.name));e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new k(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var N,R;(R=N||(N={}))[R.DEBUG=0]="DEBUG",R[R.VERBOSE=1]="VERBOSE",R[R.INFO=2]="INFO",R[R.WARN=3]="WARN",R[R.ERROR=4]="ERROR",R[R.SILENT=5]="SILENT";const O={debug:N.DEBUG,verbose:N.VERBOSE,info:N.INFO,warn:N.WARN,error:N.ERROR,silent:N.SILENT},x=N.INFO,M={[N.DEBUG]:"log",[N.VERBOSE]:"log",[N.INFO]:"info",[N.WARN]:"warn",[N.ERROR]:"error"},L=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),s=M[e];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(e,")"));console[s]("[".concat(r,"]  ").concat(t.name,":"),...n)};class P{constructor(t){this.name=t,this._logLevel=x,this._logHandler=L,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in N))throw new TypeError('Invalid value "'.concat(t,'" assigned to `logLevel`'));this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?O[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,N.DEBUG,...t),this._logHandler(this,N.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,N.VERBOSE,...t),this._logHandler(this,N.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,N.INFO,...t),this._logHandler(this,N.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,N.WARN,...t),this._logHandler(this,N.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,N.ERROR,...t),this._logHandler(this,N.ERROR,...t)}}let V,F;const U=new WeakMap,j=new WeakMap,B=new WeakMap,q=new WeakMap,z=new WeakMap;let K={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return j.get(t);if("objectStoreNames"===e)return t.objectStoreNames||B.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Q(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function G(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(F||(F=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(W(this),e),Q(U.get(this))}:function(...e){return Q(t.apply(W(this),e))}:function(e,...n){const r=t.call(W(this),e,...n);return B.set(r,e.sort?e.sort():[e]),Q(r)}}function H(t){return"function"==typeof t?G(t):(t instanceof IDBTransaction&&function(t){if(j.has(t))return;const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)});j.set(t,e)}(t),e=t,(V||(V=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(t,K):t);var e}function Q(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(Q(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)});return e.then(e=>{e instanceof IDBCursor&&U.set(e,t)}).catch(()=>{}),z.set(e,t),e}(t);if(q.has(t))return q.get(t);const e=H(t);return e!==t&&(q.set(t,e),z.set(e,t)),e}const W=t=>z.get(t);function X(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=Q(o);return r&&o.addEventListener("upgradeneeded",t=>{r(Q(o.result),t.oldVersion,t.newVersion,Q(o.transaction),t)}),n&&o.addEventListener("blocked",t=>n(t.oldVersion,t.newVersion,t)),a.then(t=>{i&&t.addEventListener("close",()=>i()),s&&t.addEventListener("versionchange",t=>s(t.oldVersion,t.newVersion,t))}).catch(()=>{}),a}function Y(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",t=>e(t.oldVersion,t)),Q(n).then(()=>{})}const J=["get","getKey","getAll","getAllKeys","count"],Z=["put","add","delete","clear"],$=new Map;function tt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if($.get(e))return $.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=Z.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!J.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&i.done]))[0]};return $.set(e,i),i}K=(t=>({...t,get:(e,n,r)=>tt(e,n)||t.get(e,n,r),has:(e,n)=>!!tt(e,n)||t.has(e,n)}))(K);class et{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return"".concat(e.library,"/").concat(e.version)}return null}).filter(t=>t).join(" ")}}const nt="@firebase/app",rt="0.14.6",st=new P("@firebase/app"),it="@firebase/app-compat",ot="@firebase/analytics-compat",at="@firebase/analytics",ct="@firebase/app-check-compat",ut="@firebase/app-check",lt="@firebase/auth",ht="@firebase/auth-compat",dt="@firebase/database",ft="@firebase/data-connect",pt="@firebase/database-compat",gt="@firebase/functions",mt="@firebase/functions-compat",yt="@firebase/installations",vt="@firebase/installations-compat",wt="@firebase/messaging",_t="@firebase/messaging-compat",bt="@firebase/performance",Et="@firebase/performance-compat",Tt="@firebase/remote-config",It="@firebase/remote-config-compat",St="@firebase/storage",Ct="@firebase/storage-compat",At="@firebase/firestore",kt="@firebase/ai",Dt="@firebase/firestore-compat",Nt="firebase",Rt="[DEFAULT]",Ot={[nt]:"fire-core",[it]:"fire-core-compat",[at]:"fire-analytics",[ot]:"fire-analytics-compat",[ut]:"fire-app-check",[ct]:"fire-app-check-compat",[lt]:"fire-auth",[ht]:"fire-auth-compat",[dt]:"fire-rtdb",[ft]:"fire-data-connect",[pt]:"fire-rtdb-compat",[gt]:"fire-fn",[mt]:"fire-fn-compat",[yt]:"fire-iid",[vt]:"fire-iid-compat",[wt]:"fire-fcm",[_t]:"fire-fcm-compat",[bt]:"fire-perf",[Et]:"fire-perf-compat",[Tt]:"fire-rc",[It]:"fire-rc-compat",[St]:"fire-gcs",[Ct]:"fire-gcs-compat",[At]:"fire-fst",[Dt]:"fire-fst-compat",[kt]:"fire-vertex","fire-js":"fire-js",[Nt]:"fire-js-all"},xt=new Map,Mt=new Map,Lt=new Map;function Pt(t,e){try{t.container.addComponent(e)}catch(n){st.debug("Component ".concat(e.name," failed to register with FirebaseApp ").concat(t.name),n)}}function Vt(t){const e=t.name;if(Lt.has(e))return st.debug("There were multiple attempts to register component ".concat(e,".")),!1;Lt.set(e,t);for(const n of xt.values())Pt(n,t);for(const n of Mt.values())Pt(n,t);return!0}function Ft(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Ut(t){return null!=t&&void 0!==t.settings}const jt=new b("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Bt{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new C("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw jt.create("app-deleted",{appName:this._name})}}const qt="12.6.0";function zt(t,e={}){let n=t;if("object"!=typeof e){e={name:e}}const r={name:Rt,automaticDataCollectionEnabled:!0,...e},s=r.name;if("string"!=typeof s||!s)throw jt.create("bad-app-name",{appName:String(s)});if(n||(n=u()),!n)throw jt.create("no-options");const i=xt.get(s);if(i){if(T(n,i.options)&&T(r,i.config))return i;throw jt.create("duplicate-app",{appName:s})}const o=new D(s);for(const c of Lt.values())o.addComponent(c);const a=new Bt(n,r,o);return xt.set(s,a),a}function Kt(t=Rt){const e=xt.get(t);if(!e&&t===Rt&&u())return zt();if(!e)throw jt.create("no-app",{appName:t});return e}function Gt(t,e,n){var r;let s=null!=(r=Ot[t])?r:t;n&&(s+="-".concat(n));const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const t=['Unable to register library "'.concat(s,'" with version "').concat(e,'":')];return i&&t.push('library name "'.concat(s,'" contains illegal characters (whitespace or "/")')),i&&o&&t.push("and"),o&&t.push('version name "'.concat(e,'" contains illegal characters (whitespace or "/")')),void st.warn(t.join(" "))}Vt(new C("".concat(s,"-version"),()=>({library:s,version:e}),"VERSION"))}const Ht="firebase-heartbeat-store";let Qt=null;function Wt(){return Qt||(Qt=X("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(Ht)}catch(n){console.warn(n)}}}).catch(t=>{throw jt.create("idb-open",{originalErrorMessage:t.message})})),Qt}async function Xt(t,e){try{const n=(await Wt()).transaction(Ht,"readwrite"),r=n.objectStore(Ht);await r.put(e,Yt(t)),await n.done}catch(n){if(n instanceof _)st.warn(n.message);else{const t=jt.create("idb-set",{originalErrorMessage:null==n?void 0:n.message});st.warn(t.message)}}}function Yt(t){return"".concat(t.name,"!").concat(t.options.appId)}class Jt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new $t(e),this._heartbeatsCachePromise=this._storage.read().then(t=>(this._heartbeatsCache=t,t))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Zt();if(null==(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(t=>t.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){st.warn(n)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Zt(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const s of t){const t=n.find(t=>t.agent===s.agent);if(t){if(t.dates.push(s.date),te(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),te(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=s(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return st.warn(e),""}}}function Zt(){return(new Date).toISOString().substring(0,10)}class $t{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!v()&&w().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Wt()).transaction(Ht),n=await e.objectStore(Ht).get(Yt(t));return await e.done,n}catch(e){if(e instanceof _)st.warn(e.message);else{const t=jt.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});st.warn(t.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Xt(this.app,{lastSentHeartbeatDate:null!=(e=t.lastSentHeartbeatDate)?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Xt(this.app,{lastSentHeartbeatDate:null!=(e=t.lastSentHeartbeatDate)?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function te(t){return s(JSON.stringify({version:2,heartbeats:t})).length}var ee;ee="",Vt(new C("platform-logger",t=>new et(t),"PRIVATE")),Vt(new C("heartbeat",t=>new Jt(t),"PRIVATE")),Gt(nt,rt,ee),Gt(nt,rt,"esm2020"),Gt("fire-js","");Gt("firebase","12.6.0","app");var ne,re,se="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(t,e,n){n||(n=0);const r=Array(16);if("string"==typeof e)for(var s=0;s<16;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;s<16;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];let i,o=t.g[3];i=e+(o^n&(s^o))+r[0]+3614090360&4294967295,i=o+(s^(e=n+(i<<7&4294967295|i>>>25))&(n^s))+r[1]+3905402710&4294967295,o=e+(i<<12&4294967295|i>>>20),i=s+(n^o&(e^n))+r[2]+606105819&4294967295,i=n+(e^(s=o+(i<<17&4294967295|i>>>15))&(o^e))+r[3]+3250441966&4294967295,i=e+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[4]+4118548399&4294967295,i=o+(s^(e=n+(i<<7&4294967295|i>>>25))&(n^s))+r[5]+1200080426&4294967295,o=e+(i<<12&4294967295|i>>>20),i=s+(n^o&(e^n))+r[6]+2821735955&4294967295,i=n+(e^(s=o+(i<<17&4294967295|i>>>15))&(o^e))+r[7]+4249261313&4294967295,i=e+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[8]+1770035416&4294967295,i=o+(s^(e=n+(i<<7&4294967295|i>>>25))&(n^s))+r[9]+2336552879&4294967295,o=e+(i<<12&4294967295|i>>>20),i=s+(n^o&(e^n))+r[10]+4294925233&4294967295,i=n+(e^(s=o+(i<<17&4294967295|i>>>15))&(o^e))+r[11]+2304563134&4294967295,i=e+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[12]+1804603682&4294967295,i=o+(s^(e=n+(i<<7&4294967295|i>>>25))&(n^s))+r[13]+4254626195&4294967295,o=e+(i<<12&4294967295|i>>>20),i=s+(n^o&(e^n))+r[14]+2792965006&4294967295,i=n+(e^(s=o+(i<<17&4294967295|i>>>15))&(o^e))+r[15]+1236535329&4294967295,i=e+(s^o&((n=s+(i<<22&4294967295|i>>>10))^s))+r[1]+4129170786&4294967295,i=o+(n^s&((e=n+(i<<5&4294967295|i>>>27))^n))+r[6]+3225465664&4294967295,o=e+(i<<9&4294967295|i>>>23),i=s+(e^n&(o^e))+r[11]+643717713&4294967295,i=n+(o^e&((s=o+(i<<14&4294967295|i>>>18))^o))+r[0]+3921069994&4294967295,i=e+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[5]+3593408605&4294967295,i=o+(n^s&((e=n+(i<<5&4294967295|i>>>27))^n))+r[10]+38016083&4294967295,o=e+(i<<9&4294967295|i>>>23),i=s+(e^n&(o^e))+r[15]+3634488961&4294967295,i=n+(o^e&((s=o+(i<<14&4294967295|i>>>18))^o))+r[4]+3889429448&4294967295,i=e+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[9]+568446438&4294967295,i=o+(n^s&((e=n+(i<<5&4294967295|i>>>27))^n))+r[14]+3275163606&4294967295,o=e+(i<<9&4294967295|i>>>23),i=s+(e^n&(o^e))+r[3]+4107603335&4294967295,i=n+(o^e&((s=o+(i<<14&4294967295|i>>>18))^o))+r[8]+1163531501&4294967295,i=e+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[13]+2850285829&4294967295,i=o+(n^s&((e=n+(i<<5&4294967295|i>>>27))^n))+r[2]+4243563512&4294967295,o=e+(i<<9&4294967295|i>>>23),i=s+(e^n&(o^e))+r[7]+1735328473&4294967295,i=n+(o^e&((s=o+(i<<14&4294967295|i>>>18))^o))+r[12]+2368359562&4294967295,i=e+((n=s+(i<<20&4294967295|i>>>12))^s^o)+r[5]+4294588738&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^s)+r[8]+2272392833&4294967295,o=e+(i<<11&4294967295|i>>>21),i=s+(o^e^n)+r[11]+1839030562&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^e)+r[14]+4259657740&4294967295,i=e+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[1]+2763975236&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^s)+r[4]+1272893353&4294967295,o=e+(i<<11&4294967295|i>>>21),i=s+(o^e^n)+r[7]+4139469664&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^e)+r[10]+3200236656&4294967295,i=e+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[13]+681279174&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^s)+r[0]+3936430074&4294967295,o=e+(i<<11&4294967295|i>>>21),i=s+(o^e^n)+r[3]+3572445317&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^e)+r[6]+76029189&4294967295,i=e+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[9]+3654602809&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^s)+r[12]+3873151461&4294967295,o=e+(i<<11&4294967295|i>>>21),i=s+(o^e^n)+r[15]+530742520&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^e)+r[2]+3299628645&4294967295,i=e+(s^((n=s+(i<<23&4294967295|i>>>9))|~o))+r[0]+4096336452&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~s))+r[7]+1126891415&4294967295,o=e+(i<<10&4294967295|i>>>22),i=s+(e^(o|~n))+r[14]+2878612391&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~e))+r[5]+4237533241&4294967295,i=e+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[12]+1700485571&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~s))+r[3]+2399980690&4294967295,o=e+(i<<10&4294967295|i>>>22),i=s+(e^(o|~n))+r[10]+4293915773&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~e))+r[1]+2240044497&4294967295,i=e+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[8]+1873313359&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~s))+r[15]+4264355552&4294967295,o=e+(i<<10&4294967295|i>>>22),i=s+(e^(o|~n))+r[6]+2734768916&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~e))+r[13]+1309151649&4294967295,i=e+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[4]+4149444226&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~s))+r[11]+3174756917&4294967295,o=e+(i<<10&4294967295|i>>>22),i=s+(e^(o|~n))+r[2]+718787259&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(i<<21&4294967295|i>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+o&4294967295}function r(t,e){this.h=e;const n=[];let r=!0;for(let s=t.length-1;s>=0;s--){const i=0|t[s];r&&i==e||(n[s]=i,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.F=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.D=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}(e,function(){this.blockSize=-1}),e.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.v=function(t,e){void 0===e&&(e=t.length);const r=e-this.blockSize,s=this.C;let i=this.h,o=0;for(;o<e;){if(0==i)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(s[i++]=t.charCodeAt(o++),i==this.blockSize){n(this,s),i=0;break}}else for(;o<e;)if(s[i++]=t[o++],i==this.blockSize){n(this,s),i=0;break}}this.h=i,this.o+=e},e.prototype.A=function(){var t=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;e=8*this.o;for(var n=t.length-8;n<t.length;++n)t[n]=255&e,e/=256;for(this.v(t),t=Array(16),e=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)t[e++]=this.g[n]>>>r&255;return t};var s={};function i(t){return-128<=t&&t<128?function(t,e){var n=s;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(t){return new r([0|t],t<0?-1:0)}):new r([0|t],t<0?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(t<0)return d(o(-t));const e=[];let n=1;for(let r=0;t>=n;r++)e[r]=t/n|0,n*=4294967296;return new r(e,0)}var a=i(0),c=i(1),u=i(16777216);function l(t){if(0!=t.h)return!1;for(let e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function h(t){return-1==t.h}function d(t){const e=t.g.length,n=[];for(let r=0;r<e;r++)n[r]=~t.g[r];return new r(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function p(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function g(t,e){this.g=t,this.h=e}function m(t,e){if(l(e))throw Error("division by zero");if(l(t))return new g(a,a);if(h(t))return e=m(d(t),e),new g(d(e.g),d(e.h));if(h(e))return e=m(t,d(e)),new g(d(e.g),e.h);if(t.g.length>30){if(h(t)||h(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=e;r.l(t)<=0;)n=y(n),r=y(r);var s=v(n,1),i=v(r,1);for(r=v(r,2),n=v(n,2);!l(r);){var u=i.add(r);u.l(t)<=0&&(s=s.add(n),i=u),r=v(r,1),n=v(n,1)}return e=f(t,s.j(e)),new g(s,e)}for(s=a;t.l(e)>=0;){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),u=(i=o(n)).j(e);h(u)||u.l(t)>0;)u=(i=o(n-=r)).j(e);l(i)&&(i=c),s=s.add(i),t=f(t,u)}return new g(s,t)}function y(t){const e=t.g.length+1,n=[];for(let r=0;r<e;r++)n[r]=t.i(r)<<1|t.i(r-1)>>>31;return new r(n,t.h)}function v(t,e){const n=e>>5;e%=32;const s=t.g.length-n,i=[];for(let r=0;r<s;r++)i[r]=e>0?t.i(r+n)>>>e|t.i(r+n+1)<<32-e:t.i(r+n);return new r(i,t.h)}(t=r.prototype).m=function(){if(h(this))return-d(this).m();let t=0,e=1;for(let n=0;n<this.g.length;n++){const r=this.i(n);t+=(r>=0?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if(l(this))return"0";if(h(this))return"-"+d(this).toString(t);const e=o(Math.pow(t,6));var n=this;let r="";for(;;){const s=m(n,e).g;let i=(((n=f(n,s.j(e))).g.length>0?n.g[0]:n.h)>>>0).toString(t);if(l(n=s))return i+r;for(;i.length<6;)i="0"+i;r=i+r}},t.i=function(t){return t<0?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return h(t=f(this,t))?-1:l(t)?0:1},t.abs=function(){return h(this)?d(this):this},t.add=function(t){const e=Math.max(this.g.length,t.g.length),n=[];let s=0;for(let r=0;r<=e;r++){let e=s+(65535&this.i(r))+(65535&t.i(r)),i=(e>>>16)+(this.i(r)>>>16)+(t.i(r)>>>16);s=i>>>16,e&=65535,i&=65535,n[r]=i<<16|e}return new r(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(l(this)||l(t))return a;if(h(this))return h(t)?d(this).j(d(t)):d(d(this).j(t));if(h(t))return d(this.j(d(t)));if(this.l(u)<0&&t.l(u)<0)return o(this.m()*t.m());const e=this.g.length+t.g.length,n=[];for(var s=0;s<2*e;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(let e=0;e<t.g.length;e++){const r=this.i(s)>>>16,i=65535&this.i(s),o=t.i(e)>>>16,a=65535&t.i(e);n[2*s+2*e]+=i*a,p(n,2*s+2*e),n[2*s+2*e+1]+=r*a,p(n,2*s+2*e+1),n[2*s+2*e+1]+=i*o,p(n,2*s+2*e+1),n[2*s+2*e+2]+=r*o,p(n,2*s+2*e+2)}for(t=0;t<e;t++)n[t]=n[2*t+1]<<16|n[2*t];for(t=e;t<2*e;t++)n[t]=0;return new r(n,0)},t.B=function(t){return m(this,t).h},t.and=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)&t.i(r);return new r(n,this.h&t.h)},t.or=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)|t.i(r);return new r(n,this.h|t.h)},t.xor=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)^t.i(r);return new r(n,this.h^t.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,re=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=o(Math.pow(n,8));let s=a;for(let a=0;a<e.length;a+=8){var i=Math.min(8,e.length-a);const t=parseInt(e.substring(a,a+i),n);i<8?(i=o(Math.pow(n,i)),s=s.j(i).add(o(t))):(s=s.j(r),s=s.add(o(t)))}return s},ne=r}).apply(void 0!==se?se:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var ie,oe,ae,ce,ue,le,he,de,fe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var t,e=Object.defineProperty;var n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof fe&&fe];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(t,r){if(r)t:{var s=n;t=t.split(".");for(var i=0;i<t.length-1;i++){var o=t[i];if(!(o in s))break t;s=s[o]}(r=r(i=s[t=t[t.length-1]]))!=i&&null!=r&&e(s,t,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",function(t){return t||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(t){return t||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(t){return t||function(t){var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push([e,t[e]]);return n}});var s=s||{},i=this||self;function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){return(c=a).apply(null,arguments)}function u(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function l(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Ob=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}var h="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?t=>t&&AsyncContext.Snapshot.wrap(t):t=>t;function d(t){const e=t.length;if(e>0){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function f(t,e){for(let r=1;r<arguments.length;r++){const e=arguments[r];var n=typeof e;if("array"==(n="object"!=n?n:e?Array.isArray(e)?"array":n:"null")||"object"==n&&"number"==typeof e.length){n=t.length||0;const r=e.length||0;t.length=n+r;for(let s=0;s<r;s++)t[n+s]=e[s]}else t.push(e)}}function p(t){i.setTimeout(()=>{throw t},0)}function g(){var t=_;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var m=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return this.h>0?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new y,t=>t.reset());class y{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let v,w=!1,_=new class{constructor(){this.h=this.g=null}add(t,e){const n=m.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},b=()=>{const t=Promise.resolve(void 0);v=()=>{t.then(E)}};function E(){for(var t;t=g();){try{t.h.call(t.g)}catch(n){p(n)}var e=m;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}w=!1}function T(){this.u=this.u,this.C=this.C}function I(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},I.prototype.h=function(){this.defaultPrevented=!0};var S=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};i.addEventListener("test",t,e),i.removeEventListener("test",t,e)}catch(n){}return t}();function C(t){return/^[\s\xa0]*$/.test(t)}function A(t,e){I.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t&&this.init(t,e)}l(A,I),A.prototype.init=function(t,e){const n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;this.target=t.target||t.srcElement,this.g=e,(e=t.relatedTarget)||("mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement)),this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=t.pointerType,this.state=t.state,this.i=t,t.defaultPrevented&&A.Z.h.call(this)},A.prototype.h=function(){A.Z.h.call(this);const t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var k="closure_listenable_"+(1e6*Math.random()|0),D=0;function N(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=s,this.key=++D,this.da=this.fa=!1}function R(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function O(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function x(t){const e={};for(const n in t)e[n]=t[n];return e}const M="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function L(t,e){let n,r;for(let s=1;s<arguments.length;s++){for(n in r=arguments[s],r)t[n]=r[n];for(let e=0;e<M.length;e++)n=M[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function P(t){this.src=t,this.g={},this.h=0}function V(t,e){const n=e.type;if(n in t.g){var r,s=t.g[n],i=Array.prototype.indexOf.call(s,e,void 0);(r=i>=0)&&Array.prototype.splice.call(s,i,1),r&&(R(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function F(t,e,n,r){for(let s=0;s<t.length;++s){const i=t[s];if(!i.da&&i.listener==e&&i.capture==!!n&&i.ha==r)return s}return-1}P.prototype.add=function(t,e,n,r,s){const i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);const o=F(t,e,r,s);return o>-1?(e=t[o],n||(e.fa=!1)):((e=new N(e,this.src,i,!!r,s)).fa=n,t.push(e)),e};var U="closure_lm_"+(1e6*Math.random()|0),j={};function B(t,e,n,r,s){if(Array.isArray(e)){for(let i=0;i<e.length;i++)B(t,e[i],n,r,s);return null}return n=W(n),t&&t[k]?t.J(e,n,!!o(r)&&!!r.capture,s):function(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");const a=o(s)?!!s.capture:!!s;let c=H(t);if(c||(t[U]=c=new P(t)),n=c.add(e,n,r,a,i),n.proxy)return n;if(r=function(){function t(n){return e.call(t.src,t.listener,n)}const e=G;return t}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)S||(s=a),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(K(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}(t,e,n,!1,r,s)}function q(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)q(t,e[i],n,r,s);else r=o(r)?!!r.capture:!!r,n=W(n),t&&t[k]?(t=t.i,(i=String(e).toString())in t.g&&((n=F(e=t.g[i],n,r,s))>-1&&(R(e[n]),Array.prototype.splice.call(e,n,1),0==e.length&&(delete t.g[i],t.h--)))):t&&(t=H(t))&&(e=t.g[e.toString()],t=-1,e&&(t=F(e,n,r,s)),(n=t>-1?e[t]:null)&&z(n))}function z(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[k])V(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(K(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=H(e))?(V(n,t),0==n.h&&(n.src=null,e[U]=null)):R(t)}}}function K(t){return t in j?j[t]:j[t]="on"+t}function G(t,e){if(t.da)t=!0;else{e=new A(e,this);const n=t.listener,r=t.ha||t.src;t.fa&&z(t),t=n.call(r,e)}return t}function H(t){return(t=t[U])instanceof P?t:null}var Q="__closure_events_fn_"+(1e9*Math.random()>>>0);function W(t){return"function"==typeof t?t:(t[Q]||(t[Q]=function(e){return t.handleEvent(e)}),t[Q])}function X(){T.call(this),this.i=new P(this),this.M=this,this.G=null}function Y(t,e){var n,r=t.G;if(r)for(n=[];r;r=r.G)n.push(r);if(t=t.M,r=e.type||e,"string"==typeof e)e=new I(e,t);else if(e instanceof I)e.target=e.target||t;else{var s=e;L(e=new I(r,t),s)}let i,o;if(s=!0,n)for(o=n.length-1;o>=0;o--)i=e.g=n[o],s=J(i,r,!0,e)&&s;if(i=e.g=t,s=J(i,r,!0,e)&&s,s=J(i,r,!1,e)&&s,n)for(o=0;o<n.length;o++)i=e.g=n[o],s=J(i,r,!1,e)&&s}function J(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();let s=!0;for(let i=0;i<e.length;++i){const o=e[i];if(o&&!o.da&&o.capture==n){const e=o.listener,n=o.ha||o.src;o.fa&&V(t.i,o),s=!1!==e.call(n,r)&&s}}return s&&!r.defaultPrevented}function Z(t){t.g=function(t,e){if("function"!=typeof t){if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=c(t.handleEvent,t)}return Number(e)>2147483647?-1:i.setTimeout(t,e||0)}(()=>{t.g=null,t.i&&(t.i=!1,Z(t))},t.l);const e=t.h;t.h=null,t.m.apply(null,e)}l(X,T),X.prototype[k]=!0,X.prototype.removeEventListener=function(t,e,n,r){q(this,t,e,n,r)},X.prototype.N=function(){if(X.Z.N.call(this),this.i){var t=this.i;for(const e in t.g){const n=t.g[e];for(let t=0;t<n.length;t++)R(n[t]);delete t.g[e],t.h--}}this.G=null},X.prototype.J=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},X.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class $ extends T{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:Z(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function tt(t){T.call(this),this.h=t,this.g={}}l(tt,T);var et=[];function nt(t){O(t.g,function(t,e){this.g.hasOwnProperty(e)&&z(t)},t),t.g={}}tt.prototype.N=function(){tt.Z.N.call(this),nt(this)},tt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rt=i.JSON.stringify,st=i.JSON.parse,it=class{stringify(t){return i.JSON.stringify(t,void 0)}parse(t){return i.JSON.parse(t,void 0)}};function ot(){}function at(){}var ct={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ut(){I.call(this,"d")}function lt(){I.call(this,"c")}l(ut,I),l(lt,I);var ht={},dt=null;function ft(){return dt=dt||new X}function pt(t){I.call(this,ht.Ia,t)}function gt(t){const e=ft();Y(e,new pt(e))}function mt(t,e){I.call(this,ht.STAT_EVENT,t),this.stat=e}function yt(t){const e=ft();Y(e,new mt(e,t))}function vt(t,e){I.call(this,ht.Ja,t),this.size=e}function wt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){t()},e)}function _t(){this.g=!0}function bt(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{const i=JSON.parse(e);if(i)for(t=0;t<i.length;t++)if(Array.isArray(i[t])){var n=i[t];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let t=1;t<r.length;t++)r[t]=""}}}return rt(i)}catch(i){return e}}(t,n)+(r?" "+r:"")})}ht.Ia="serverreachability",l(pt,I),ht.STAT_EVENT="statevent",l(mt,I),ht.Ja="timingevent",l(vt,I),_t.prototype.ua=function(){this.g=!1},_t.prototype.info=function(){};var Et,Tt={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},It={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function St(){}function Ct(t){return encodeURIComponent(String(t))}function At(t){var e=1;t=t.split(":");const n=[];for(;e>0&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function kt(t,e,n,r){this.j=t,this.i=e,this.l=n,this.S=r||1,this.V=new tt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Dt}function Dt(){this.i=null,this.g="",this.h=!1}l(St,ot),St.prototype.g=function(){return new XMLHttpRequest},Et=new St;var Nt={},Rt={};function Ot(t,e,n){t.M=1,t.A=re(Zt(e)),t.u=n,t.R=!0,xt(t,null)}function xt(t,e){t.F=Date.now(),Pt(t),t.B=Zt(t.A);var n=t.B,r=t.S;Array.isArray(r)||(r=[String(r)]),Ce(n.i,"t",r),t.C=0,n=t.j.L,t.h=new Dt,t.g=fn(t.j,n?e:null,!t.u),t.P>0&&(t.O=new $(c(t.Y,t,t.g),t.P)),e=t.V,n=t.g,r=t.ba;var s="readystatechange";Array.isArray(s)||(s&&(et[0]=s.toString()),s=et);for(let i=0;i<s.length;i++){const t=B(n,s[i],r||e.handleEvent,!1,e.h||e);if(!t)break;e.g[t.key]=t}e=t.J?x(t.J):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.B,t.v,t.u,e)):(t.v="GET",t.g.ea(t.B,t.v,null,e)),gt(),function(t,e,n,r,s,i){t.info(function(){if(t.g)if(i){var o="",a=i.split("&");for(let t=0;t<a.length;t++){var c=a[t].split("=");if(c.length>1){const t=c[0];c=c[1];const e=t.split("_");o=e.length>=2&&"type"==e[1]?o+(t+"=")+c+"&":o+(t+"=redacted&")}}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o})}(t.i,t.v,t.B,t.l,t.S,t.u)}function Mt(t){return!!t.g&&("GET"==t.v&&2!=t.M&&t.j.Aa)}function Lt(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Rt:(n=Number(e.substring(n,r)),isNaN(n)?Nt:(r+=1)+n>e.length?Rt:(e=e.slice(r,r+n),t.C=r+n,e))}function Pt(t){t.T=Date.now()+t.H,Vt(t,t.H)}function Vt(t,e){if(null!=t.D)throw Error("WatchDog timer not null");t.D=wt(c(t.aa,t),e)}function Ft(t){t.D&&(i.clearTimeout(t.D),t.D=null)}function Ut(t){0==t.j.I||t.K||cn(t.j,t)}function jt(t){Ft(t);var e=t.O;e&&"function"==typeof e.dispose&&e.dispose(),t.O=null,nt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.dispose())}function Bt(t,e){try{var n=t.j;if(0!=n.I&&(n.g==t||Ht(n.h,t)))if(!t.L&&Ht(n.h,t)&&3==n.I){try{var r=n.Ba.g.parse(e)}catch(l){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.v){if(n.g){if(!(n.g.F+3e3<t.F))break t;an(n),Ye(n)}rn(n),yt(18)}}else n.xa=s[1],0<n.xa-n.K&&s[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=wt(c(n.Va,n),6e3));Gt(n.h)<=1&&n.ta&&(n.ta=void 0)}else ln(n,11)}else if((t.L||n.g==t)&&an(n),!C(e))for(s=n.Ba.g.parse(e),e=0;e<s.length;e++){let c=s[e];const l=c[0];if(!(l<=n.K))if(n.K=l,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const e=c[3];null!=e&&(n.ka=e,n.j.info("VER="+n.ka));const s=c[4];null!=s&&(n.za=s,n.j.info("SVER="+n.za));const l=c[5];null!=l&&"number"==typeof l&&l>0&&(r=1.5*l,n.O=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.h;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Qt(i,i.h),i.h=null))}if(r.G){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.wa=t,ne(r.J,r.G,t))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-t.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=t;if((r=n).na=dn(r,r.L?r.ba:null,r.W),o.L){Wt(r.h,o);var a=o,u=r.O;u&&(a.H=u),a.D&&(Ft(a),Pt(a)),r.g=o}else nn(r);n.i.length>0&&Ze(n)}else"stop"!=c[0]&&"close"!=c[0]||ln(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?ln(n,7):Xe(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}gt()}catch(l){}}kt.prototype.ba=function(t){t=t.target;const e=this.O;e&&3==Ge(t)?e.j():this.Y(t)},kt.prototype.Y=function(t){try{if(t==this.g)t:{const c=Ge(this.g),u=this.g.ya();this.g.ca();if(!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||He(this.g)))){this.K||4!=c||7==u||gt(),Ft(this);var e=this.g.ca();this.X=e;var n=function(t){if(!Mt(t))return t.g.la();const e=He(t.g);if(""===e)return"";let n="";const r=e.length,s=4==Ge(t.g);if(!t.h.i){if("undefined"==typeof TextDecoder)return jt(t),Ut(t),"";t.h.i=new i.TextDecoder}for(let i=0;i<r;i++)t.h.h=!0,n+=t.h.i.decode(e[i],{stream:!(s&&i==r-1)});return e.length=0,t.h.g+=n,t.C=0,t.h.g}(this);if(this.o=200==e,function(t,e,n,r,s,i,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o})}(this.i,this.v,this.B,this.l,this.S,c,e),this.o){if(this.U&&!this.L){e:{if(this.g){var r,s=this.g;if((r=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(r)){var o=r;break e}}o=null}if(!(t=o)){this.o=!1,this.m=3,yt(12),jt(this),Ut(this);break t}bt(this.i,this.l,t,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Bt(this,t)}if(this.R){let e;for(t=!0;!this.K&&this.C<n.length;){if(e=Lt(this,n),e==Rt){4==c&&(this.m=4,yt(14),t=!1),bt(this.i,this.l,null,"[Incomplete Response]");break}if(e==Nt){this.m=4,yt(15),bt(this.i,this.l,n,"[Invalid Chunk]"),t=!1;break}bt(this.i,this.l,e,null),Bt(this,e)}if(Mt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,yt(16),t=!1),this.o=this.o&&t,t){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),sn(a),a.P=!0,yt(11))}}else bt(this.i,this.l,n,"[Invalid Chunked Response]"),jt(this),Ut(this)}else bt(this.i,this.l,n,null),Bt(this,n);4==c&&jt(this),this.o&&!this.K&&(4==c?cn(this.j,this):(this.o=!1,Pt(this)))}else(function(t){const e={};t=(t.g&&Ge(t)>=2&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(C(t[r]))continue;var n=At(t[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=e[s]||[];e[s]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,function(t){return t.join(", ")})})(this.g),400==e&&n.indexOf("Unknown SID")>0?(this.m=3,yt(12)):(this.m=0,yt(13)),jt(this),Ut(this)}}}catch(c){}},kt.prototype.cancel=function(){this.K=!0,jt(this)},kt.prototype.aa=function(){this.D=null;const t=Date.now();t-this.T>=0?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.i,this.B),2!=this.M&&(gt(),yt(17)),jt(this),this.m=2,Ut(this)):Vt(this,this.T-t)};var qt=class{constructor(t,e){this.g=t,this.map=e}};function zt(t){this.l=t||10,i.PerformanceNavigationTiming?t=(t=i.performance.getEntriesByType("navigation")).length>0&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Kt(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Gt(t){return t.h?1:t.g?t.g.size:0}function Ht(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Qt(t,e){t.g?t.g.add(e):t.h=e}function Wt(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Xt(t){if(null!=t.h)return t.i.concat(t.h.G);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.G);return e}return d(t.i)}zt.prototype.cancel=function(){if(this.i=Xt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var Yt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Jt(t){let e;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,t instanceof Jt?(this.l=t.l,$t(this,t.j),this.o=t.o,this.g=t.g,te(this,t.u),this.h=t.h,ee(this,Ae(t.i)),this.m=t.m):t&&(e=String(t).match(Yt))?(this.l=!1,$t(this,e[1]||"",!0),this.o=se(e[2]||""),this.g=se(e[3]||"",!0),te(this,e[4]),this.h=se(e[5]||"",!0),ee(this,e[6]||"",!0),this.m=se(e[7]||"")):(this.l=!1,this.i=new be(null,this.l))}function Zt(t){return new Jt(t)}function $t(t,e,n){t.j=n?se(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function te(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.u=e}else t.u=null}function ee(t,e,n){e instanceof be?(t.i=e,function(t,e){e&&!t.j&&(Ee(t),t.i=null,t.g.forEach(function(t,e){const n=e.toLowerCase();e!=n&&(Te(this,e),Ce(this,n,t))},t)),t.j=e}(t.i,t.l)):(n||(e=pe(e,we)),t.i=new be(e,t.l))}function ne(t,e,n){t.i.set(e,n)}function re(t){return ne(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function se(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function pe(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ge),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ge(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Jt.prototype.toString=function(){const t=[];var e=this.j;e&&t.push(pe(e,me,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(pe(e,me,!0),"@"),t.push(Ct(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&t.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(pe(n,"/"==n.charAt(0)?ve:ye,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",pe(n,_e)),t.join("")},Jt.prototype.resolve=function(t){const e=Zt(this);let n=!!t.j;n?$t(e,t.j):n=!!t.o,n?e.o=t.o:n=!!t.g,n?e.g=t.g:n=null!=t.u;var r=t.h;if(n)te(e,t.u);else if(n=!!t.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var s=e.h.lastIndexOf("/");-1!=s&&(r=e.h.slice(0,s+1)+r)}if(".."==(s=r)||"."==s)r="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){r=0==s.lastIndexOf("/",0),s=s.split("/");const t=[];for(let e=0;e<s.length;){const n=s[e++];"."==n?r&&e==s.length&&t.push(""):".."==n?((t.length>1||1==t.length&&""!=t[0])&&t.pop(),r&&e==s.length&&t.push("")):(t.push(n),r=!0)}r=t.join("/")}else r=s}return n?e.h=r:n=""!==t.i.toString(),n?ee(e,Ae(t.i)):n=!!t.m,n&&(e.m=t.m),e};var me=/[#\/\?@]/g,ye=/[#\?:]/g,ve=/[#\?]/g,we=/[#\?@]/g,_e=/#/g;function be(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ee(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(let n=0;n<t.length;n++){const r=t[n].indexOf("=");let s,i=null;r>=0?(s=t[n].substring(0,r),i=t[n].substring(r+1)):s=t[n],e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Te(t,e){Ee(t),e=ke(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Ie(t,e){return Ee(t),e=ke(t,e),t.g.has(e)}function Se(t,e){Ee(t);let n=[];if("string"==typeof e)Ie(t,e)&&(n=n.concat(t.g.get(ke(t,e))));else for(t=Array.from(t.g.values()),e=0;e<t.length;e++)n=n.concat(t[e]);return n}function Ce(t,e,n){Te(t,e),n.length>0&&(t.i=null,t.g.set(ke(t,e),d(n)),t.h+=n.length)}function Ae(t){const e=new be;return e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),e}function ke(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function De(t,e,n,r,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),r(n)}catch(i){}}function Ne(){this.g=new it}function Re(t){this.i=t.Sb||null,this.h=t.ab||!1}function Oe(t,e){X.call(this),this.H=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function xe(t){t.j.read().then(t.Ma.bind(t)).catch(t.ga.bind(t))}function Me(t){t.readyState=4,t.l=null,t.j=null,t.B=null,Le(t)}function Le(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Pe(t){let e="";return O(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}function Ve(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Pe(n),"string"==typeof t?null!=n&&Ct(n):ne(t,e,n))}function Fe(t){X.call(this),this.headers=new Map,this.L=t||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=be.prototype).add=function(t,e){Ee(this),this.i=null,t=ke(this,t);let n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Ee(this),this.g.forEach(function(n,r){n.forEach(function(n){t.call(e,n,r,this)},this)},this)},t.set=function(t,e){return Ee(this),this.i=null,Ie(this,t=ke(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&(t=Se(this,t)).length>0?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(let r=0;r<e.length;r++){var n=e[r];const s=Ct(n);n=Se(this,n);for(let e=0;e<n.length;e++){let r=s;""!==n[e]&&(r+="="+Ct(n[e])),t.push(r)}}return this.i=t.join("&")},l(Re,ot),Re.prototype.g=function(){return new Oe(this.i,this.h)},l(Oe,X),(t=Oe.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=t,this.D=e,this.readyState=1,Le(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const e={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};t&&(e.body=t),(this.H||i).fetch(new Request(this.D,e)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Me(this)),this.readyState=0},t.Pa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Le(this)),this.g&&(this.readyState=3,Le(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;xe(this)}else t.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.B.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Me(this):Le(this),3==this.readyState&&xe(this)}},t.Oa=function(t){this.g&&(this.response=this.responseText=t,Me(this))},t.Na=function(t){this.g&&(this.response=t,Me(this))},t.ga=function(){this.g&&Me(this)},t.setRequestHeader=function(t,e){this.A.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Oe.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),l(Fe,X);var Ue=/^https?$/i,je=["POST","PUT"];function Be(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.o=5,qe(t),Ke(t)}function qe(t){t.A||(t.A=!0,Y(t,"complete"),Y(t,"error"))}function ze(t){if(t.h&&void 0!==s)if(t.v&&4==Ge(t))setTimeout(t.Ca.bind(t),0);else if(Y(t,"readystatechange"),4==Ge(t)){t.h=!1;try{const s=t.ca();t:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===s){let e=String(t.D).match(Yt)[1]||null;!e&&i.self&&i.self.location&&(e=i.self.location.protocol.slice(0,-1)),r=!Ue.test(e?e.toLowerCase():"")}n=r}if(n)Y(t,"complete"),Y(t,"success");else{t.o=6;try{var o=Ge(t)>2?t.g.statusText:""}catch(a){o=""}t.l=o+" ["+t.ca()+"]",qe(t)}}finally{Ke(t)}}}function Ke(t,e){if(t.g){t.m&&(clearTimeout(t.m),t.m=null);const r=t.g;t.g=null,e||Y(t,"ready");try{r.onreadystatechange=null}catch(n){}}}function Ge(t){return t.g?t.g.readyState:0}function He(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.F){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Qe(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function We(t){this.za=0,this.i=[],this.j=new _t,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Qe("failFast",!1,t),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Qe("baseRetryDelayMs",5e3,t),this.Za=Qe("retryDelaySeedMs",1e4,t),this.Ta=Qe("forwardChannelMaxRetries",2,t),this.va=Qe("forwardChannelRequestTimeoutMs",2e4,t),this.ma=t&&t.xmlHttpFactory||void 0,this.Ua=t&&t.Rb||void 0,this.Aa=t&&t.useFetchStreams||!1,this.O=void 0,this.L=t&&t.supportsCrossDomainXhr||!1,this.M="",this.h=new zt(t&&t.concurrentRequestLimit),this.Ba=new Ne,this.S=t&&t.fastHandshake||!1,this.R=t&&t.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=t&&t.Pb||!1,t&&t.ua&&this.j.ua(),t&&t.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&t&&t.detectBufferingProxy||!1,this.ia=void 0,t&&t.longPollingTimeout&&t.longPollingTimeout>0&&(this.ia=t.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Xe(t){if(Je(t),3==t.I){var e=t.V++,n=Zt(t.J);if(ne(n,"SID",t.M),ne(n,"RID",e),ne(n,"TYPE","terminate"),tn(t,n),(e=new kt(t,t.j,e)).M=2,e.A=re(Zt(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(e.A.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=e.A,n=!0),n||(e.g=fn(e.j,null),e.g.ea(e.A)),e.F=Date.now(),Pt(e)}hn(t)}function Ye(t){t.g&&(sn(t),t.g.cancel(),t.g=null)}function Je(t){Ye(t),t.v&&(i.clearTimeout(t.v),t.v=null),an(t),t.h.cancel(),t.m&&("number"==typeof t.m&&i.clearTimeout(t.m),t.m=null)}function Ze(t){if(!Kt(t.h)&&!t.m){t.m=!0;var e=t.Ea;v||b(),w||(v(),w=!0),_.add(e,t),t.D=0}}function $e(t,e){var n;n=e?e.l:t.V++;const r=Zt(t.J);ne(r,"SID",t.M),ne(r,"RID",n),ne(r,"AID",t.K),tn(t,r),t.u&&t.o&&Ve(r,t.u,t.o),n=new kt(t,t.j,n,t.D+1),null===t.u&&(n.J=t.o),e&&(t.i=e.G.concat(t.i)),e=en(t,n,1e3),n.H=Math.round(.5*t.va)+Math.round(.5*t.va*Math.random()),Qt(t.h,n),Ot(n,r,e)}function tn(t,e){t.H&&O(t.H,function(t,n){ne(e,n,t)}),t.l&&O({},function(t,n){ne(e,n,t)})}function en(t,e,n){n=Math.min(t.i.length,n);const r=t.l?c(t.l.Ka,t.l,t):null;t:{var s=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?n>0?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let c=!0;for(let l=0;l<n;l++){var i=s[l].g;const n=s[l].map;if((i-=e)<0)e=Math.max(0,s[l].g-100),c=!1;else try{i="req"+i+"_"||"";try{var a=n instanceof Map?n:Object.entries(n);for(const[e,n]of a){let r=n;o(n)&&(r=rt(n)),t.push(i+e+"="+encodeURIComponent(r))}}catch(u){throw t.push(i+"type="+encodeURIComponent("_badmap")),u}}catch(u){r&&r(n)}}if(c){a=t.join("&");break t}}a=void 0}return t=t.i.splice(0,n),e.G=t,a}function nn(t){if(!t.g&&!t.v){t.Y=1;var e=t.Da;v||b(),w||(v(),w=!0),_.add(e,t),t.A=0}}function rn(t){return!(t.g||t.v||t.A>=3)&&(t.Y++,t.v=wt(c(t.Da,t),un(t,t.A)),t.A++,!0)}function sn(t){null!=t.B&&(i.clearTimeout(t.B),t.B=null)}function on(t){t.g=new kt(t,t.j,"rpc",t.Y),null===t.u&&(t.g.J=t.o),t.g.P=0;var e=Zt(t.na);ne(e,"RID","rpc"),ne(e,"SID",t.M),ne(e,"AID",t.K),ne(e,"CI",t.F?"0":"1"),!t.F&&t.ia&&ne(e,"TO",t.ia),ne(e,"TYPE","xmlhttp"),tn(t,e),t.u&&t.o&&Ve(e,t.u,t.o),t.O&&(t.g.H=t.O);var n=t.g;t=t.ba,n.M=1,n.A=re(Zt(e)),n.u=null,n.R=!0,xt(n,t)}function an(t){null!=t.C&&(i.clearTimeout(t.C),t.C=null)}function cn(t,e){var n=null;if(t.g==e){an(t),sn(t),t.g=null;var r=2}else{if(!Ht(t.h,e))return;n=e.G,Wt(t.h,e),r=1}if(0!=t.I)if(e.o)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.F;var s=t.D;Y(r=ft(),new vt(r,n)),Ze(t)}else nn(t);else if(3==(s=e.m)||0==s&&e.X>0||!(1==r&&function(t,e){return!(Gt(t.h)>=t.h.j-(t.m?1:0)||(t.m?(t.i=e.G.concat(t.i),0):1==t.I||2==t.I||t.D>=(t.Sa?0:t.Ta)||(t.m=wt(c(t.Ea,t,e),un(t,t.D)),t.D++,0)))}(t,e)||2==r&&rn(t)))switch(n&&n.length>0&&(e=t.h,e.i=e.i.concat(n)),s){case 1:ln(t,5);break;case 4:ln(t,10);break;case 3:ln(t,6);break;default:ln(t,2)}}function un(t,e){let n=t.Qa+Math.floor(Math.random()*t.Za);return t.isActive()||(n*=2),n*e}function ln(t,e){if(t.j.info("Error code "+e),2==e){var n=c(t.bb,t),r=t.Ua;const e=!r;r=new Jt(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||$t(r,"https"),re(r),e?function(t,e){const n=new _t;if(i.Image){const r=new Image;r.onload=u(De,n,"TestLoadImage: loaded",!0,e,r),r.onerror=u(De,n,"TestLoadImage: error",!1,e,r),r.onabort=u(De,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=u(De,n,"TestLoadImage: timeout",!1,e,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new _t;const n=new AbortController,r=setTimeout(()=>{n.abort(),De(0,0,!1,e)},1e4);fetch(t,{signal:n.signal}).then(t=>{clearTimeout(r),t.ok?De(0,0,!0,e):De(0,0,!1,e)}).catch(()=>{clearTimeout(r),De(0,0,!1,e)})}(r.toString(),n)}else yt(2);t.I=0,t.l&&t.l.pa(e),hn(t),Je(t)}function hn(t){if(t.I=0,t.ja=[],t.l){const e=Xt(t.h);0==e.length&&0==t.i.length||(f(t.ja,e),f(t.ja,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.oa()}}function dn(t,e,n){var r=n instanceof Jt?Zt(n):new Jt(n);if(""!=r.g)e&&(r.g=e+"."+r.g),te(r,r.u);else{var s=i.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;const t=new Jt(null);r&&$t(t,r),e&&(t.g=e),s&&te(t,s),n&&(t.h=n),r=t}return n=t.G,e=t.wa,n&&e&&ne(r,n,e),ne(r,"VER",t.ka),tn(t,r),r}function fn(t,e,n){if(e&&!t.L)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Aa&&!t.ma?new Fe(new Re({ab:n})):new Fe(t.ma)).Fa(t.L),e}function pn(){}function gn(){}function mn(t,e){X.call(this),this.g=new We(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.sa&&(t?t["X-WebChannel-Client-Profile"]=e.sa:t={"X-WebChannel-Client-Profile":e.sa}),this.g.U=t,(t=e&&e.Qb)&&!C(t)&&(this.g.u=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!C(e)&&(this.g.G=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new wn(this)}function yn(t){ut.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function vn(){lt.call(this),this.status=1}function wn(t){this.g=t}(t=Fe.prototype).Fa=function(t){this.H=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Et.g(),this.g.onreadystatechange=h(c(this.Ca,this));try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(o){return void Be(this,o)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find(t=>"content-type"==t.toLowerCase()),s=i.FormData&&t instanceof i.FormData,!(Array.prototype.indexOf.call(je,e,void 0)>=0)||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(o){Be(this,o)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=t||7,Y(this,"complete"),Y(this,"abort"),Ke(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ke(this,!0)),Fe.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?ze(this):this.Xa())},t.Xa=function(){ze(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return Ge(this)>2?this.g.status:-1}catch(t){return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.La=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),st(e)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=We.prototype).ka=8,t.I=1,t.connect=function(t,e,n,r){yt(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=dn(this,null,this.W),Ze(this)},t.Ea=function(t){if(this.m)if(this.m=null,1==this.I){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new kt(this,this.j,t);let i=this.o;if(this.U&&(i?(i=x(i),L(i,this.U)):i=this.U),null!==this.u||this.R||(s.J=i,i=null),this.S)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if((e+=r)>4096){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=en(this,s,e),ne(n=Zt(this.J),"RID",t),ne(n,"CVER",22),this.G&&ne(n,"X-HTTP-Session-Id",this.G),tn(this,n),i&&(this.R?e="headers="+Ct(Pe(i))+"&"+e:this.u&&Ve(n,this.u,i)),Qt(this.h,s),this.Ra&&ne(n,"TYPE","init"),this.S?(ne(n,"$req",e),ne(n,"SID","null"),s.U=!0,Ot(s,n,null)):Ot(s,n,e),this.I=2}}else 3==this.I&&(t?$e(this,t):0==this.i.length||Kt(this.h)||$e(this))},t.Da=function(){if(this.v=null,on(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var t=4*this.T;this.j.info("BP detection timer enabled: "+t),this.B=wt(c(this.Wa,this),t)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,yt(10),Ye(this),on(this))},t.Va=function(){null!=this.C&&(this.C=null,Ye(this),rn(this),yt(19))},t.bb=function(t){t?(this.j.info("Successfully pinged google.com"),yt(2)):(this.j.info("Failed to ping google.com"),yt(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=pn.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},gn.prototype.g=function(t,e){return new mn(t,e)},l(mn,X),mn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},mn.prototype.close=function(){Xe(this.g)},mn.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=rt(t),t=n);e.i.push(new qt(e.Ya++,t)),3==e.I&&Ze(e)},mn.prototype.N=function(){this.g.l=null,delete this.j,Xe(this.g),delete this.g,mn.Z.N.call(this)},l(yn,ut),l(vn,lt),l(wn,pn),wn.prototype.ra=function(){Y(this.g,"a")},wn.prototype.qa=function(t){Y(this.g,new yn(t))},wn.prototype.pa=function(t){Y(this.g,new vn)},wn.prototype.oa=function(){Y(this.g,"b")},gn.prototype.createWebChannel=gn.prototype.g,mn.prototype.send=mn.prototype.o,mn.prototype.open=mn.prototype.m,mn.prototype.close=mn.prototype.close,de=function(){return new gn},he=function(){return ft()},le=ht,ue={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Tt.NO_ERROR=0,Tt.TIMEOUT=8,Tt.HTTP_ERROR=6,ce=Tt,It.COMPLETE="complete",ae=It,at.EventType=ct,ct.OPEN="a",ct.CLOSE="b",ct.ERROR="c",ct.MESSAGE="d",X.prototype.listen=X.prototype.J,oe=at,Fe.prototype.listenOnce=Fe.prototype.K,Fe.prototype.getLastError=Fe.prototype.Ha,Fe.prototype.getLastErrorCode=Fe.prototype.ya,Fe.prototype.getStatus=Fe.prototype.ca,Fe.prototype.getResponseJson=Fe.prototype.La,Fe.prototype.getResponseText=Fe.prototype.la,Fe.prototype.send=Fe.prototype.ea,Fe.prototype.setWithCredentials=Fe.prototype.Fa,ie=Fe}).apply(void 0!==fe?fe:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const pe="@firebase/firestore",ge="4.9.2";class me{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}me.UNAUTHENTICATED=new me(null),me.GOOGLE_CREDENTIALS=new me("google-credentials-uid"),me.FIRST_PARTY=new me("first-party-uid"),me.MOCK_USER=new me("mock-user");let ye="12.3.0";const ve=new P("@firebase/firestore");function we(){return ve.logLevel}function _e(t,...e){if(ve.logLevel<=N.DEBUG){const n=e.map(Te);ve.debug("Firestore (".concat(ye,"): ").concat(t),...n)}}function be(t,...e){if(ve.logLevel<=N.ERROR){const n=e.map(Te);ve.error("Firestore (".concat(ye,"): ").concat(t),...n)}}function Ee(t,...e){if(ve.logLevel<=N.WARN){const n=e.map(Te);ve.warn("Firestore (".concat(ye,"): ").concat(t),...n)}}function Te(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(n){return t}var e}function Ie(t,e,n){let r="Unexpected state";"string"==typeof e?r=e:n=e,Se(t,r,n)}function Se(t,e,n){let r="FIRESTORE (".concat(ye,") INTERNAL ASSERTION FAILED: ").concat(e," (ID: ").concat(t.toString(16),")");if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(s){r+=" CONTEXT: "+n}throw be(r),new Error(r)}function Ce(t,e,n,r){let s="Unexpected state";"string"==typeof n?s=n:r=n,t||Se(e,s,r)}function Ae(t,e){return t}const ke={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class De extends _{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class Ne{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class Re{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))}}class Oe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(me.UNAUTHENTICATED))}shutdown(){}}class xe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class Me{constructor(t){this.t=t,this.currentUser=me.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Ce(void 0===this.o,42304);let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new Ne;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ne,t.enqueueRetryable(()=>r(this.currentUser))};const i=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await r(this.currentUser)})},o=t=>{_e("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(t=>o(t)),setTimeout(()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(_e("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ne)}},0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(_e("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Ce("string"==typeof e.accessToken,31837,{l:e}),new Re(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Ce(null===t||"string"==typeof t,2055,{h:t}),new me(t)}}class Le{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=me.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Pe{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new Le(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(me.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ve{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Fe{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ut(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){Ce(void 0===this.o,3512);const n=t=>{null!=t.error&&_e("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(t.error.message));const n=t.token!==this.m;return this.m=t.token,_e("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>n(e))};const r=t=>{_e("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(t=>r(t)),setTimeout(()=>{if(!this.appCheck){const t=this.V.getImmediate({optional:!0});t?r(t):_e("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ve(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(t=>t?(Ce("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new Ve(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Ue(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class je{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Ue(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function Be(t,e){return t<e?-1:t>e?1:0}function qe(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.charAt(r),s=e.charAt(r);if(n!==s)return Ge(n)===Ge(s)?Be(n,s):Ge(n)?1:-1}return Be(t.length,e.length)}const ze=55296,Ke=57343;function Ge(t){const e=t.charCodeAt(0);return e>=ze&&e<=Ke}function He(t,e,n){return t.length===e.length&&t.every((t,r)=>n(t,e[r]))}const Qe="__name__";class We{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ie(637,{offset:e,range:t.length}),void 0===n?n=t.length-e:n>t.length-e&&Ie(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===We.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof We?t.forEach(t=>{e.push(t)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=We.compareSegments(t.get(r),e.get(r));if(0!==n)return n}return Be(t.length,e.length)}static compareSegments(t,e){const n=We.isNumericId(t),r=We.isNumericId(e);return n&&!r?-1:!n&&r?1:n&&r?We.extractNumericId(t).compare(We.extractNumericId(e)):qe(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ne.fromString(t.substring(4,t.length-2))}}class Xe extends We{construct(t,e,n){return new Xe(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new De(ke.INVALID_ARGUMENT,"Invalid segment (".concat(n,"). Paths must not contain // in them."));e.push(...n.split("/").filter(t=>t.length>0))}return new Xe(e)}static emptyPath(){return new Xe([])}}const Ye=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Je extends We{construct(t,e,n){return new Je(t,e,n)}static isValidIdentifier(t){return Ye.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Je.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Qe}static keyField(){return new Je([Qe])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new De(ke.INVALID_ARGUMENT,"Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new De(ke.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new De(ke.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new De(ke.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Je(e)}static emptyPath(){return new Je([])}}class Ze{constructor(t){this.path=t}static fromPath(t){return new Ze(Xe.fromString(t))}static fromName(t){return new Ze(Xe.fromString(t).popFirst(5))}static empty(){return new Ze(Xe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===Xe.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Xe.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Ze(new Xe(t.slice()))}}function $e(t,e,n){if(!n)throw new De(ke.INVALID_ARGUMENT,"Function ".concat(t,"() cannot be called with an empty ").concat(e,"."))}function tn(t){if(!Ze.isDocumentKey(t))throw new De(ke.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(t," has ").concat(t.length,"."))}function en(t){if(Ze.isDocumentKey(t))throw new De(ke.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(t," has ").concat(t.length,"."))}function nn(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function rn(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t="".concat(t.substring(0,20),"...")),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const n=(e=t).constructor?e.constructor.name:null;return n?"a custom ".concat(n," object"):"an object"}}var e;return"function"==typeof t?"a function":Ie(12329,{type:typeof t})}function sn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new De(ke.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=rn(t);throw new De(ke.INVALID_ARGUMENT,"Expected type '".concat(e.name,"', but it was: ").concat(n))}}return t}function on(t,e){const n={typeString:t};return e&&(n.value=e),n}function an(t,e){if(!nn(t))throw new De(ke.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n="JSON missing required field: '".concat(r,"'");break}const o=t[r];if(s&&typeof o!==s){n="JSON field '".concat(r,"' must be a ").concat(s,".");break}if(void 0!==i&&o!==i.value){n="Expected '".concat(r,"' field to equal '").concat(i.value,"'");break}}if(n)throw new De(ke.INVALID_ARGUMENT,n);return!0}const cn=-62135596800,un=1e6;class ln{static now(){return ln.fromMillis(Date.now())}static fromDate(t){return ln.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*un);return new ln(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new De(ke.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new De(ke.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<cn)throw new De(ke.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new De(ke.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/un}_compareTo(t){return this.seconds===t.seconds?Be(this.nanoseconds,t.nanoseconds):Be(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ln._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(an(t,ln._jsonSchema))return new ln(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-cn;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ln._jsonSchemaVersion="firestore/timestamp/1.0",ln._jsonSchema={type:on("string",ln._jsonSchemaVersion),seconds:on("number"),nanoseconds:on("number")};class hn{static fromTimestamp(t){return new hn(t)}static min(){return new hn(new ln(0,0))}static max(){return new hn(new ln(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function dn(t){return new fn(t.readTime,t.key,-1)}class fn{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new fn(hn.min(),Ze.empty(),-1)}static max(){return new fn(hn.max(),Ze.empty(),-1)}}function pn(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=Ze.comparator(t.documentKey,e.documentKey),0!==n?n:Be(t.largestBatchId,e.largestBatchId))}class gn{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}async function mn(t){if(t.code!==ke.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;_e("LocalStore","Unexpectedly lost primary lease")}class yn{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Ie(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new yn((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof yn?e:yn.resolve(e)}catch(e){return yn.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):yn.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):yn.reject(e)}static resolve(t){return new yn((e,n)=>{e(t)})}static reject(t){return new yn((e,n)=>{n(t)})}static waitFor(t){return new yn((e,n)=>{let r=0,s=0,i=!1;t.forEach(t=>{++r,t.next(()=>{++s,i&&s===r&&e()},t=>n(t))}),i=!0,s===r&&e()})}static or(t){let e=yn.resolve(!1);for(const n of t)e=e.next(t=>t?yn.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,r)=>{n.push(e.call(this,t,r))}),this.waitFor(n)}static mapArray(t,e){return new yn((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next(t=>{i[c]=t,++o,o===s&&n(i)},t=>r(t))}})}static doWhile(t,e){return new yn((n,r)=>{const s=()=>{!0===t()?e().next(()=>{s()},r):n()};s()})}}function vn(t){return"IndexedDbTransactionError"===t.name}class wn{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ae(t),this.ue=t=>e.writeSequenceNumber(t))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}wn.ce=-1;function _n(t){return null==t}function bn(t){return 0===t&&1/t==-1/0}function En(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const e=t.charAt(s);switch(e){case"\0":n+="";break;case"":n+="";break;default:n+=e}}return n}function Tn(t){return t+""}function In(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Sn(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Cn(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class An{constructor(t,e){this.comparator=t,this.root=e||Dn.EMPTY}insert(t,e){return new An(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Dn.BLACK,null,null))}remove(t){return new An(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Dn.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push("".concat(e,":").concat(n)),!1)),"{".concat(t.join(", "),"}")}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new kn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new kn(this.root,t,this.comparator,!1)}getReverseIterator(){return new kn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new kn(this.root,t,this.comparator,!0)}}class kn{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Dn{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:Dn.RED,this.left=null!=r?r:Dn.EMPTY,this.right=null!=s?s:Dn.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new Dn(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Dn.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Dn.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Dn.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Dn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ie(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ie(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw Ie(27949);return t+(this.isRed()?0:1)}}Dn.EMPTY=null,Dn.RED=!0,Dn.BLACK=!1,Dn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ie(57766)}get value(){throw Ie(16141)}get color(){throw Ie(16727)}get left(){throw Ie(29726)}get right(){throw Ie(36894)}copy(t,e,n,r,s){return this}insert(t,e,n){return new Dn(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Nn{constructor(t){this.comparator=t,this.data=new An(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Rn(this.data.getIterator())}getIteratorFrom(t){return new Rn(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof Nn))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new Nn(this.comparator);return e.data=t,e}}class Rn{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class On{constructor(t){this.fields=t,t.sort(Je.comparator)}static empty(){return new On([])}unionWith(t){let e=new Nn(Je.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new On(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return He(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class xn extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Mn{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new xn("Invalid base64 string: "+e):e}}(t);return new Mn(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Mn(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Be(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Mn.EMPTY_BYTE_STRING=new Mn("");const Ln=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pn(t){if(Ce(!!t,39018),"string"==typeof t){let e=0;const n=Ln.exec(t);if(Ce(!!n,46558,{timestamp:t}),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Vn(t.seconds),nanos:Vn(t.nanos)}}function Vn(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Fn(t){return"string"==typeof t?Mn.fromBase64String(t):Mn.fromUint8Array(t)}const Un="server_timestamp",jn="__type__",Bn="__previous_value__",qn="__local_write_time__";function zn(t){var e,n;return(null==(n=((null==(e=null==t?void 0:t.mapValue)?void 0:e.fields)||{})[jn])?void 0:n.stringValue)===Un}function Kn(t){const e=t.mapValue.fields[Bn];return zn(e)?Kn(e):e}function Gn(t){const e=Pn(t.mapValue.fields[qn].timestampValue);return new ln(e.seconds,e.nanos)}class Hn{constructor(t,e,n,r,s,i,o,a,c,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const Qn="(default)";class Wn{constructor(t,e){this.projectId=t,this.database=e||Qn}static empty(){return new Wn("","")}get isDefaultDatabase(){return this.database===Qn}isEqual(t){return t instanceof Wn&&t.projectId===this.projectId&&t.database===this.database}}const Xn="__type__",Yn="__max__",Jn={},Zn="__vector__",$n="value";function tr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?zn(t)?4:function(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===Yn}(t)?9007199254740991:function(t){var e,n;const r=null==(n=((null==(e=null==t?void 0:t.mapValue)?void 0:e.fields)||{})[Xn])?void 0:n.stringValue;return r===Zn}(t)?10:11:Ie(28295,{value:t})}function er(t,e){if(t===e)return!0;const n=tr(t);if(n!==tr(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Gn(t).isEqual(Gn(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Pn(t.timestampValue),r=Pn(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return r=e,Fn(t.bytesValue).isEqual(Fn(r.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Vn(t.geoPointValue.latitude)===Vn(e.geoPointValue.latitude)&&Vn(t.geoPointValue.longitude)===Vn(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Vn(t.integerValue)===Vn(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Vn(t.doubleValue),r=Vn(e.doubleValue);return n===r?bn(n)===bn(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return He(t.arrayValue.values||[],e.arrayValue.values||[],er);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(In(n)!==In(r))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===r[s]||!er(n[s],r[s])))return!1;return!0}(t,e);default:return Ie(52216,{left:t})}var r}function nr(t,e){return void 0!==(t.values||[]).find(t=>er(t,e))}function rr(t,e){if(t===e)return 0;const n=tr(t),r=tr(e);if(n!==r)return Be(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Be(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Vn(t.integerValue||t.doubleValue),r=Vn(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return sr(t.timestampValue,e.timestampValue);case 4:return sr(Gn(t),Gn(e));case 5:return qe(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Fn(t),r=Fn(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let s=0;s<n.length&&s<r.length;s++){const t=Be(n[s],r[s]);if(0!==t)return t}return Be(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Be(Vn(t.latitude),Vn(e.latitude));return 0!==n?n:Be(Vn(t.longitude),Vn(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return ir(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n,r,s,i;const o=t.fields||{},a=e.fields||{},c=null==(n=o[$n])?void 0:n.arrayValue,u=null==(r=a[$n])?void 0:r.arrayValue,l=Be((null==(s=null==c?void 0:c.values)?void 0:s.length)||0,(null==(i=null==u?void 0:u.values)?void 0:i.length)||0);return 0!==l?l:ir(c,u)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===Jn&&e===Jn)return 0;if(t===Jn)return 1;if(e===Jn)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let o=0;o<r.length&&o<i.length;++o){const t=qe(r[o],i[o]);if(0!==t)return t;const e=rr(n[r[o]],s[i[o]]);if(0!==e)return e}return Be(r.length,i.length)}(t.mapValue,e.mapValue);default:throw Ie(23264,{he:n})}}function sr(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Be(t,e);const n=Pn(t),r=Pn(e),s=Be(n.seconds,r.seconds);return 0!==s?s:Be(n.nanos,r.nanos)}function ir(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const t=rr(n[s],r[s]);if(t)return t}return Be(n.length,r.length)}function or(t){return ar(t)}function ar(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Pn(t);return"time(".concat(e.seconds,",").concat(e.nanos,")")}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Fn(t.bytesValue).toBase64():"referenceValue"in t?function(t){return Ze.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return"geo(".concat(t.latitude,",").concat(t.longitude,")")}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=ar(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+="".concat(s,":").concat(ar(t.fields[s]));return n+"}"}(t.mapValue):Ie(61005,{value:t})}function cr(t){switch(tr(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Kn(t);return e?16+cr(e):16;case 5:return 2*t.stringValue.length;case 6:return Fn(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,e)=>t+cr(e),0);case 10:case 11:return function(t){let e=0;return Sn(t.fields,(t,n)=>{e+=t.length+cr(n)}),e}(t.mapValue);default:throw Ie(13486,{value:t})}}function ur(t,e){return{referenceValue:"projects/".concat(t.projectId,"/databases/").concat(t.database,"/documents/").concat(e.path.canonicalString())}}function lr(t){return!!t&&"integerValue"in t}function hr(t){return!!t&&"arrayValue"in t}function dr(t){return!!t&&"nullValue"in t}function fr(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function pr(t){return!!t&&"mapValue"in t}function gr(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Sn(t.mapValue.fields,(t,n)=>e.mapValue.fields[t]=gr(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=gr(t.arrayValue.values[n]);return e}return{...t}}class mr{constructor(t){this.value=t}static empty(){return new mr({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!pr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=gr(e)}setAll(t){let e=Je.emptyPath(),n={},r=[];t.forEach((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=gr(t):r.push(s.lastSegment())});const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());pr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return er(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];pr(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Sn(e,(e,n)=>t[e]=n);for(const r of n)delete t[r]}clone(){return new mr(gr(this.value))}}function yr(t){const e=[];return Sn(t.fields,(t,n)=>{const r=new Je([t]);if(pr(n)){const t=yr(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)}),new On(e)}class vr{constructor(t,e,n,r,s,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new vr(t,0,hn.min(),hn.min(),hn.min(),mr.empty(),0)}static newFoundDocument(t,e,n,r){return new vr(t,1,e,hn.min(),n,r,0)}static newNoDocument(t,e){return new vr(t,2,e,hn.min(),hn.min(),mr.empty(),0)}static newUnknownDocument(t,e){return new vr(t,3,e,hn.min(),hn.min(),mr.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(hn.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=mr.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=mr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=hn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof vr&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new vr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class wr{constructor(t,e){this.position=t,this.inclusive=e}}function _r(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?Ze.comparator(Ze.fromName(o.referenceValue),n.key):rr(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function br(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!er(t.position[n],e.position[n]))return!1;return!0}class Er{constructor(t,e="asc"){this.field=t,this.dir=e}}function Tr(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Ir{}class Sr extends Ir{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Or(t,e,n):"array-contains"===e?new Pr(t,n):"in"===e?new Vr(t,n):"not-in"===e?new Fr(t,n):"array-contains-any"===e?new Ur(t,n):new Sr(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new xr(t,n):new Mr(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison(rr(e,this.value)):null!==e&&tr(this.value)===tr(e)&&this.matchesComparison(rr(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ie(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Cr extends Ir{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new Cr(t,e)}matches(t){return Ar(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ar(t){return"and"===t.op}function kr(t){return function(t){for(const e of t.filters)if(e instanceof Cr)return!1;return!0}(t)&&Ar(t)}function Dr(t){if(t instanceof Sr)return t.field.canonicalString()+t.op.toString()+or(t.value);if(kr(t))return t.filters.map(t=>Dr(t)).join(",");{const e=t.filters.map(t=>Dr(t)).join(",");return"".concat(t.op,"(").concat(e,")")}}function Nr(t,e){return t instanceof Sr?(n=t,(r=e)instanceof Sr&&n.op===r.op&&n.field.isEqual(r.field)&&er(n.value,r.value)):t instanceof Cr?function(t,e){return e instanceof Cr&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce((t,n,r)=>t&&Nr(n,e.filters[r]),!0)}(t,e):void Ie(19439);var n,r}function Rr(t){return t instanceof Sr?"".concat((e=t).field.canonicalString()," ").concat(e.op," ").concat(or(e.value)):t instanceof Cr?function(t){return t.op.toString()+" {"+t.getFilters().map(Rr).join(" ,")+"}"}(t):"Filter";var e}class Or extends Sr{constructor(t,e,n){super(t,e,n),this.key=Ze.fromName(n.referenceValue)}matches(t){const e=Ze.comparator(t.key,this.key);return this.matchesComparison(e)}}class xr extends Sr{constructor(t,e){super(t,"in",e),this.keys=Lr("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Mr extends Sr{constructor(t,e){super(t,"not-in",e),this.keys=Lr("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Lr(t,e){var n;return((null==(n=e.arrayValue)?void 0:n.values)||[]).map(t=>Ze.fromName(t.referenceValue))}class Pr extends Sr{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return hr(e)&&nr(e.arrayValue,this.value)}}class Vr extends Sr{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&nr(this.value.arrayValue,e)}}class Fr extends Sr{constructor(t,e){super(t,"not-in",e)}matches(t){if(nr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&void 0===e.nullValue&&!nr(this.value.arrayValue,e)}}class Ur extends Sr{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!hr(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>nr(this.value.arrayValue,t))}}class jr{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.Te=null}}function Br(t,e=null,n=[],r=[],s=null,i=null,o=null){return new jr(t,e,n,r,s,i,o)}function qr(t){const e=Ae(t);if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>Dr(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>{return(e=t).field.canonicalString()+e.dir;var e}).join(","),_n(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(t=>or(t)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(t=>or(t)).join(",")),e.Te=t}return e.Te}function zr(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Tr(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Nr(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!br(t.startAt,e.startAt)&&br(t.endAt,e.endAt)}function Kr(t){return Ze.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Gr{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Hr(t){return new Gr(t)}function Qr(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Wr(t){return null!==t.collectionGroup}function Xr(t){const e=Ae(t);if(null===e.Ie){e.Ie=[];const t=new Set;for(const r of e.explicitOrderBy)e.Ie.push(r),t.add(r.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(t){let e=new Nn(Je.comparator);return t.filters.forEach(t=>{t.getFlattenedFilters().forEach(t=>{t.isInequality()&&(e=e.add(t.field))})}),e})(e).forEach(r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ie.push(new Er(r,n))}),t.has(Je.keyField().canonicalString())||e.Ie.push(new Er(Je.keyField(),n))}return e.Ie}function Yr(t){const e=Ae(t);return e.Ee||(e.Ee=function(t,e){if("F"===t.limitType)return Br(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(t=>{const e="desc"===t.dir?"asc":"desc";return new Er(t.field,e)});const n=t.endAt?new wr(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new wr(t.startAt.position,t.startAt.inclusive):null;return Br(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,Xr(t))),e.Ee}function Jr(t,e){const n=t.filters.concat([e]);return new Gr(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Zr(t,e,n){return new Gr(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function $r(t,e){return zr(Yr(t),Yr(e))&&t.limitType===e.limitType}function ts(t){return"".concat(qr(Yr(t)),"|lt:").concat(t.limitType)}function es(t){return"Query(target=".concat(function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: [".concat(t.filters.map(t=>Rr(t)).join(", "),"]")),_n(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: [".concat(t.orderBy.map(t=>{return"".concat((e=t).field.canonicalString()," (").concat(e.dir,")");var e}).join(", "),"]")),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(t=>or(t)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(t=>or(t)).join(",")),"Target(".concat(e,")")}(Yr(t)),"; limitType=").concat(t.limitType,")")}function ns(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Ze.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Xr(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&(r=e,!((n=t).startAt&&!function(t,e,n){const r=_r(t,e,n);return t.inclusive?r<=0:r<0}(n.startAt,Xr(n),r)||n.endAt&&!function(t,e,n){const r=_r(t,e,n);return t.inclusive?r>=0:r>0}(n.endAt,Xr(n),r)));var n,r}function rs(t){return(e,n)=>{let r=!1;for(const s of Xr(t)){const t=ss(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function ss(t,e,n){const r=t.field.isKeyField()?Ze.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?rr(r,s):Ie(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ie(19790,{direction:t.dir})}}class is{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[r,s]of n)if(this.equalsFn(r,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return void(r[s]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Sn(this.inner,(e,n)=>{for(const[r,s]of n)t(r,s)})}isEmpty(){return Cn(this.inner)}size(){return this.innerSize}}const os=new An(Ze.comparator);function as(){return os}const cs=new An(Ze.comparator);function us(...t){let e=cs;for(const n of t)e=e.insert(n.key,n);return e}function ls(t){let e=cs;return t.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function hs(){return fs()}function ds(){return fs()}function fs(){return new is(t=>t.toString(),(t,e)=>t.isEqual(e))}const ps=new An(Ze.comparator),gs=new Nn(Ze.comparator);function ms(...t){let e=gs;for(const n of t)e=e.add(n);return e}const ys=new Nn(Be);function vs(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bn(e)?"-0":e}}function ws(t){return{integerValue:""+t}}function _s(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!bn(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?ws(e):vs(t,e)}class bs{constructor(){this._=void 0}}function Es(t,e,n){return t instanceof Ss?function(t,e){const n={fields:{[jn]:{stringValue:Un},[qn]:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&zn(e)&&(e=Kn(e)),e&&(n.fields[Bn]=e),{mapValue:n}}(n,e):t instanceof Cs?As(t,e):t instanceof ks?Ds(t,e):function(t,e){const n=Is(t,e),r=Rs(n)+Rs(t.Ae);return lr(n)&&lr(t.Ae)?ws(r):vs(t.serializer,r)}(t,e)}function Ts(t,e,n){return t instanceof Cs?As(t,e):t instanceof ks?Ds(t,e):n}function Is(t,e){return t instanceof Ns?lr(n=e)||(r=n)&&"doubleValue"in r?e:{integerValue:0}:null;var n,r}class Ss extends bs{}class Cs extends bs{constructor(t){super(),this.elements=t}}function As(t,e){const n=Os(e);for(const r of t.elements)n.some(t=>er(t,r))||n.push(r);return{arrayValue:{values:n}}}class ks extends bs{constructor(t){super(),this.elements=t}}function Ds(t,e){let n=Os(e);for(const r of t.elements)n=n.filter(t=>!er(t,r));return{arrayValue:{values:n}}}class Ns extends bs{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function Rs(t){return Vn(t.integerValue||t.doubleValue)}function Os(t){return hr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class xs{constructor(t,e){this.version=t,this.transformResults=e}}class Ms{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ms}static exists(t){return new Ms(void 0,t)}static updateTime(t){return new Ms(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ls(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ps{}function Vs(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Qs(t.key,Ms.none()):new qs(t.key,t.data,Ms.none());{const n=t.data,r=mr.empty();let s=new Nn(Je.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new zs(t.key,r,new On(s.toArray()),Ms.none())}}function Fs(t,e,n){var r;t instanceof qs?function(t,e,n){const r=t.value.clone(),s=Gs(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof zs?function(t,e,n){if(!Ls(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Gs(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Ks(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):(r=n,e.convertToNoDocument(r.version).setHasCommittedMutations())}function Us(t,e,n,r){return t instanceof qs?function(t,e,n,r){if(!Ls(t.precondition,e))return n;const s=t.value.clone(),i=Hs(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof zs?function(t,e,n,r){if(!Ls(t.precondition,e))return n;const s=Hs(t.fieldTransforms,r,e),i=e.data;return i.setAll(Ks(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map(t=>t.field))}(t,e,n,r):(s=e,i=n,Ls(t.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):i);var s,i}function js(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=Is(r.transform,t||null);null!=s&&(null===n&&(n=mr.empty()),n.set(r.field,s))}return n||null}function Bs(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&He(n,r,(t,e)=>function(t,e){return t.field.isEqual(e.field)&&(n=t.transform,r=e.transform,n instanceof Cs&&r instanceof Cs||n instanceof ks&&r instanceof ks?He(n.elements,r.elements,er):n instanceof Ns&&r instanceof Ns?er(n.Ae,r.Ae):n instanceof Ss&&r instanceof Ss);var n,r}(t,e)))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask)));var n,r}class qs extends Ps{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class zs extends Ps{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ks(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function Gs(t,e,n){const r=new Map;Ce(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Ts(o,a,n[s]))}return r}function Hs(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,Es(t,i,e))}return r}class Qs extends Ps{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ws extends Ps{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Xs{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let r=0;r<this.mutations.length;r++){const e=this.mutations[r];e.key.isEqual(t.key)&&Fs(e,t,n[r])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Us(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Us(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=ds();return this.mutations.forEach(r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=Vs(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(hn.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),ms())}isEqual(t){return this.batchId===t.batchId&&He(this.mutations,t.mutations,(t,e)=>Bs(t,e))&&He(this.baseMutations,t.baseMutations,(t,e)=>Bs(t,e))}}class Ys{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Ce(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let r=function(){return ps}();const s=t.mutations;for(let i=0;i<s.length;i++)r=r.insert(s[i].key,n[i].version);return new Ys(t,e,n,r)}}class Js{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class Zs{constructor(t,e){this.count=t,this.unchangedNames=e}}var $s,ti;function ei(t){if(void 0===t)return be("GRPC error has no .code"),ke.UNKNOWN;switch(t){case $s.OK:return ke.OK;case $s.CANCELLED:return ke.CANCELLED;case $s.UNKNOWN:return ke.UNKNOWN;case $s.DEADLINE_EXCEEDED:return ke.DEADLINE_EXCEEDED;case $s.RESOURCE_EXHAUSTED:return ke.RESOURCE_EXHAUSTED;case $s.INTERNAL:return ke.INTERNAL;case $s.UNAVAILABLE:return ke.UNAVAILABLE;case $s.UNAUTHENTICATED:return ke.UNAUTHENTICATED;case $s.INVALID_ARGUMENT:return ke.INVALID_ARGUMENT;case $s.NOT_FOUND:return ke.NOT_FOUND;case $s.ALREADY_EXISTS:return ke.ALREADY_EXISTS;case $s.PERMISSION_DENIED:return ke.PERMISSION_DENIED;case $s.FAILED_PRECONDITION:return ke.FAILED_PRECONDITION;case $s.ABORTED:return ke.ABORTED;case $s.OUT_OF_RANGE:return ke.OUT_OF_RANGE;case $s.UNIMPLEMENTED:return ke.UNIMPLEMENTED;case $s.DATA_LOSS:return ke.DATA_LOSS;default:return Ie(39323,{code:t})}}(ti=$s||($s={}))[ti.OK=0]="OK",ti[ti.CANCELLED=1]="CANCELLED",ti[ti.UNKNOWN=2]="UNKNOWN",ti[ti.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ti[ti.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ti[ti.NOT_FOUND=5]="NOT_FOUND",ti[ti.ALREADY_EXISTS=6]="ALREADY_EXISTS",ti[ti.PERMISSION_DENIED=7]="PERMISSION_DENIED",ti[ti.UNAUTHENTICATED=16]="UNAUTHENTICATED",ti[ti.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ti[ti.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ti[ti.ABORTED=10]="ABORTED",ti[ti.OUT_OF_RANGE=11]="OUT_OF_RANGE",ti[ti.UNIMPLEMENTED=12]="UNIMPLEMENTED",ti[ti.INTERNAL=13]="INTERNAL",ti[ti.UNAVAILABLE=14]="UNAVAILABLE",ti[ti.DATA_LOSS=15]="DATA_LOSS";const ni=new ne([4294967295,4294967295],0);function ri(t){const e=(new TextEncoder).encode(t),n=new re;return n.update(e),new Uint8Array(n.digest())}function si(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ne([n,r],0),new ne([s,i],0)]}class ii{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new oi("Invalid padding: ".concat(e));if(n<0)throw new oi("Invalid hash count: ".concat(n));if(t.length>0&&0===this.hashCount)throw new oi("Invalid hash count: ".concat(n));if(0===t.length&&0!==e)throw new oi("Invalid padding when bitmap length is 0: ".concat(e));this.ge=8*t.length-e,this.pe=ne.fromNumber(this.ge)}ye(t,e,n){let r=t.add(e.multiply(ne.fromNumber(n)));return 1===r.compare(ni)&&(r=new ne([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.ge)return!1;const e=ri(t),[n,r]=si(e);for(let s=0;s<this.hashCount;s++){const t=this.ye(n,r,s);if(!this.we(t))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new ii(s,r,e);return n.forEach(t=>i.insert(t)),i}insert(t){if(0===this.ge)return;const e=ri(t),[n,r]=si(e);for(let s=0;s<this.hashCount;s++){const t=this.ye(n,r,s);this.Se(t)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class oi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ai{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,ci.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new ai(hn.min(),r,new An(Be),as(),ms())}}class ci{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new ci(n,e,ms(),ms(),ms())}}class ui{constructor(t,e,n,r){this.be=t,this.removedTargetIds=e,this.key=n,this.De=r}}class li{constructor(t,e){this.targetId=t,this.Ce=e}}class hi{constructor(t,e,n=Mn.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class di{constructor(){this.ve=0,this.Fe=gi(),this.Me=Mn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=ms(),e=ms(),n=ms();return this.Fe.forEach((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Ie(38017,{changeType:s})}}),new ci(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=gi()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,Ce(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class fi{constructor(t){this.Ge=t,this.ze=new Map,this.je=as(),this.Je=pi(),this.He=pi(),this.Ye=new An(Be)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:Ie(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach((t,n)=>{this.rt(n)&&e(n)})}st(t){const e=t.targetId,n=t.Ce.count,r=this.ot(e);if(r){const s=r.target;if(Kr(s))if(0===n){const t=new Ze(s.path);this.et(e,t,vr.newNoDocument(t,hn.min()))}else Ce(1===n,20013,{expectedCount:n});else{const r=this._t(e);if(r!==n){const n=this.ut(t),s=n?this.ct(n,t,r):1;if(0!==s){this.it(e);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,t)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=e;let i,o;try{i=Fn(n).toUint8Array()}catch(a){if(a instanceof xn)return Ee("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{o=new ii(i,r,s)}catch(a){return Ee(a instanceof oi?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return 0===o.ge?null:o}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let r=0;return n.forEach(n=>{const s=this.Ge.ht(),i="projects/".concat(s.projectId,"/databases/").concat(s.database,"/documents/").concat(n.path.canonicalString());t.mightContain(i)||(this.et(e,n,null),r++)}),r}Tt(t){const e=new Map;this.ze.forEach((n,r)=>{const s=this.ot(r);if(s){if(n.current&&Kr(s.target)){const e=new Ze(s.target.path);this.It(e).has(r)||this.Et(r,e)||this.et(r,e,vr.newNoDocument(e,t))}n.Be&&(e.set(r,n.ke()),n.qe())}});let n=ms();this.He.forEach((t,e)=>{let r=!0;e.forEachWhile(t=>{const e=this.ot(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)}),r&&(n=n.add(t))}),this.je.forEach((e,n)=>n.setReadTime(t));const r=new ai(t,e,this.Ye,this.je,n);return this.je=as(),this.Je=pi(),this.He=pi(),this.Ye=new An(Be),r}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const r=this.nt(t);this.Et(t,e)?r.Qe(e,1):r.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new di,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new Nn(Be),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new Nn(Be),this.Je=this.Je.insert(t,e)),e}rt(t){const e=null!==this.ot(t);return e||_e("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new di),this.Ge.getRemoteKeysForTarget(t).forEach(e=>{this.et(t,e,null)})}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function pi(){return new An(Ze.comparator)}function gi(){return new An(Ze.comparator)}const mi=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),yi=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),vi=(()=>({and:"AND",or:"OR"}))();class wi{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function _i(t,e){return t.useProto3Json||_n(e)?e:{value:e}}function bi(t,e){return t.useProto3Json?"".concat(new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+e.nanoseconds).slice(-9),"Z"):{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ei(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Ti(t,e){return bi(t,e.toTimestamp())}function Ii(t){return Ce(!!t,49232),hn.fromTimestamp(function(t){const e=Pn(t);return new ln(e.seconds,e.nanos)}(t))}function Si(t,e){return Ci(t,e).canonicalString()}function Ci(t,e){const n=(r=t,new Xe(["projects",r.projectId,"databases",r.database])).child("documents");var r;return void 0===e?n:n.child(e)}function Ai(t){const e=Xe.fromString(t);return Ce(Gi(e),10190,{key:e.toString()}),e}function ki(t,e){return Si(t.databaseId,e.path)}function Di(t,e){const n=Ai(e);if(n.get(1)!==t.databaseId.projectId)throw new De(ke.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new De(ke.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ze(Oi(n))}function Ni(t,e){return Si(t.databaseId,e)}function Ri(t){return new Xe(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Oi(t){return Ce(t.length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5)}function xi(t,e,n){return{name:ki(t,e),fields:n.value.mapValue.fields}}function Mi(t,e){return{documents:[Ni(t,e.path)]}}function Li(t,e){const n={structuredQuery:{}},r=e.path;let s;null!==e.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ni(t,s);const i=function(t){if(0!==t.length)return zi(Cr.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(t){if(0!==t.length)return t.map(t=>{return{field:Bi((e=t).field),direction:Fi(e.dir)};var e})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=_i(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt={before:(c=e.startAt).inclusive,values:c.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ft:n,parent:s};var c}function Pi(t){let e=function(t){const e=Ai(t);return 4===e.length?Xe.emptyPath():Oi(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Ce(1===r,65062);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=Vi(t);return e instanceof Cr&&kr(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>{return new Er(qi((e=t).field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction));var e}));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,_n(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new wr(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new wr(n,e)}(n.endAt)),function(t,e,n,r,s,i,o,a){return new Gr(t,e,n,r,s,i,o,a)}(e,s,o,i,a,"F",c,u)}function Vi(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=qi(t.unaryFilter.field);return Sr.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=qi(t.unaryFilter.field);return Sr.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=qi(t.unaryFilter.field);return Sr.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=qi(t.unaryFilter.field);return Sr.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ie(61313);default:return Ie(60726)}}(t):void 0!==t.fieldFilter?(e=t,Sr.create(qi(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ie(58110);default:return Ie(50506)}}(e.fieldFilter.op),e.fieldFilter.value)):void 0!==t.compositeFilter?function(t){return Cr.create(t.compositeFilter.filters.map(t=>Vi(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Ie(1026)}}(t.compositeFilter.op))}(t):Ie(30097,{filter:t});var e}function Fi(t){return mi[t]}function Ui(t){return yi[t]}function ji(t){return vi[t]}function Bi(t){return{fieldPath:t.canonicalString()}}function qi(t){return Je.fromServerFormat(t.fieldPath)}function zi(t){return t instanceof Sr?function(t){if("=="===t.op){if(fr(t.value))return{unaryFilter:{field:Bi(t.field),op:"IS_NAN"}};if(dr(t.value))return{unaryFilter:{field:Bi(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(fr(t.value))return{unaryFilter:{field:Bi(t.field),op:"IS_NOT_NAN"}};if(dr(t.value))return{unaryFilter:{field:Bi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bi(t.field),op:Ui(t.op),value:t.value}}}(t):t instanceof Cr?function(t){const e=t.getFilters().map(t=>zi(t));return 1===e.length?e[0]:{compositeFilter:{op:ji(t.op),filters:e}}}(t):Ie(54877,{filter:t})}function Ki(t){const e=[];return t.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Gi(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Hi{constructor(t,e,n,r,s=hn.min(),i=hn.min(),o=Mn.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Hi(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Hi(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Hi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Hi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Qi{constructor(t){this.yt=t}}function Wi(t){const e=Pi({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Zr(e,e.limit,"L"):e}class Xi{constructor(){this.Cn=new Yi}addToCollectionParentIndex(t,e){return this.Cn.add(e),yn.resolve()}getCollectionParents(t,e){return yn.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return yn.resolve()}deleteFieldIndex(t,e){return yn.resolve()}deleteAllFieldIndexes(t){return yn.resolve()}createTargetIndexes(t,e){return yn.resolve()}getDocumentsMatchingTarget(t,e){return yn.resolve(null)}getIndexType(t,e){return yn.resolve(0)}getFieldIndexes(t,e){return yn.resolve([])}getNextCollectionGroupToUpdate(t){return yn.resolve(null)}getMinOffset(t,e){return yn.resolve(fn.min())}getMinOffsetFromCollectionGroup(t,e){return yn.resolve(fn.min())}updateCollectionGroup(t,e,n){return yn.resolve()}updateIndexEntries(t,e){return yn.resolve()}}class Yi{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Nn(Xe.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Nn(Xe.comparator)).toArray()}}const Ji={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Zi=41943040;class $i{static withCacheSize(t){return new $i(t,$i.DEFAULT_COLLECTION_PERCENTILE,$i.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}$i.DEFAULT_COLLECTION_PERCENTILE=10,$i.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$i.DEFAULT=new $i(Zi,$i.DEFAULT_COLLECTION_PERCENTILE,$i.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$i.DISABLED=new $i(-1,0,0);class to{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new to(0)}static cr(){return new to(-1)}}const eo="LruGarbageCollector";function no([t,e],[n,r]){const s=Be(t,n);return 0===s?Be(e,r):s}class ro{constructor(t){this.Ir=t,this.buffer=new Nn(no),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();no(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class so{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(t){_e(eo,"Garbage collection scheduled in ".concat(t,"ms")),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){vn(t)?_e(eo,"Ignoring IndexedDB error during garbage collection: ",t):await mn(t)}await this.Vr(3e5)})}}class io{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next(t=>Math.floor(e/100*t))}nthSequenceNumber(t,e){if(0===e)return yn.resolve(wn.ce);const n=new ro(e);return this.mr.forEachTarget(t,t=>n.Ar(t.sequenceNumber)).next(()=>this.mr.pr(t,t=>n.Ar(t))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(_e("LruGarbageCollector","Garbage collection skipped; disabled"),yn.resolve(Ji)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(_e("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(n," is lower than threshold ").concat(this.params.cacheSizeCollectionThreshold)),Ji):this.yr(t,e))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,r,s,i,o,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(e>this.params.maximumSequenceNumbersToCollect?(_e("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(this.params.maximumSequenceNumbersToCollect," from ").concat(e)),r=this.params.maximumSequenceNumbersToCollect):r=e,i=Date.now(),this.nthSequenceNumber(t,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(t,n,e))).next(e=>(s=e,a=Date.now(),this.removeOrphanedDocuments(t,n))).next(t=>(c=Date.now(),we()<=N.DEBUG&&_e("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(i-u,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-i)+"ms\n"+"\tRemoved ".concat(s," targets in ")+(a-o)+"ms\n"+"\tRemoved ".concat(t," documents in ")+(c-a)+"ms\n"+"Total Duration: ".concat(c-u,"ms")),yn.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:t})))}}class oo{constructor(){this.changes=new is(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,vr.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?yn.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class ao{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class co{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(r=>(n=r,this.remoteDocumentCache.getEntry(t,e))).next(t=>(null!==n&&Us(n.mutation,t,On.empty(),ln.now()),t))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,ms()).next(()=>e))}getLocalViewOfDocuments(t,e,n=ms()){const r=hs();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,n).next(t=>{let e=us();return t.forEach((t,n)=>{e=e.insert(t,n.overlayedDocument)}),e}))}getOverlayedDocuments(t,e){const n=hs();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,ms()))}populateOverlays(t,e,n){const r=[];return n.forEach(t=>{e.has(t)||r.push(t)}),this.documentOverlayCache.getOverlays(t,r).next(t=>{t.forEach((t,n)=>{e.set(t,n)})})}computeViews(t,e,n,r){let s=as();const i=fs(),o=fs();return e.forEach((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof zs)?s=s.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),Us(o.mutation,e,o.mutation.getFieldMask(),ln.now())):i.set(e.key,On.empty())}),this.recalculateAndSaveOverlays(t,s).next(t=>(t.forEach((t,e)=>i.set(t,e)),e.forEach((t,e)=>{var n;return o.set(t,new ao(e,null!=(n=i.get(t))?n:null))}),o))}recalculateAndSaveOverlays(t,e){const n=fs();let r=new An((t,e)=>t-e),s=ms();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(t=>{for(const s of t)s.keys().forEach(t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||On.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||ms()).add(t);r=r.insert(s.batchId,a)})}).next(()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=ds();c.forEach(t=>{if(!s.has(t)){const r=Vs(e.get(t),n.get(t));null!==r&&u.set(t,r),s=s.add(t)}}),i.push(this.documentOverlayCache.saveOverlays(t,a,u))}return yn.waitFor(i)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(t,e,n,r){return s=e,Ze.isDocumentKey(s.path)&&null===s.collectionGroup&&0===s.filters.length?this.getDocumentsMatchingDocumentQuery(t,e.path):Wr(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r);var s}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next(s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):yn.resolve(hs());let o=-1,a=s;return i.next(e=>yn.forEach(e,(e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?yn.resolve():this.remoteDocumentCache.getEntry(t,e).next(t=>{a=a.insert(e,t)}))).next(()=>this.populateOverlays(t,e,s)).next(()=>this.computeViews(t,a,e,ms())).next(t=>({batchId:o,changes:ls(t)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Ze(e)).next(t=>{let e=us();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const s=e.collectionGroup;let i=us();return this.indexManager.getCollectionParents(t,s).next(o=>yn.forEach(o,o=>{const a=(c=e,u=o.child(s),new Gr(u,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,u;return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next(t=>{t.forEach((t,e)=>{i=i.insert(t,e)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(t,e,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,r))).next(t=>{s.forEach((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,vr.newInvalidDocument(r)))});let n=us();return t.forEach((t,r)=>{const i=s.get(t);void 0!==i&&Us(i.mutation,r,On.empty(),ln.now()),ns(e,r)&&(n=n.insert(t,r))}),n})}}class uo{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return yn.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,{id:(n=e).id,version:n.version,createTime:Ii(n.createTime)}),yn.resolve();var n}getNamedQuery(t,e){return yn.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,{name:(n=e).name,query:Wi(n.bundledQuery),readTime:Ii(n.readTime)}),yn.resolve();var n}}class lo{constructor(){this.overlays=new An(Ze.comparator),this.qr=new Map}getOverlay(t,e){return yn.resolve(this.overlays.get(e))}getOverlays(t,e){const n=hs();return yn.forEach(e,e=>this.getOverlay(t,e).next(t=>{null!==t&&n.set(e,t)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((n,r)=>{this.St(t,e,r)}),yn.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach(t=>this.overlays=this.overlays.remove(t)),this.qr.delete(n)),yn.resolve()}getOverlaysForCollection(t,e,n){const r=hs(),s=e.length+1,i=new Ze(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return yn.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new An((t,e)=>t-e);const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=hs(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=hs(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((t,e)=>o.set(t,e)),!(o.size()>=r)););return yn.resolve(o)}St(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Js(e,n));let s=this.qr.get(e);void 0===s&&(s=ms(),this.qr.set(e,s)),this.qr.set(e,s.add(n.key))}}class ho{constructor(){this.sessionToken=Mn.EMPTY_BYTE_STRING}getSessionToken(t){return yn.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,yn.resolve()}}class fo{constructor(){this.Qr=new Nn(po.$r),this.Ur=new Nn(po.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new po(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.Gr(new po(t,e))}zr(t,e){t.forEach(t=>this.removeReference(t,e))}jr(t){const e=new Ze(new Xe([])),n=new po(e,t),r=new po(e,t+1),s=[];return this.Ur.forEachInRange([n,r],t=>{this.Gr(t),s.push(t.key)}),s}Jr(){this.Qr.forEach(t=>this.Gr(t))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new Ze(new Xe([])),n=new po(e,t),r=new po(e,t+1);let s=ms();return this.Ur.forEachInRange([n,r],t=>{s=s.add(t.key)}),s}containsKey(t){const e=new po(t,0),n=this.Qr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class po{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return Ze.comparator(t.key,e.key)||Be(t.Yr,e.Yr)}static Kr(t,e){return Be(t.Yr,e.Yr)||Ze.comparator(t.key,e.key)}}class go{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new Nn(po.$r)}checkEmpty(t){return yn.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Xs(s,e,n,r);this.mutationQueue.push(i);for(const o of r)this.Zr=this.Zr.add(new po(o.key,s)),this.indexManager.addToCollectionParentIndex(t,o.key.path.popLast());return yn.resolve(i)}lookupMutationBatch(t,e){return yn.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.ei(n),s=r<0?0:r;return yn.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return yn.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(t){return yn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new po(e,0),r=new po(e,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,r],t=>{const e=this.Xr(t.Yr);s.push(e)}),yn.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Nn(Be);return e.forEach(t=>{const e=new po(t,0),r=new po(t,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([e,r],t=>{n=n.add(t.Yr)})}),yn.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;Ze.isDocumentKey(s)||(s=s.child(""));const i=new po(new Ze(s),0);let o=new Nn(Be);return this.Zr.forEachWhile(t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.Yr)),!0)},i),yn.resolve(this.ti(o))}ti(t){const e=[];return t.forEach(t=>{const n=this.Xr(t);null!==n&&e.push(n)}),e}removeMutationBatch(t,e){Ce(0===this.ni(e.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return yn.forEach(e.mutations,r=>{const s=new po(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)}).next(()=>{this.Zr=n})}ir(t){}containsKey(t,e){const n=new po(e,0),r=this.Zr.firstAfterOrEqual(n);return yn.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,yn.resolve()}ni(t,e){return this.ei(t)}ei(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class mo{constructor(t){this.ri=t,this.docs=new An(Ze.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return yn.resolve(n?n.document.mutableCopy():vr.newInvalidDocument(e))}getEntries(t,e){let n=as();return e.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():vr.newInvalidDocument(t))}),yn.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let s=as();const i=e.path,o=new Ze(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||pn(dn(o),n)<=0||(r.has(o.key)||ns(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return yn.resolve(s)}getAllFromCollectionGroup(t,e,n,r){Ie(9500)}ii(t,e){return yn.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new yo(this)}getSize(t){return yn.resolve(this.size)}}class yo extends oo{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?e.push(this.Nr.addEntry(t,r)):this.Nr.removeEntry(n)}),yn.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class vo{constructor(t){this.persistence=t,this.si=new is(t=>qr(t),zr),this.lastRemoteSnapshotVersion=hn.min(),this.highestTargetId=0,this.oi=0,this._i=new fo,this.targetCount=0,this.ai=to.ur()}forEachTarget(t,e){return this.si.forEach((t,n)=>e(n)),yn.resolve()}getLastRemoteSnapshotVersion(t){return yn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return yn.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),yn.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),yn.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new to(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,yn.resolve()}updateTargetData(t,e){return this.Pr(e),yn.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,yn.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.si.forEach((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.si.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)}),yn.waitFor(s).next(()=>r)}getTargetCount(t){return yn.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return yn.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),yn.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach(e=>{s.push(r.markPotentiallyOrphaned(t,e))}),yn.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),yn.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return yn.resolve(n)}containsKey(t,e){return yn.resolve(this._i.containsKey(e))}}class wo{constructor(t,e){this.ui={},this.overlays={},this.ci=new wn(0),this.li=!1,this.li=!0,this.hi=new ho,this.referenceDelegate=t(this),this.Pi=new vo(this),this.indexManager=new Xi,this.remoteDocumentCache=new mo(t=>this.referenceDelegate.Ti(t)),this.serializer=new Qi(e),this.Ii=new uo(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new lo,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new go(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){_e("MemoryPersistence","Starting transaction:",t);const r=new _o(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(t=>this.referenceDelegate.di(r).next(()=>t)).toPromise().then(t=>(r.raiseOnCommittedEvent(),t))}Ai(t,e){return yn.or(Object.values(this.ui).map(n=>()=>n.containsKey(t,e)))}}class _o extends gn{constructor(t){super(),this.currentSequenceNumber=t}}class bo{constructor(t){this.persistence=t,this.Ri=new fo,this.Vi=null}static mi(t){return new bo(t)}get fi(){if(this.Vi)return this.Vi;throw Ie(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),yn.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),yn.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),yn.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach(t=>this.fi.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(t=>{t.forEach(t=>this.fi.add(t.toString()))}).next(()=>n.removeTargetData(t,e))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return yn.forEach(this.fi,n=>{const r=Ze.fromPath(n);return this.gi(t,r).next(t=>{t||e.removeEntry(r,hn.min())})}).next(()=>(this.Vi=null,e.apply(t)))}updateLimboDocument(t,e){return this.gi(t,e).next(t=>{t?this.fi.delete(e.toString()):this.fi.add(e.toString())})}Ti(t){return 0}gi(t,e){return yn.or([()=>yn.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class Eo{constructor(t,e){this.persistence=t,this.pi=new is(t=>function(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Tn(e)),e=En(t.get(n),e);return Tn(e)}(t.path),(t,e)=>t.isEqual(e)),this.garbageCollector=function(t,e){return new io(t,e)}(this,e)}static mi(t,e){return new Eo(t,e)}Ei(){}di(t){return yn.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next(t=>e.next(e=>t+e))}wr(t){let e=0;return this.pr(t,t=>{e++}).next(()=>e)}pr(t,e){return yn.forEach(this.pi,(n,r)=>this.br(t,n,r).next(t=>t?yn.resolve():e(r)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ii(t,r=>this.br(t,r,e).next(t=>{t||(n++,s.removeEntry(r,hn.min()))})).next(()=>s.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),yn.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),yn.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),yn.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),yn.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=cr(t.data.value)),e}br(t,e,n){return yn.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.pi.get(e);return yn.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class To{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=r}static As(t,e){let n=ms(),r=ms();for(const s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new To(t,e.fromCache,n,r)}}class Io{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class So{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=y()?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,r){const s={result:null};return this.ys(t,e).next(t=>{s.result=t}).next(()=>{if(!s.result)return this.ws(t,e,r,n).next(t=>{s.result=t})}).next(()=>{if(s.result)return;const n=new Io;return this.Ss(t,e,n).next(r=>{if(s.result=r,this.Vs)return this.bs(t,e,n,r.size)})}).next(()=>s.result)}bs(t,e,n,r){return n.documentReadCount<this.fs?(we()<=N.DEBUG&&_e("QueryEngine","SDK will not create cache indexes for query:",es(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),yn.resolve()):(we()<=N.DEBUG&&_e("QueryEngine","Query:",es(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(we()<=N.DEBUG&&_e("QueryEngine","The SDK decides to create cache indexes for query:",es(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Yr(e))):yn.resolve())}ys(t,e){if(Qr(e))return yn.resolve(null);let n=Yr(e);return this.indexManager.getIndexType(t,n).next(r=>0===r?null:(null!==e.limit&&1===r&&(e=Zr(e,null,"F"),n=Yr(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(r=>{const s=ms(...r);return this.ps.getDocuments(t,s).next(r=>this.indexManager.getMinOffset(t,n).next(n=>{const i=this.Ds(e,r);return this.Cs(e,i,s,n.readTime)?this.ys(t,Zr(e,null,"F")):this.vs(t,i,e,n)}))})))}ws(t,e,n,r){return Qr(e)||r.isEqual(hn.min())?yn.resolve(null):this.ps.getDocuments(t,n).next(s=>{const i=this.Ds(e,s);return this.Cs(e,i,n,r)?yn.resolve(null):(we()<=N.DEBUG&&_e("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),es(e)),this.vs(t,i,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=hn.fromTimestamp(1e9===r?new ln(n+1,0):new ln(n,r));return new fn(s,Ze.empty(),e)}(r,-1)).next(t=>t))})}Ds(t,e){let n=new Nn(rs(t));return e.forEach((e,r)=>{ns(t,r)&&(n=n.add(r))}),n}Cs(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ss(t,e,n){return we()<=N.DEBUG&&_e("QueryEngine","Using full collection scan to execute query:",es(e)),this.ps.getDocumentsMatchingQuery(t,e,fn.min(),n)}vs(t,e,n,r){return this.ps.getDocumentsMatchingQuery(t,n,r).next(t=>(e.forEach(e=>{t=t.insert(e.key,e)}),t))}}const Co="LocalStore";class Ao{constructor(t,e,n,r){this.persistence=t,this.Fs=e,this.serializer=r,this.Ms=new An(Be),this.xs=new is(t=>qr(t),zr),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new co(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}}async function ko(t,e){const n=Ae(t);return await n.persistence.runTransaction("Handle user change","readonly",t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next(s=>(r=s,n.Bs(e),n.mutationQueue.getAllMutationBatches(t))).next(e=>{const s=[],i=[];let o=ms();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next(t=>({Ls:t,removedBatchIds:s,addedBatchIds:i}))})})}function Do(t){const e=Ae(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function No(t,e){const n=Ae(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const i=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const o=[];e.targetChanges.forEach((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Pi.removeMatchingKeys(t,i.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(t,i.addedDocuments,a)));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(Mn.EMPTY_BYTE_STRING,hn.min()).withLastLimboFreeSnapshotVersion(hn.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(t,e,n){if(0===t.resumeToken.approximateByteSize())return!0;if(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8)return!0;return n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,i)&&o.push(n.Pi.updateTargetData(t,u))});let a=as(),c=ms();if(e.documentUpdates.forEach(r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),o.push(function(t,e,n){let r=ms(),s=ms();return n.forEach(t=>r=r.add(t)),e.getEntries(t,r).next(t=>{let r=as();return n.forEach((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(hn.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):_e(Co,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)}),{ks:r,qs:s}})}(t,i,e.documentUpdates).next(t=>{a=t.ks,c=t.qs})),!r.isEqual(hn.min())){const e=n.Pi.getLastRemoteSnapshotVersion(t).next(e=>n.Pi.setTargetsMetadata(t,t.currentSequenceNumber,r));o.push(e)}return yn.waitFor(o).next(()=>i.apply(t)).next(()=>n.localDocuments.getLocalViewOfDocuments(t,a,c)).next(()=>a)}).then(t=>(n.Ms=s,t))}function Ro(t,e){const n=Ae(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)))}async function Oo(t,e,n){const r=Ae(t),s=r.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,t=>r.persistence.referenceDelegate.removeTarget(t,s))}catch(o){if(!vn(o))throw o;_e(Co,"Failed to update sequence numbers for target ".concat(e,": ").concat(o))}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function xo(t,e,n){const r=Ae(t);let s=hn.min(),i=ms();return r.persistence.runTransaction("Execute query","readwrite",t=>function(t,e,n){const r=Ae(t),s=r.xs.get(n);return void 0!==s?yn.resolve(r.Ms.get(s)):r.Pi.getTargetData(e,n)}(r,t,Yr(e)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(t,e.targetId).next(t=>{i=t})}).next(()=>r.Fs.getDocumentsMatchingQuery(t,e,n?s:hn.min(),n?i:ms())).next(t=>(function(t,e,n){let r=t.Os.get(e)||hn.min();n.forEach((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)}),t.Os.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,Qs:i})))}class Mo{constructor(){this.activeTargetIds=ys}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Lo{constructor(){this.Mo=new Mo,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Mo,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Po{Oo(t){}shutdown(){}}const Vo="ConnectivityMonitor";class Fo{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){_e(Vo,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){_e(Vo,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Uo=null;function jo(){return null===Uo?Uo=268435456+Math.round(2147483648*Math.random()):Uo++,"0x"+Uo.toString(16)}const Bo="RestConnection",qo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class zo{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko="projects/".concat(n,"/databases/").concat(r),this.Wo=this.databaseId.database===Qn?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}Go(t,e,n,r,s){const i=jo(),o=this.zo(t,e.toUriEncodedString());_e(Bo,"Sending RPC '".concat(t,"' ").concat(i,":"),o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,s);const{host:c}=new URL(o),u=h(c);return this.Jo(t,o,a,n,u).then(e=>(_e(Bo,"Received RPC '".concat(t,"' ").concat(i,": "),e),e),e=>{throw Ee(Bo,"RPC '".concat(t,"' ").concat(i," failed with error: "),e,"url: ",o,"request:",n),e})}Ho(t,e,n,r,s,i){return this.Go(t,e,n,r,s)}jo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+ye,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,n)=>t[n]=e),n&&n.headers.forEach((e,n)=>t[n]=e)}zo(t,e){const n=qo[t];return"".concat(this.Uo,"/v1/").concat(e,":").concat(n)}terminate(){}}class Ko{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const Go="WebChannelConnection";class Ho extends zo{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,r,s){const i=jo();return new Promise((s,o)=>{const a=new ie;a.setWithCredentials(!0),a.listenOnce(ae.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case ce.NO_ERROR:const e=a.getResponseJson();_e(Go,"XHR for RPC '".concat(t,"' ").concat(i," received:"),JSON.stringify(e)),s(e);break;case ce.TIMEOUT:_e(Go,"RPC '".concat(t,"' ").concat(i," timed out")),o(new De(ke.DEADLINE_EXCEEDED,"Request time out"));break;case ce.HTTP_ERROR:const n=a.getStatus();if(_e(Go,"RPC '".concat(t,"' ").concat(i," failed with status:"),n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(ke).indexOf(e)>=0?e:ke.UNKNOWN}(e.status);o(new De(t,e.message))}else o(new De(ke.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new De(ke.UNAVAILABLE,"Connection failed."));break;default:Ie(9055,{l_:t,streamId:i,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{_e(Go,"RPC '".concat(t,"' ").concat(i," completed."))}});const c=JSON.stringify(r);_e(Go,"RPC '".concat(t,"' ").concat(i," sending request:"),r),a.send(e,"POST",c,n,15)})}T_(t,e,n){const r=jo(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=de(),o=he(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=s.join("");_e(Go,"Creating RPC '".concat(t,"' stream ").concat(r,": ").concat(u),a);const l=i.createWebChannel(u,a);this.I_(l);let h=!1,d=!1;const f=new Ko({Yo:e=>{d?_e(Go,"Not sending because RPC '".concat(t,"' stream ").concat(r," is closed:"),e):(h||(_e(Go,"Opening RPC '".concat(t,"' stream ").concat(r," transport.")),l.open(),h=!0),_e(Go,"RPC '".concat(t,"' stream ").concat(r," sending:"),e),l.send(e))},Zo:()=>l.close()}),p=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(e){setTimeout(()=>{throw e},0)}})};return p(l,oe.EventType.OPEN,()=>{d||(_e(Go,"RPC '".concat(t,"' stream ").concat(r," transport opened.")),f.o_())}),p(l,oe.EventType.CLOSE,()=>{d||(d=!0,_e(Go,"RPC '".concat(t,"' stream ").concat(r," transport closed")),f.a_(),this.E_(l))}),p(l,oe.EventType.ERROR,e=>{d||(d=!0,Ee(Go,"RPC '".concat(t,"' stream ").concat(r," transport errored. Name:"),e.name,"Message:",e.message),f.a_(new De(ke.UNAVAILABLE,"The operation could not be completed")))}),p(l,oe.EventType.MESSAGE,e=>{var n;if(!d){const s=e.data[0];Ce(!!s,16349);const i=s,o=(null==i?void 0:i.error)||(null==(n=i[0])?void 0:n.error);if(o){_e(Go,"RPC '".concat(t,"' stream ").concat(r," received error:"),o);const e=o.status;let n=function(t){const e=$s[t];if(void 0!==e)return ei(e)}(e),s=o.message;void 0===n&&(n=ke.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.a_(new De(n,s)),l.close()}else _e(Go,"RPC '".concat(t,"' stream ").concat(r," received:"),s),f.u_(s)}}),p(o,le.STAT_EVENT,e=>{e.stat===ue.PROXY?_e(Go,"RPC '".concat(t,"' stream ").concat(r," detected buffering proxy")):e.stat===ue.NOPROXY&&_e(Go,"RPC '".concat(t,"' stream ").concat(r," detected no buffering proxy"))}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(t=>t.close()),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter(e=>e===t)}}function Qo(){return"undefined"!=typeof document?document:null}function Wo(t){return new wi(t,!0)}class Xo{constructor(t,e,n=1e3,r=1.5,s=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=r,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,e-n);r>0&&_e("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.V_," ms, delay with jitter: ").concat(e," ms, last attempt: ").concat(n," ms ago)")),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),t())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Yo="PersistentStream";class Jo{constructor(t,e,n,r,s,i,o,a){this.Mi=t,this.S_=n,this.b_=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Xo(t,e)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==t?this.M_.reset():e&&e.code===ke.RESOURCE_EXHAUSTED?(be(e.toString()),be("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===ke.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([t,n])=>{this.D_===e&&this.G_(t,n)},e=>{t(()=>{const t=new De(ke.UNKNOWN,"Fetching auth token failed: "+e.message);return this.z_(t)})})}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(t=>{n(()=>this.z_(t))}),this.stream.onMessage(t=>{n(()=>1==++this.F_?this.J_(t):this.onNext(t))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(t){return _e(Yo,"close with error: ".concat(t)),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget(()=>this.D_===t?e():(_e(Yo,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Zo extends Jo{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s="NO_CHANGE"===(r=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:Ie(39313,{state:r}),i=e.targetChange.targetIds||[],o=function(t,e){return t.useProto3Json?(Ce(void 0===e||"string"==typeof e,58123),Mn.fromBase64String(e||"")):(Ce(void 0===e||e instanceof Buffer||e instanceof Uint8Array,16193),Mn.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(t){const e=void 0===t.code?ke.UNKNOWN:ei(t.code);return new De(e,t.message||"")}(a);n=new hi(s,i,o,c||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Di(t,r.document.name),i=Ii(r.document.updateTime),o=r.document.createTime?Ii(r.document.createTime):hn.min(),a=new mr({mapValue:{fields:r.document.fields}}),c=vr.newFoundDocument(s,i,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new ui(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Di(t,r.document),i=r.readTime?Ii(r.readTime):hn.min(),o=vr.newNoDocument(s,i),a=r.removedTargetIds||[];n=new ui([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Di(t,r.document),i=r.removedTargetIds||[];n=new ui([],i,s,null)}else{if(!("filter"in e))return Ie(11601,{Rt:e});{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:s}=t,i=new Zs(r,s),o=t.targetId;n=new li(o,i)}}var r;return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return hn.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?hn.min():e.readTime?Ii(e.readTime):hn.min()}(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=Ri(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Kr(r)?{documents:Mi(t,r)}:{query:Li(t,r).ft},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=Ei(t,e.resumeToken);const r=_i(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(hn.min())>0){n.readTime=bi(t,e.snapshotVersion.toTimestamp());const r=_i(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ie(28987,{purpose:t})}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=Ri(this.serializer),e.removeTarget=t,this.q_(e)}}class $o extends Jo{constructor(t,e,n,r,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return Ce(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,Ce(!t.writeResults||0===t.writeResults.length,55816),this.listener.ta()}onNext(t){Ce(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=function(t,e){return t&&t.length>0?(Ce(void 0!==e,14353),t.map(t=>function(t,e){let n=t.updateTime?Ii(t.updateTime):Ii(e);return n.isEqual(hn.min())&&(n=Ii(e)),new xs(n,t.transformResults||[])}(t,e))):[]}(t.writeResults,t.commitTime),n=Ii(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=Ri(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>function(t,e){let n;if(e instanceof qs)n={update:xi(t,e.key,e.value)};else if(e instanceof Qs)n={delete:ki(t,e.key)};else if(e instanceof zs)n={update:xi(t,e.key,e.data),updateMask:Ki(e.fieldMask)};else{if(!(e instanceof Ws))return Ie(16599,{Vt:e.type});n={verify:ki(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(t=>function(t,e){const n=e.transform;if(n instanceof Ss)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Cs)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ks)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ns)return{fieldPath:e.field.canonicalString(),increment:n.Ae};throw Ie(20930,{transform:e.transform})}(0,t))),e.precondition.isNone||(n.currentDocument=(r=t,void 0!==(s=e.precondition).updateTime?{updateTime:Ti(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:Ie(27497))),n;var r,s}(this.serializer,t))};this.q_(e)}}class ta{}class ea extends ta{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new De(ke.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.connection.Go(t,Ci(e,n),r,s,i)).catch(t=>{throw"FirebaseError"===t.name?(t.code===ke.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new De(ke.UNKNOWN,t.toString())})}Ho(t,e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Ho(t,Ci(e,n),r,i,o,s)).catch(t=>{throw"FirebaseError"===t.name?(t.code===ke.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new De(ke.UNKNOWN,t.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class na{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: ".concat(t.toString())),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,"Online"===t&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e="Could not reach Cloud Firestore backend. ".concat(t,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.aa?(be(e),this.aa=!1):_e("OnlineStateTracker",e)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const ra="RemoteStore";class sa{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(t=>{n.enqueueAndForget(async()=>{fa(this)&&(_e(ra,"Restarting streams for network reachability change."),await async function(t){const e=Ae(t);e.Ea.add(4),await oa(e),e.Ra.set("Unknown"),e.Ea.delete(4),await ia(e)}(this))})}),this.Ra=new na(n,r)}}async function ia(t){if(fa(t))for(const e of t.da)await e(!0)}async function oa(t){for(const e of t.da)await e(!1)}function aa(t,e){const n=Ae(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),da(n)?ha(n):Ra(n).O_()&&ua(n,e))}function ca(t,e){const n=Ae(t),r=Ra(n);n.Ia.delete(e),r.O_()&&la(n,e),0===n.Ia.size&&(r.O_()?r.L_():fa(n)&&n.Ra.set("Unknown"))}function ua(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(hn.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ra(t).Y_(e)}function la(t,e){t.Va.Ue(e),Ra(t).Z_(e)}function ha(t){t.Va=new fi({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),Ra(t).start(),t.Ra.ua()}function da(t){return fa(t)&&!Ra(t).x_()&&t.Ia.size>0}function fa(t){return 0===Ae(t).Ea.size}function pa(t){t.Va=void 0}async function ga(t){t.Ra.set("Online")}async function ma(t){t.Ia.forEach((e,n)=>{ua(t,e)})}async function ya(t,e){pa(t),da(t)?(t.Ra.ha(e),ha(t)):t.Ra.set("Unknown")}async function va(t,e,n){if(t.Ra.set("Online"),e instanceof hi&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Ia.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Ia.delete(r),t.Va.removeTarget(r))}(t,e)}catch(r){_e(ra,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await wa(t,r)}else if(e instanceof ui?t.Va.Ze(e):e instanceof li?t.Va.st(e):t.Va.tt(e),!n.isEqual(hn.min()))try{const e=await Do(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Va.Tt(e);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.Ia.get(r);s&&t.Ia.set(r,s.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach((e,n)=>{const r=t.Ia.get(e);if(!r)return;t.Ia.set(e,r.withResumeToken(Mn.EMPTY_BYTE_STRING,r.snapshotVersion)),la(t,e);const s=new Hi(r.target,e,n,r.sequenceNumber);ua(t,s)}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(s){_e(ra,"Failed to raise snapshot:",s),await wa(t,s)}}async function wa(t,e,n){if(!vn(e))throw e;t.Ea.add(1),await oa(t),t.Ra.set("Offline"),n||(n=()=>Do(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{_e(ra,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await ia(t)})}function _a(t,e){return e().catch(n=>wa(t,n,e))}async function ba(t){const e=Ae(t),n=Oa(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;Ea(e);)try{const t=await Ro(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,Ta(e,t)}catch(s){await wa(e,s)}Ia(e)&&Sa(e)}function Ea(t){return fa(t)&&t.Ta.length<10}function Ta(t,e){t.Ta.push(e);const n=Oa(t);n.O_()&&n.X_&&n.ea(e.mutations)}function Ia(t){return fa(t)&&!Oa(t).x_()&&t.Ta.length>0}function Sa(t){Oa(t).start()}async function Ca(t){Oa(t).ra()}async function Aa(t){const e=Oa(t);for(const n of t.Ta)e.ea(n.mutations)}async function ka(t,e,n){const r=t.Ta.shift(),s=Ys.from(r,e,n);await _a(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await ba(t)}async function Da(t,e){e&&Oa(t).X_&&await async function(t,e){if(function(t){switch(t){case ke.OK:return Ie(64938);case ke.CANCELLED:case ke.UNKNOWN:case ke.DEADLINE_EXCEEDED:case ke.RESOURCE_EXHAUSTED:case ke.INTERNAL:case ke.UNAVAILABLE:case ke.UNAUTHENTICATED:return!1;case ke.INVALID_ARGUMENT:case ke.NOT_FOUND:case ke.ALREADY_EXISTS:case ke.PERMISSION_DENIED:case ke.FAILED_PRECONDITION:case ke.ABORTED:case ke.OUT_OF_RANGE:case ke.UNIMPLEMENTED:case ke.DATA_LOSS:return!0;default:return Ie(15467,{code:t})}}(n=e.code)&&n!==ke.ABORTED){const n=t.Ta.shift();Oa(t).B_(),await _a(t,()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e)),await ba(t)}var n}(t,e),Ia(t)&&Sa(t)}async function Na(t,e){const n=Ae(t);n.asyncQueue.verifyOperationInProgress(),_e(ra,"RemoteStore received new credentials");const r=fa(n);n.Ea.add(3),await oa(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await ia(n)}function Ra(t){return t.ma||(t.ma=function(t,e,n){const r=Ae(t);return r.sa(),new Zo(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Xo:ga.bind(null,t),t_:ma.bind(null,t),r_:ya.bind(null,t),H_:va.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),da(t)?ha(t):t.Ra.set("Unknown")):(await t.ma.stop(),pa(t))})),t.ma}function Oa(t){return t.fa||(t.fa=function(t,e,n){const r=Ae(t);return r.sa(),new $o(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:Ca.bind(null,t),r_:Da.bind(null,t),ta:Aa.bind(null,t),na:ka.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await ba(t)):(await t.fa.stop(),t.Ta.length>0&&(_e(ra,"Stopping write stream with ".concat(t.Ta.length," pending writes")),t.Ta=[]))})),t.fa}class xa{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new Ne,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(t=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new xa(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new De(ke.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ma(t,e){if(be("AsyncQueue","".concat(e,": ").concat(t)),vn(t))return new De(ke.UNAVAILABLE,"".concat(e,": ").concat(t));throw t}class La{static emptySet(t){return new La(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||Ze.comparator(e.key,n.key):(t,e)=>Ze.comparator(t.key,e.key),this.keyedMap=us(),this.sortedSet=new An(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof La))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new La;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Pa{constructor(){this.ga=new An(Ze.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?0!==t.type&&3===n.type?this.ga=this.ga.insert(e,t):3===t.type&&1!==n.type?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ga=this.ga.remove(e):1===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):Ie(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal((e,n)=>{t.push(n)}),t}}class Va{constructor(t,e,n,r,s,i,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new Va(t,e,La.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&$r(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0}}class Fa{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(t=>t.Da())}}class Ua{constructor(){this.queries=ja(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(t,e){const n=Ae(t),r=n.queries;n.queries=ja(),r.forEach((t,n)=>{for(const r of n.Sa)r.onError(e)})}(this,new De(ke.ABORTED,"Firestore shutting down"))}}function ja(){return new is(t=>ts(t),$r)}async function Ba(t,e){const n=Ae(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new Fa,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const t=Ma(o,"Initialization of query '".concat(es(e.query),"' failed"));return void e.onError(t)}n.queries.set(s,i),i.Sa.push(e),e.va(n.onlineState),i.wa&&e.Fa(i.wa)&&Ga(n)}async function qa(t,e){const n=Ae(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const t=i.Sa.indexOf(e);t>=0&&(i.Sa.splice(t,1),0===i.Sa.length?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function za(t,e){const n=Ae(t);let r=!1;for(const s of e){const t=s.query,e=n.queries.get(t);if(e){for(const t of e.Sa)t.Fa(s)&&(r=!0);e.wa=s}}r&&Ga(n)}function Ka(t,e,n){const r=Ae(t),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(n);r.queries.delete(e)}function Ga(t){t.Ca.forEach(t=>{t.next()})}var Ha,Qa;(Qa=Ha||(Ha={})).Ma="default",Qa.Cache="cache";class Wa{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Va(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==e;return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ka(t){t=Va.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==Ha.Cache}}class Xa{constructor(t){this.key=t}}class Ya{constructor(t){this.key=t}}class Ja{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ms(),this.mutatedKeys=ms(),this.eu=rs(t),this.tu=new La(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new Pa,r=e?e.tu:this.tu;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal((t,e)=>{const u=r.get(t),l=ns(this.query,e)?e:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.su(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.eu(l,a)>0||c&&this.eu(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(i=i.add(l),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{tu:i,iu:n,Cs:o,mutatedKeys:s}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const s=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const i=t.iu.ya();i.sort((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ie(20277,{Rt:t})}};return n(t)-n(e)}(t.type,e.type)||this.eu(t.doc,e.doc)),this.ou(n),r=null!=r&&r;const o=e&&!r?this._u():[],a=0===this.Xa.size&&this.current&&!r?1:0,c=a!==this.Za;return this.Za=a,0!==i.length||c?{snapshot:new Va(this.query,t.tu,s,i,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Pa,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),t.modifiedDocuments.forEach(t=>{}),t.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=ms(),this.tu.forEach(t=>{this.uu(t.key)&&(this.Xa=this.Xa.add(t.key))});const e=[];return t.forEach(t=>{this.Xa.has(t)||e.push(new Ya(t))}),this.Xa.forEach(n=>{t.has(n)||e.push(new Xa(n))}),e}cu(t){this.Ya=t.Qs,this.Xa=ms();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return Va.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const Za="SyncEngine";class $a{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class tc{constructor(t){this.key=t,this.hu=!1}}class ec{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new is(t=>ts(t),$r),this.Iu=new Map,this.Eu=new Set,this.du=new An(Ze.comparator),this.Au=new Map,this.Ru=new fo,this.Vu={},this.mu=new Map,this.fu=to.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function nc(t,e,n=!0){const r=Tc(t);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await sc(r,e,n,!0),s}async function rc(t,e){const n=Tc(t);await sc(n,e,!0,!1)}async function sc(t,e,n,r){const s=await function(t,e){const n=Ae(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let r;return n.Pi.getTargetData(t,e).next(s=>s?(r=s,yn.resolve(r)):n.Pi.allocateTargetId(t).next(s=>(r=new Hi(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Pi.addTargetData(t,r).next(()=>r))))}).then(t=>{const r=n.Ms.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(t.targetId,t),n.xs.set(e,t.targetId)),t})}(t.localStore,Yr(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let a;return r&&(a=await async function(t,e,n,r,s){t.pu=(e,n,r)=>async function(t,e,n,r){let s=e.view.ru(n);s.Cs&&(s=await xo(t.localStore,e.query,!1).then(({documents:t})=>e.view.ru(t,s)));const i=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(s,t.isPrimaryClient,i,o);return yc(t,e.targetId,a.au),a.snapshot}(t,e,n,r);const i=await xo(t.localStore,e,!0),o=new Ja(e,i.Qs),a=o.ru(i.documents),c=ci.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),u=o.applyChanges(a,t.isPrimaryClient,c);yc(t,n,u.au);const l=new $a(e,n,o);return t.Tu.set(e,l),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),u.snapshot}(t,e,i,"current"===o,s.resumeToken)),t.isPrimaryClient&&n&&aa(t.remoteStore,s),a}async function ic(t,e,n){const r=Ae(t),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(t=>!$r(t,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Oo(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&ca(r.remoteStore,s.targetId),gc(r,s.targetId)}).catch(mn)):(gc(r,s.targetId),await Oo(r.localStore,s.targetId,!0))}async function oc(t,e){const n=Ae(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),ca(n.remoteStore,r.targetId))}async function ac(t,e,n){const r=function(t){const e=Ae(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=hc.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=dc.bind(null,e),e}(t);try{const t=await function(t,e){const n=Ae(t),r=ln.now(),s=e.reduce((t,e)=>t.add(e.key),ms());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>{let a=as(),c=ms();return n.Ns.getEntries(t,s).next(t=>{a=t,a.forEach((t,e)=>{e.isValidDocument()||(c=c.add(t))})}).next(()=>n.localDocuments.getOverlayedDocuments(t,a)).next(s=>{i=s;const o=[];for(const t of e){const e=js(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new zs(t.key,e,yr(e.value.mapValue),Ms.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)}).next(e=>{o=e;const r=e.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)})}).then(()=>({batchId:o.batchId,changes:ls(i)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Vu[t.currentUser.toKey()];r||(r=new An(Be)),r=r.insert(e,n),t.Vu[t.currentUser.toKey()]=r}(r,t.batchId,n),await _c(r,t.changes),await ba(r.remoteStore)}catch(s){const t=Ma(s,"Failed to persist write");n.reject(t)}}async function cc(t,e){const n=Ae(t);try{const t=await No(n.localStore,e);e.targetChanges.forEach((t,e)=>{const r=n.Au.get(e);r&&(Ce(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?Ce(r.hu,14607):t.removedDocuments.size>0&&(Ce(r.hu,42227),r.hu=!1))}),await _c(n,t,e)}catch(r){await mn(r)}}function uc(t,e,n){const r=Ae(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.Tu.forEach((n,r)=>{const s=r.view.va(e);s.snapshot&&t.push(s.snapshot)}),function(t,e){const n=Ae(t);n.onlineState=e;let r=!1;n.queries.forEach((t,n)=>{for(const s of n.Sa)s.va(e)&&(r=!0)}),r&&Ga(n)}(r.eventManager,e),t.length&&r.Pu.H_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function lc(t,e,n){const r=Ae(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),i=s&&s.key;if(i){let t=new An(Ze.comparator);t=t.insert(i,vr.newNoDocument(i,hn.min()));const n=ms().add(i),s=new ai(hn.min(),new Map,new An(Be),t,n);await cc(r,s),r.du=r.du.remove(i),r.Au.delete(e),wc(r)}else await Oo(r.localStore,e,!1).then(()=>gc(r,e,n)).catch(mn)}async function hc(t,e){const n=Ae(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Ae(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const r=e.batch.keys(),s=n.Ns.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=yn.resolve();return i.forEach(t=>{o=o.next(()=>r.getEntry(e,t)).next(e=>{const i=n.docVersions.get(t);Ce(null!==i,48541),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))})}),o.next(()=>t.mutationQueue.removeMutationBatch(e,s))}(n,t,e,s).next(()=>s.apply(t)).next(()=>n.mutationQueue.performConsistencyCheck(t)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ms();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e))).next(()=>n.localDocuments.getDocuments(t,r))})}(n.localStore,e);pc(n,r,null),fc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await _c(n,t)}catch(s){await mn(s)}}async function dc(t,e,n){const r=Ae(t);try{const t=await function(t,e){const n=Ae(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next(e=>(Ce(null!==e,37113),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e))).next(()=>n.mutationQueue.performConsistencyCheck(t)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r)).next(()=>n.localDocuments.getDocuments(t,r))})}(r.localStore,e);pc(r,e,n),fc(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await _c(r,t)}catch(s){await mn(s)}}function fc(t,e){(t.mu.get(e)||[]).forEach(t=>{t.resolve()}),t.mu.delete(e)}function pc(t,e,n){const r=Ae(t);let s=r.Vu[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function gc(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(e=>{t.Ru.containsKey(e)||mc(t,e)})}function mc(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);null!==n&&(ca(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),wc(t))}function yc(t,e,n){for(const r of n)r instanceof Xa?(t.Ru.addReference(r.key,e),vc(t,r)):r instanceof Ya?(_e(Za,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||mc(t,r.key)):Ie(19791,{wu:r})}function vc(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(_e(Za,"New document in limbo: "+n),t.Eu.add(r),wc(t))}function wc(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Ze(Xe.fromString(e)),r=t.fu.next();t.Au.set(r,new tc(n)),t.du=t.du.insert(n,r),aa(t.remoteStore,new Hi(Yr(Hr(n.path)),r,"TargetPurposeLimboResolution",wn.ce))}}async function _c(t,e,n){const r=Ae(t),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((t,a)=>{o.push(r.pu(a,e,n).then(t=>{var e;if((t||n)&&r.isPrimaryClient){const s=t?!t.fromCache:null==(e=null==n?void 0:n.targetChanges.get(a.targetId))?void 0:e.current;r.sharedClientState.updateQueryState(a.targetId,s?"current":"not-current")}if(t){s.push(t);const e=To.As(a.targetId,t);i.push(e)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(t,e){const n=Ae(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>yn.forEach(e,e=>yn.forEach(e.Es,r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r)).next(()=>yn.forEach(e.ds,r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))}catch(r){if(!vn(r))throw r;_e(Co,"Failed to update sequence numbers: "+r)}for(const s of e){const t=s.targetId;if(!s.fromCache){const e=n.Ms.get(t),r=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(t,s)}}}(r.localStore,i))}async function bc(t,e){const n=Ae(t);if(!n.currentUser.isEqual(e)){_e(Za,"User change. New user:",e.toKey());const t=await ko(n.localStore,e);n.currentUser=e,s="'waitForPendingWrites' promise is rejected due to a user change.",(r=n).mu.forEach(t=>{t.forEach(t=>{t.reject(new De(ke.CANCELLED,s))})}),r.mu.clear(),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await _c(n,t.Ls)}var r,s}function Ec(t,e){const n=Ae(t),r=n.Au.get(e);if(r&&r.hu)return ms().add(r.key);{let t=ms();const r=n.Iu.get(e);if(!r)return t;for(const e of r){const r=n.Tu.get(e);t=t.unionWith(r.view.nu)}return t}}function Tc(t){const e=Ae(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=cc.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ec.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=lc.bind(null,e),e.Pu.H_=za.bind(null,e.eventManager),e.Pu.yu=Ka.bind(null,e.eventManager),e}class Ic{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Wo(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return function(t,e,n,r){return new Ao(t,e,n,r)}(this.persistence,new So,t.initialUser,this.serializer)}Cu(t){return new wo(bo.mi,this.serializer)}Du(t){return new Lo}async terminate(){var t,e;null==(t=this.gcScheduler)||t.stop(),null==(e=this.indexBackfillerScheduler)||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ic.provider={build:()=>new Ic};class Sc extends Ic{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){Ce(this.persistence.referenceDelegate instanceof Eo,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new so(n,t.asyncQueue,e)}Cu(t){const e=void 0!==this.cacheSizeBytes?$i.withCacheSize(this.cacheSizeBytes):$i.DEFAULT;return new wo(t=>Eo.mi(t,e),this.serializer)}}class Cc{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>uc(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=bc.bind(null,this.syncEngine),await async function(t,e){const n=Ae(t);e?(n.Ea.delete(2),await ia(n)):e||(n.Ea.add(2),await oa(n),n.Ra.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Ua}createDatastore(t){const e=Wo(t.databaseInfo.databaseId),n=(r=t.databaseInfo,new Ho(r));var r;return function(t,e,n,r){return new ea(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,s=t=>uc(this.syncEngine,t,0),i=Fo.v()?new Fo:new Po,new sa(e,n,r,s,i);var e,n,r,s,i}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new ec(t,e,n,r,s,i);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(t){const e=Ae(t);_e(ra,"RemoteStore shutting down."),e.Ea.add(5),await oa(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),null==(t=this.datastore)||t.terminate(),null==(e=this.eventManager)||e.terminate()}}Cc.provider={build:()=>new Cc};class Ac{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):be("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout(()=>{this.muted||t(e)},0)}}const kc="FirestoreClient";class Dc{constructor(t,e,n,r,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=me.UNAUTHENTICATED,this.clientId=je.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,async t=>{_e(kc,"Received user=",t.uid),await this.authCredentialListener(t),this.user=t}),this.appCheckCredentials.start(n,t=>(_e(kc,"Received new app check token=",t),this.appCheckCredentialListener(t,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Ne;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Ma(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function Nc(t,e){t.asyncQueue.verifyOperationInProgress(),_e(kc,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async t=>{r.isEqual(t)||(await ko(e.localStore,t),r=t)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Rc(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){_e(kc,"Using user provided OfflineComponentProvider");try{await Nc(t,t._uninitializedComponentsProvider._offline)}catch(e){const s=e;if(!("FirebaseError"===(n=s).name?n.code===ke.FAILED_PRECONDITION||n.code===ke.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw s;Ee("Error using user provided cache. Falling back to memory cache: "+s),await Nc(t,new Ic)}}else _e(kc,"Using default OfflineComponentProvider"),await Nc(t,new Sc(void 0));var n;return t._offlineComponents}(t);_e(kc,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(t=>Na(e.remoteStore,t)),t.setAppCheckTokenChangeListener((t,n)=>Na(e.remoteStore,n)),t._onlineComponents=e}async function Oc(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(_e(kc,"Using user provided OnlineComponentProvider"),await Rc(t,t._uninitializedComponentsProvider._online)):(_e(kc,"Using default OnlineComponentProvider"),await Rc(t,new Cc))),t._onlineComponents}async function xc(t){const e=await Oc(t),n=e.eventManager;return n.onListen=nc.bind(null,e.syncEngine),n.onUnlisten=ic.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=rc.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=oc.bind(null,e.syncEngine),n}function Mc(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Lc=new Map,Pc="firestore.googleapis.com",Vc=!0;class Fc{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new De(ke.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Pc,this.ssl=Vc}else this.host=t.host,this.ssl=null!=(e=t.ssl)?e:Vc;if(this.isUsingEmulator=void 0!==t.emulatorOptions,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=Zi;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new De(ke.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new De(ke.INVALID_ARGUMENT,"".concat(t," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Mc(null!=(n=t.experimentalLongPollingOptions)?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new De(ke.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (must not be NaN)"));if(t.timeoutSeconds<5)throw new De(ke.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (minimum allowed value is 5)"));if(t.timeoutSeconds>30)throw new De(ke.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(e=this.experimentalLongPollingOptions,n=t.experimentalLongPollingOptions,e.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams;var e,n}}class Uc{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Fc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new De(ke.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new De(ke.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Fc(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Oe;switch(t.type){case"firstParty":return new Pe(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new De(ke.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Lc.get(t);e&&(_e("ComponentProvider","Removing Datastore"),Lc.delete(t),e.terminate())}(this),Promise.resolve()}}class jc{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new jc(this.firestore,t,this._query)}}class Bc{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qc(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Bc(this.firestore,t,this._key)}toJSON(){return{type:Bc._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(an(e,Bc._jsonSchema))return new Bc(t,n||null,new Ze(Xe.fromString(e.referencePath)))}}Bc._jsonSchemaVersion="firestore/documentReference/1.0",Bc._jsonSchema={type:on("string",Bc._jsonSchemaVersion),referencePath:on("string")};class qc extends jc{constructor(t,e,n){super(t,e,Hr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Bc(this.firestore,null,new Ze(t))}withConverter(t){return new qc(this.firestore,t,this._path)}}function zc(t,e,...n){if(t=S(t),$e("collection","path",e),t instanceof Uc){const r=Xe.fromString(e,...n);return en(r),new qc(t,null,r)}{if(!(t instanceof Bc||t instanceof qc))throw new De(ke.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Xe.fromString(e,...n));return en(r),new qc(t.firestore,null,r)}}function Kc(t,e,...n){if(t=S(t),1===arguments.length&&(e=je.newId()),$e("doc","path",e),t instanceof Uc){const r=Xe.fromString(e,...n);return tn(r),new Bc(t,null,new Ze(r))}{if(!(t instanceof Bc||t instanceof qc))throw new De(ke.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Xe.fromString(e,...n));return tn(r),new Bc(t.firestore,t instanceof qc?t.converter:null,new Ze(r))}}const Gc="AsyncQueue";class Hc{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Xo(this,"async_queue_retry"),this._c=()=>{const t=Qo();t&&_e(Gc,"Visibility state changed to "+t.visibilityState),this.M_.w_()},this.ac=t;const e=Qo();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Qo();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});const e=new Ne;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Xu.push(t),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!vn(t))throw t;_e(Gc,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(t){const e=this.ac.then(()=>(this.rc=!0,t().catch(t=>{throw this.nc=t,this.rc=!1,be("INTERNAL UNHANDLED ERROR: ",Qc(t)),t}).then(t=>(this.rc=!1,t))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const r=xa.createAndSchedule(this,t,e,n,t=>this.hc(t));return this.tc.push(r),r}uc(){this.nc&&Ie(47125,{Pc:Qc(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do{t=this.ac,await t}while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const e of this.tc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tc()})}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Qc(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}function Wc(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const r of e)if(r in n&&"function"==typeof n[r])return!0;return!1}(t,["next","error","complete"])}class Xc extends Uc{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Hc,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Hc(t),this._firestoreClient=void 0,await t}}}function Yc(t,e){const n="object"==typeof t?t:Kt(),r="string"==typeof t?t:Qn,s=Ft(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const t=c("firestore");t&&function(t,e,n,r={}){var s;t=sn(t,Uc);const i=h(e),o=t._getSettings(),a={...o,emulatorOptions:t._getEmulatorOptions()},c="".concat(e,":").concat(n);i&&(d("https://".concat(c)),m("Firestore",!0)),o.host!==Pc&&o.host!==c&&Ee("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...o,host:c,ssl:i,emulatorOptions:r};if(!T(u,a)&&(t._setSettings(u),r.mockUserToken)){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=me.MOCK_USER;else{e=f(r.mockUserToken,null==(s=t._app)?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new De(ke.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new me(i)}t._authCredentials=new xe(new Re(e,n))}}(s,...t)}return s}function Jc(t){if(t._terminated)throw new De(ke.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||function(t){var e,n,r;const s=t._freezeSettings(),i=(o=t._databaseId,a=(null==(e=t._app)?void 0:e.options.appId)||"",c=t._persistenceKey,u=s,new Hn(o,a,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,Mc(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator));var o,a,c,u;t._componentsProvider||(null==(n=s.localCache)?void 0:n._offlineComponentProvider)&&(null==(r=s.localCache)?void 0:r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new Dc(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(t){const e=null==t?void 0:t._online.build();return{_offline:null==t?void 0:t._offline.build(e),_online:e}}(t._componentsProvider))}(t),t._firestoreClient}class Zc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Zc(Mn.fromBase64String(t))}catch(e){throw new De(ke.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Zc(Mn.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Zc._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(an(t,Zc._jsonSchema))return Zc.fromBase64String(t.bytes)}}Zc._jsonSchemaVersion="firestore/bytes/1.0",Zc._jsonSchema={type:on("string",Zc._jsonSchemaVersion),bytes:on("string")};class $c{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new De(ke.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Je(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class tu{constructor(t){this._methodName=t}}class eu{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new De(ke.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new De(ke.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return Be(this._lat,t._lat)||Be(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:eu._jsonSchemaVersion}}static fromJSON(t){if(an(t,eu._jsonSchema))return new eu(t.latitude,t.longitude)}}eu._jsonSchemaVersion="firestore/geoPoint/1.0",eu._jsonSchema={type:on("string",eu._jsonSchemaVersion),latitude:on("number"),longitude:on("number")};class nu{constructor(t){this._values=(t||[]).map(t=>t)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}toJSON(){return{type:nu._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(an(t,nu._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(t=>"number"==typeof t))return new nu(t.vectorValues);throw new De(ke.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}nu._jsonSchemaVersion="firestore/vectorValue/1.0",nu._jsonSchema={type:on("string",nu._jsonSchemaVersion),vectorValues:on("object")};const ru=/^__.*__$/;class su{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new zs(t,this.data,this.fieldMask,e,this.fieldTransforms):new qs(t,this.data,e,this.fieldTransforms)}}class iu{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new zs(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function ou(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ie(40011,{Ac:t})}}class au{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new au({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){var e;const n=null==(e=this.path)?void 0:e.child(t),r=this.Vc({path:n,fc:!1});return r.gc(t),r}yc(t){var e;const n=null==(e=this.path)?void 0:e.child(t),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return wu(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(0===t.length)throw this.Sc("Document fields must not be empty");if(ou(this.Ac)&&ru.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class cu{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Wo(t)}Cc(t,e,n,r=!1){return new au({Ac:t,methodName:e,Dc:n,path:Je.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function uu(t){const e=t._freezeSettings(),n=Wo(t._databaseId);return new cu(t._databaseId,!!e.ignoreUndefinedProperties,n)}function lu(t,e,n,r,s,i={}){const o=t.Cc(i.merge||i.mergeFields?2:0,e,n,s);gu("Data must be an object, but it was:",o,r);const a=fu(r,o);let c,u;if(i.merge)c=new On(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=mu(e,r,n);if(!o.contains(s))throw new De(ke.INVALID_ARGUMENT,"Field '".concat(s,"' is specified in your field mask but missing from your input data."));_u(t,s)||t.push(s)}c=new On(t),u=o.fieldTransforms.filter(t=>c.covers(t.field))}else c=null,u=o.fieldTransforms;return new su(new mr(a),c,u)}class hu extends tu{_toFieldTransform(t){if(2!==t.Ac)throw 1===t.Ac?t.Sc("".concat(this._methodName,"() can only appear at the top level of your update data")):t.Sc("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof hu}}function du(t,e){if(pu(t=S(t)))return gu("Unsupported field value:",e,t),fu(t,e);if(t instanceof tu)return function(t,e){if(!ou(e.Ac))throw e.Sc("".concat(t._methodName,"() can only be used with update() and set()"));if(!e.path)throw e.Sc("".concat(t._methodName,"() is not currently supported inside arrays"));const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&4!==e.Ac)throw e.Sc("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=du(s,e.wc(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=S(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return _s(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=ln.fromDate(t);return{timestampValue:bi(e.serializer,n)}}if(t instanceof ln){const n=new ln(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:bi(e.serializer,n)}}if(t instanceof eu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Zc)return{bytesValue:Ei(e.serializer,t._byteString)};if(t instanceof Bc){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Sc("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:Si(t.firestore._databaseId||e.databaseId,t._key.path)}}if(t instanceof nu)return n=t,r=e,{mapValue:{fields:{[Xn]:{stringValue:Zn},[$n]:{arrayValue:{values:n.toArray().map(t=>{if("number"!=typeof t)throw r.Sc("VectorValues must only contain numeric values.");return vs(r.serializer,t)})}}}}};var n,r;throw e.Sc("Unsupported field value: ".concat(rn(t)))}(t,e)}function fu(t,e){const n={};return Cn(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Sn(t,(t,r)=>{const s=du(r,e.mc(t));null!=s&&(n[t]=s)}),{mapValue:{fields:n}}}function pu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ln||t instanceof eu||t instanceof Zc||t instanceof Bc||t instanceof tu||t instanceof nu)}function gu(t,e,n){if(!pu(n)||!nn(n)){const r=rn(n);throw"an object"===r?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function mu(t,e,n){if((e=S(e))instanceof $c)return e._internalPath;if("string"==typeof e)return vu(t,e);throw wu("Field path arguments must be of type string or ",t,!1,void 0,n)}const yu=new RegExp("[~\\*/\\[\\]]");function vu(t,e,n){if(e.search(yu)>=0)throw wu("Invalid field path (".concat(e,"). Paths must not contain '~', '*', '/', '[', or ']'"),t,!1,void 0,n);try{return new $c(...e.split("."))._internalPath}catch(r){throw wu("Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),t,!1,void 0,n)}}function wu(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a="Function ".concat(e,"() called with invalid data");n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=" in field ".concat(r)),o&&(c+=" in document ".concat(s)),c+=")"),new De(ke.INVALID_ARGUMENT,a+t+c)}function _u(t,e){return t.some(t=>t.isEqual(e))}class bu{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Bc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Eu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Tu("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Eu extends bu{data(){return super.data()}}function Tu(t,e){return"string"==typeof e?vu(t,e):e instanceof $c?e._internalPath:e._delegate._internalPath}class Iu{}class Su extends Iu{}function Cu(t,e,...n){let r=[];e instanceof Iu&&r.push(e),r=r.concat(n),function(t){const e=t.filter(t=>t instanceof Du).length,n=t.filter(t=>t instanceof Au).length;if(e>1||e>0&&n>0)throw new De(ke.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Au extends Su{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new Au(t,e,n)}_apply(t){const e=this._parse(t);return Pu(t._query,e),new jc(t.firestore,t.converter,Jr(t._query,e))}_parse(t){const e=uu(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new De(ke.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(i,"' queries on documentId()."));if("in"===i||"not-in"===i){Lu(o,i);const e=[];for(const n of o)e.push(Mu(r,t,n));a={arrayValue:{values:e}}}else a=Mu(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Lu(o,i),a=function(t,e,n,r=!1){return du(n,t.Cc(r?4:3,e))}(n,e,o,"in"===i||"not-in"===i);return Sr.create(s,i,a)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function ku(t,e,n){const r=e,s=Tu("where",t);return Au._create(s,r,n)}class Du extends Iu{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Du(t,e)}_parse(t){const e=this._queryConstraints.map(e=>e._parse(t)).filter(t=>t.getFilters().length>0);return 1===e.length?e[0]:Cr.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const s of r)Pu(n,s),n=Jr(n,s)}(t._query,e),new jc(t.firestore,t.converter,Jr(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Nu extends Su{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Nu(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new De(ke.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new De(ke.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Er(e,n)}(t._query,this._field,this._direction);return new jc(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Gr(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function Ru(t,e="asc"){const n=e,r=Tu("orderBy",t);return Nu._create(r,n)}class Ou extends Su{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new Ou(t,e,n)}_apply(t){return new jc(t.firestore,t.converter,Zr(t._query,this._limit,this._limitType))}}function xu(t){return Ou._create("limit",t,"F")}function Mu(t,e,n){if("string"==typeof(n=S(n))){if(""===n)throw new De(ke.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Wr(e)&&-1!==n.indexOf("/"))throw new De(ke.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const r=e.path.child(Xe.fromString(n));if(!Ze.isDocumentKey(r))throw new De(ke.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return ur(t,new Ze(r))}if(n instanceof Bc)return ur(t,n._key);throw new De(ke.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(rn(n),"."))}function Lu(t,e){if(!Array.isArray(t)||0===t.length)throw new De(ke.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(e.toString(),"' filters."))}function Pu(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new De(ke.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(e.op.toString(),"' filter.")):new De(ke.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(e.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}class Vu{convertValue(t,e="none"){switch(tr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Vn(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Fn(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw Ie(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Sn(t,(t,r)=>{n[t]=this.convertValue(r,e)}),n}convertVectorValue(t){var e,n,r;const s=null==(r=null==(n=null==(e=t.fields)?void 0:e[$n].arrayValue)?void 0:n.values)?void 0:r.map(t=>Vn(t.doubleValue));return new nu(s)}convertGeoPoint(t){return new eu(Vn(t.latitude),Vn(t.longitude))}convertArray(t,e){return(t.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Kn(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Gn(t));default:return null}}convertTimestamp(t){const e=Pn(t);return new ln(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Xe.fromString(t);Ce(Gi(n),9688,{name:t});const r=new Wn(n.get(1),n.get(3)),s=new Ze(n.popFirst(5));return r.isEqual(e)||be("Document ".concat(s," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(e.projectId,"/").concat(e.database,") instead.")),s}}function Fu(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Uu{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class ju extends bu{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Bu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Tu("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new De(ke.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=ju._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),t&&t.isValidDocument()&&t.isFoundDocument()?(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e):e}}ju._jsonSchemaVersion="firestore/documentSnapshot/1.0",ju._jsonSchema={type:on("string",ju._jsonSchemaVersion),bundleSource:on("string","DocumentSnapshot"),bundleName:on("string"),bundle:on("string")};class Bu extends ju{data(t={}){return super.data(t)}}class qu{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Uu(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Bu(this._firestore,this._userDataWriter,n.key,n,new Uu(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new De(ke.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map(n=>{const r=new Bu(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Uu(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}})}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(t=>e||3!==t.type).map(e=>{const r=new Bu(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Uu(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:zu(e.type),doc:r,oldIndex:s,newIndex:i}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new De(ke.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=qu._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=je.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],r=[];return this.docs.forEach(t=>{null!==t._document&&(e.push(t._document),n.push(this._userDataWriter.convertObjectMap(t._document.data.value.mapValue.fields,"previous")),r.push(t.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function zu(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ie(61501,{type:t})}}function Ku(t){t=sn(t,Bc);const e=sn(t.firestore,Xc);return function(t,e,n={}){const r=new Ne;return t.asyncQueue.enqueueAndForget(async()=>function(t,e,n,r,s){const i=new Ac({next:a=>{i.Nu(),e.enqueueAndForget(()=>qa(t,o));const c=a.docs.has(n);!c&&a.fromCache?s.reject(new De(ke.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?s.reject(new De(ke.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(a)},error:t=>s.reject(t)}),o=new Wa(Hr(n.path),i,{includeMetadataChanges:!0,qa:!0});return Ba(t,o)}(await xc(t),t.asyncQueue,e,n,r)),r.promise}(Jc(e),t._key).then(n=>Zu(e,t,n))}qu._jsonSchemaVersion="firestore/querySnapshot/1.0",qu._jsonSchema={type:on("string",qu._jsonSchemaVersion),bundleSource:on("string","QuerySnapshot"),bundleName:on("string"),bundle:on("string")};class Gu extends Vu{constructor(t){super(),this.firestore=t}convertBytes(t){return new Zc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Bc(this.firestore,null,e)}}function Hu(t,e,n){t=sn(t,Bc);const r=sn(t.firestore,Xc),s=Fu(t.converter,e,n);return Ju(r,[lu(uu(r),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,Ms.none())])}function Qu(t,e,n,...r){t=sn(t,Bc);const s=sn(t.firestore,Xc),i=uu(s);let o;return o="string"==typeof(e=S(e))||e instanceof $c?function(t,e,n,r,s,i){const o=t.Cc(1,e,n),a=[mu(e,r,n)],c=[s];if(i.length%2!=0)throw new De(ke.INVALID_ARGUMENT,"Function ".concat(e,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let d=0;d<i.length;d+=2)a.push(mu(e,i[d])),c.push(i[d+1]);const u=[],l=mr.empty();for(let d=a.length-1;d>=0;--d)if(!_u(u,a[d])){const t=a[d];let e=c[d];e=S(e);const n=o.yc(t);if(e instanceof hu)u.push(t);else{const r=du(e,n);null!=r&&(u.push(t),l.set(t,r))}}const h=new On(u);return new iu(l,h,o.fieldTransforms)}(i,"updateDoc",t._key,e,n,r):function(t,e,n,r){const s=t.Cc(1,e,n);gu("Data must be an object, but it was:",s,r);const i=[],o=mr.empty();Sn(r,(t,r)=>{const a=vu(e,t,n);r=S(r);const c=s.yc(a);if(r instanceof hu)i.push(a);else{const t=du(r,c);null!=t&&(i.push(a),o.set(a,t))}});const a=new On(i);return new iu(o,a,s.fieldTransforms)}(i,"updateDoc",t._key,e),Ju(s,[o.toMutation(t._key,Ms.exists(!0))])}function Wu(t){return Ju(sn(t.firestore,Xc),[new Qs(t._key,Ms.none())])}function Xu(t,e){const n=sn(t.firestore,Xc),r=Kc(t),s=Fu(t.converter,e);return Ju(n,[lu(uu(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,Ms.exists(!1))]).then(()=>r)}function Yu(t,...e){var n,r,s;t=S(t);let i={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Wc(e[o])||(i=e[o++]);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Wc(e[o])){const t=e[o];e[o]=null==(n=t.next)?void 0:n.bind(t),e[o+1]=null==(r=t.error)?void 0:r.bind(t),e[o+2]=null==(s=t.complete)?void 0:s.bind(t)}let c,u,l;if(t instanceof Bc)u=sn(t.firestore,Xc),l=Hr(t._key.path),c={next:n=>{e[o]&&e[o](Zu(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=sn(t,jc);u=sn(n.firestore,Xc),l=n._query;const r=new Gu(u);c={next:t=>{e[o]&&e[o](new qu(u,r,n,t))},error:e[o+1],complete:e[o+2]},function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new De(ke.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query)}return function(t,e,n,r){const s=new Ac(r),i=new Wa(e,s,n);return t.asyncQueue.enqueueAndForget(async()=>Ba(await xc(t),i)),()=>{s.Nu(),t.asyncQueue.enqueueAndForget(async()=>qa(await xc(t),i))}}(Jc(u),l,a,c)}function Ju(t,e){return function(t,e){const n=new Ne;return t.asyncQueue.enqueueAndForget(async()=>ac(await function(t){return Oc(t).then(t=>t.syncEngine)}(t),e,n)),n.promise}(Jc(t),e)}function Zu(t,e,n){const r=n.docs.get(e._key),s=new Gu(t);return new ju(t,s,e._key,r,new Uu(n.hasPendingWrites,n.fromCache),e.converter)}!function(t,e=!0){ye=qt,Vt(new C("firestore",(t,{instanceIdentifier:n,options:r})=>{const s=t.getProvider("app").getImmediate(),i=new Xc(new Me(t.getProvider("auth-internal")),new Fe(s,t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new De(ke.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Wn(t.options.projectId,e)}(s,n),s);return r={useFetchStreams:e,...r},i._setSettings(r),i},"PUBLIC").setMultipleInstances(!0)),Gt(pe,ge,t),Gt(pe,ge,"esm2020")}();const $u="@firebase/installations",tl="0.6.19",el=1e4,nl="w:".concat(tl),rl="FIS_v2",sl=36e5,il=new b("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function ol(t){return t instanceof _&&t.code.includes("request-failed")}function al({projectId:t}){return"".concat("https://firebaseinstallations.googleapis.com/v1","/projects/").concat(t,"/installations")}function cl(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function ul(t,e){const n=(await e.json()).error;return il.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function ll({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function hl(t,{refreshToken:e}){const n=ll(t);return n.append("Authorization",function(t){return"".concat(rl," ").concat(t)}(e)),n}async function dl(t){const e=await t();return e.status>=500&&e.status<600?t():e}function fl(t){return new Promise(e=>{setTimeout(e,t)})}const pl=/^[cdef][\w-]{21}$/;function gl(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){const e=(n=t,btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_"));var n;return e.substr(0,22)}(t);return pl.test(e)?e:""}catch(t){return""}}function ml(t){return"".concat(t.appName,"!").concat(t.appId)}const yl=new Map;function vl(t,e){const n=ml(t);wl(n,e),function(t,e){const n=function(){!_l&&"BroadcastChannel"in self&&(_l=new BroadcastChannel("[Firebase] FID Change"),_l.onmessage=t=>{wl(t.data.key,t.data.fid)});return _l}();n&&n.postMessage({key:t,fid:e});0===yl.size&&_l&&(_l.close(),_l=null)}(n,e)}function wl(t,e){const n=yl.get(t);if(n)for(const r of n)r(e)}let _l=null;const bl="firebase-installations-store";let El=null;function Tl(){return El||(El=X("firebase-installations-database",1,{upgrade:(t,e)=>{if(0===e)t.createObjectStore(bl)}})),El}async function Il(t,e){const n=ml(t),r=(await Tl()).transaction(bl,"readwrite"),s=r.objectStore(bl),i=await s.get(n);return await s.put(e,n),await r.done,i&&i.fid===e.fid||vl(t,e.fid),e}async function Sl(t){const e=ml(t),n=(await Tl()).transaction(bl,"readwrite");await n.objectStore(bl).delete(e),await n.done}async function Cl(t,e){const n=ml(t),r=(await Tl()).transaction(bl,"readwrite"),s=r.objectStore(bl),i=await s.get(n),o=e(i);return void 0===o?await s.delete(n):await s.put(o,n),await r.done,!o||i&&i.fid===o.fid||vl(t,o.fid),o}async function Al(t){let e;const n=await Cl(t.appConfig,n=>{const r=function(t){const e=t||{fid:gl(),registrationStatus:0};return Nl(e)}(n),s=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine){return{installationEntry:e,registrationPromise:Promise.reject(il.create("app-offline"))}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=al(t),s=ll(t),i=e.getImmediate({optional:!0});if(i){const t=await i.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={fid:n,authVersion:rl,appId:t.appId,sdkVersion:nl},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await dl(()=>fetch(r,a));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:cl(t.authToken)}}throw await ul("Create Installation",c)}(t,e);return Il(t.appConfig,n)}catch(n){throw ol(n)&&409===n.customData.serverCode?await Sl(t.appConfig):await Il(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:r}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:kl(t)}:{installationEntry:e}}(t,r);return e=s.registrationPromise,s.installationEntry});return""===n.fid?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function kl(t){let e=await Dl(t.appConfig);for(;1===e.registrationStatus;)await fl(100),e=await Dl(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await Al(t);return n||e}return e}function Dl(t){return Cl(t,t=>{if(!t)throw il.create("installation-not-found");return Nl(t)})}function Nl(t){return 1===(e=t).registrationStatus&&e.registrationTime+el<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function Rl({appConfig:t,heartbeatServiceProvider:e},n){const r=function(t,{fid:e}){return"".concat(al(t),"/").concat(e,"/authTokens:generate")}(t,n),s=hl(t,n),i=e.getImmediate({optional:!0});if(i){const t=await i.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={installation:{sdkVersion:nl,appId:t.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await dl(()=>fetch(r,a));if(c.ok){return cl(await c.json())}throw await ul("Generate Auth Token",c)}async function Ol(t,e=!1){let n;const r=await Cl(t.appConfig,r=>{if(!Ml(r))throw il.create("not-registered");const s=r.authToken;if(!e&&function(t){return 2===t.requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+sl}(t)}(s))return r;if(1===s.requestStatus)return n=async function(t,e){let n=await xl(t.appConfig);for(;1===n.authToken.requestStatus;)await fl(100),n=await xl(t.appConfig);const r=n.authToken;return 0===r.requestStatus?Ol(t,e):r}(t,e),r;{if(!navigator.onLine)throw il.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return{...t,authToken:e}}(r);return n=async function(t,e){try{const n=await Rl(t,e),r={...e,authToken:n};return await Il(t.appConfig,r),n}catch(n){if(!ol(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n={...e,authToken:{requestStatus:0}};await Il(t.appConfig,n)}else await Sl(t.appConfig);throw n}}(t,e),e}});return n?await n:r.authToken}function xl(t){return Cl(t,t=>{if(!Ml(t))throw il.create("not-registered");const e=t.authToken;return 1===(n=e).requestStatus&&n.requestTime+el<Date.now()?{...t,authToken:{requestStatus:0}}:t;var n})}function Ml(t){return void 0!==t&&2===t.registrationStatus}async function Ll(t,e=!1){const n=t;await async function(t){const{registrationPromise:e}=await Al(t);e&&await e}(n);return(await Ol(n,e)).token}function Pl(t){return il.create("missing-app-config-values",{valueName:t})}const Vl="installations",Fl=t=>{const e=Ft(t.getProvider("app").getImmediate(),Vl).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:r}=await Al(e);return r?r.catch(console.error):Ol(e).catch(console.error),n.fid}(e),getToken:t=>Ll(e,t)}};Vt(new C(Vl,t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Pl("App Configuration");if(!t.name)throw Pl("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Pl(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:Ft(e,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),Vt(new C("installations-internal",Fl,"PRIVATE")),Gt($u,tl),Gt($u,tl,"esm2020");const Ul="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",jl="google.c.a.c_id",Bl=1e4;var ql,zl,Kl;function Gl(t){const e=new Uint8Array(t);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Hl(t){const e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length);for(let s=0;s<n.length;++s)r[s]=n.charCodeAt(s);return r}(zl=ql||(ql={}))[zl.DATA_MESSAGE=1]="DATA_MESSAGE",zl[zl.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",function(t){t.PUSH_RECEIVED="push-received",t.NOTIFICATION_CLICKED="notification-clicked"}(Kl||(Kl={}));const Ql="fcm_token_details_db",Wl="fcm_token_object_Store";const Xl="firebase-messaging-store";let Yl=null;function Jl(){return Yl||(Yl=X("firebase-messaging-database",1,{upgrade:(t,e)=>{if(0===e)t.createObjectStore(Xl)}})),Yl}async function Zl(t){const e=th(t),n=await Jl(),r=await n.transaction(Xl).objectStore(Xl).get(e);if(r)return r;{const e=await async function(t){if("databases"in indexedDB&&!(await indexedDB.databases()).map(t=>t.name).includes(Ql))return null;let e=null;return(await X(Ql,5,{upgrade:async(n,r,s,i)=>{var o;if(r<2)return;if(!n.objectStoreNames.contains(Wl))return;const a=i.objectStore(Wl),c=await a.index("fcmSenderId").get(t);if(await a.clear(),c)if(2===r){const t=c;if(!t.auth||!t.p256dh||!t.endpoint)return;e={token:t.fcmToken,createTime:null!=(o=t.createTime)?o:Date.now(),subscriptionOptions:{auth:t.auth,p256dh:t.p256dh,endpoint:t.endpoint,swScope:t.swScope,vapidKey:"string"==typeof t.vapidKey?t.vapidKey:Gl(t.vapidKey)}}}else if(3===r){const t=c;e={token:t.fcmToken,createTime:t.createTime,subscriptionOptions:{auth:Gl(t.auth),p256dh:Gl(t.p256dh),endpoint:t.endpoint,swScope:t.swScope,vapidKey:Gl(t.vapidKey)}}}else if(4===r){const t=c;e={token:t.fcmToken,createTime:t.createTime,subscriptionOptions:{auth:Gl(t.auth),p256dh:Gl(t.p256dh),endpoint:t.endpoint,swScope:t.swScope,vapidKey:Gl(t.vapidKey)}}}}})).close(),await Y(Ql),await Y("fcm_vapid_details_db"),await Y("undefined"),function(t){if(!t||!t.subscriptionOptions)return!1;const{subscriptionOptions:e}=t;return"number"==typeof t.createTime&&t.createTime>0&&"string"==typeof t.token&&t.token.length>0&&"string"==typeof e.auth&&e.auth.length>0&&"string"==typeof e.p256dh&&e.p256dh.length>0&&"string"==typeof e.endpoint&&e.endpoint.length>0&&"string"==typeof e.swScope&&e.swScope.length>0&&"string"==typeof e.vapidKey&&e.vapidKey.length>0}(e)?e:null}(t.appConfig.senderId);if(e)return await $l(t,e),e}}async function $l(t,e){const n=th(t),r=(await Jl()).transaction(Xl,"readwrite");return await r.objectStore(Xl).put(e,n),await r.done,e}function th({appConfig:t}){return t.appId}const eh=new b("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});function nh({projectId:t}){return"".concat("https://fcmregistrations.googleapis.com/v1","/projects/").concat(t,"/registrations")}async function rh({appConfig:t,installations:e}){const n=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey,"x-goog-firebase-installations-auth":"FIS ".concat(n)})}function sh({p256dh:t,auth:e,endpoint:n,vapidKey:r}){const s={web:{endpoint:n,auth:e,p256dh:t}};return r!==Ul&&(s.web.applicationPubKey=r),s}async function ih(t){const e=await async function(t,e){const n=await t.pushManager.getSubscription();if(n)return n;return t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Hl(e)})}(t.swRegistration,t.vapidKey),n={vapidKey:t.vapidKey,swScope:t.swRegistration.scope,endpoint:e.endpoint,auth:Gl(e.getKey("auth")),p256dh:Gl(e.getKey("p256dh"))},r=await Zl(t.firebaseDependencies);if(r){if(function(t,e){const n=e.vapidKey===t.vapidKey,r=e.endpoint===t.endpoint,s=e.auth===t.auth,i=e.p256dh===t.p256dh;return n&&r&&s&&i}(r.subscriptionOptions,n))return Date.now()>=r.createTime+6048e5?async function(t,e){try{const n=await async function(t,e){const n=await rh(t),r=sh(e.subscriptionOptions),s={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const n=await fetch("".concat(nh(t.appConfig),"/").concat(e.token),s);i=await n.json()}catch(o){throw eh.create("token-update-failed",{errorInfo:null==o?void 0:o.toString()})}if(i.error){const t=i.error.message;throw eh.create("token-update-failed",{errorInfo:t})}if(!i.token)throw eh.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r={...e,token:n,createTime:Date.now()};return await $l(t.firebaseDependencies,r),n}catch(n){throw n}}(t,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{await async function(t,e){const n={method:"DELETE",headers:await rh(t)};try{const r=await fetch("".concat(nh(t.appConfig),"/").concat(e),n),s=await r.json();if(s.error){const t=s.error.message;throw eh.create("token-unsubscribe-failed",{errorInfo:t})}}catch(r){throw eh.create("token-unsubscribe-failed",{errorInfo:null==r?void 0:r.toString()})}}(t.firebaseDependencies,r.token)}catch(s){console.warn(s)}return oh(t.firebaseDependencies,n)}return oh(t.firebaseDependencies,n)}async function oh(t,e){const n=await async function(t,e){const n=await rh(t),r=sh(e),s={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const e=await fetch(nh(t.appConfig),s);i=await e.json()}catch(o){throw eh.create("token-subscribe-failed",{errorInfo:null==o?void 0:o.toString()})}if(i.error){const t=i.error.message;throw eh.create("token-subscribe-failed",{errorInfo:t})}if(!i.token)throw eh.create("token-subscribe-no-token");return i.token}(t,e),r={token:n,createTime:Date.now(),subscriptionOptions:e};return await $l(t,r),r.token}function ah(t){const e={from:t.from,collapseKey:t.collapse_key,messageId:t.fcmMessageId};return function(t,e){if(!e.notification)return;t.notification={};const n=e.notification.title;n&&(t.notification.title=n);const r=e.notification.body;r&&(t.notification.body=r);const s=e.notification.image;s&&(t.notification.image=s);const i=e.notification.icon;i&&(t.notification.icon=i)}(e,t),function(t,e){if(!e.data)return;t.data=e.data}(e,t),function(t,e){var n,r,s,i,o;if(!e.fcmOptions&&!(null==(n=e.notification)?void 0:n.click_action))return;t.fcmOptions={};const a=null!=(i=null==(r=e.fcmOptions)?void 0:r.link)?i:null==(s=e.notification)?void 0:s.click_action;a&&(t.fcmOptions.link=a);const c=null==(o=e.fcmOptions)?void 0:o.analytics_label;c&&(t.fcmOptions.analyticsLabel=c)}(e,t),e}function ch(t){return eh.create("missing-app-config-values",{valueName:t})}class uh{constructor(t,e,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=function(t){if(!t||!t.options)throw ch("App Configuration Object");if(!t.name)throw ch("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:n}=t;for(const r of e)if(!n[r])throw ch(r);return{appName:t.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(t);this.firebaseDependencies={app:t,appConfig:r,installations:e,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function lh(t){try{t.swRegistration=await navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}),t.swRegistration.update().catch(()=>{}),await async function(t){return new Promise((e,n)=>{const r=setTimeout(()=>n(new Error("Service worker not registered after ".concat(Bl," ms"))),Bl),s=t.installing||t.waiting;t.active?(clearTimeout(r),e()):s?s.onstatechange=t=>{var n;"activated"===(null==(n=t.target)?void 0:n.state)&&(s.onstatechange=null,clearTimeout(r),e())}:(clearTimeout(r),n(new Error("No incoming service worker found.")))})}(t.swRegistration)}catch(e){throw eh.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}}async function hh(t,e){if(!navigator)throw eh.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw eh.create("permission-blocked");return await async function(t,e){e?t.vapidKey=e:t.vapidKey||(t.vapidKey=Ul)}(t,null==e?void 0:e.vapidKey),await async function(t,e){if(e||t.swRegistration||await lh(t),e||!t.swRegistration){if(!(e instanceof ServiceWorkerRegistration))throw eh.create("invalid-sw-registration");t.swRegistration=e}}(t,null==e?void 0:e.serviceWorkerRegistration),ih(t)}async function dh(t,e,n){const r=function(t){switch(t){case Kl.NOTIFICATION_CLICKED:return"notification_open";case Kl.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(e);(await t.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:n[jl],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}async function fh(t,e){const n=e.data;if(!n.isFirebaseMessaging)return;t.onMessageHandler&&n.messageType===Kl.PUSH_RECEIVED&&("function"==typeof t.onMessageHandler?t.onMessageHandler(ah(n)):t.onMessageHandler.next(ah(n)));const r=n.data;var s;"object"==typeof(s=r)&&s&&jl in s&&"1"===r["google.c.a.e"]&&await dh(t,n.messageType,r)}const ph="@firebase/messaging",gh="0.12.23",mh=t=>{const e=t.getProvider("messaging").getImmediate();return{getToken:t=>hh(e,t)}};async function yh(){try{await w()}catch(t){return!1}return"undefined"!=typeof window&&v()&&!("undefined"==typeof navigator||!navigator.cookieEnabled)&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}function vh(t=Kt()){return yh().then(t=>{if(!t)throw eh.create("unsupported-browser")},t=>{throw eh.create("indexed-db-unsupported")}),Ft(S(t),"messaging").getImmediate()}async function wh(t,e){return hh(t=S(t),e)}function _h(t,e){return function(t,e){if(!navigator)throw eh.create("only-available-in-window");return t.onMessageHandler=e,()=>{t.onMessageHandler=null}}(t=S(t),e)}Vt(new C("messaging",t=>{const e=new uh(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),t.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>fh(e,t)),e},"PUBLIC")),Vt(new C("messaging-internal",mh,"PRIVATE")),Gt(ph,gh),Gt(ph,gh,"esm2020");const bh="firebasestorage.googleapis.com";class Eh extends _{constructor(t,e,n=0){super(Ah(t),"Firebase Storage: ".concat(e," (").concat(Ah(t),")")),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Eh.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return Ah(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message="".concat(this._baseMessage,"\n").concat(this.customData.serverResponse):this.message=this._baseMessage}}var Th,Ih,Sh,Ch;function Ah(t){return"storage/"+t}function kh(t){return new Eh(Th.INVALID_ARGUMENT,t)}function Dh(){return new Eh(Th.APP_DELETED,"The Firebase app was deleted.")}(Ih=Th||(Th={})).UNKNOWN="unknown",Ih.OBJECT_NOT_FOUND="object-not-found",Ih.BUCKET_NOT_FOUND="bucket-not-found",Ih.PROJECT_NOT_FOUND="project-not-found",Ih.QUOTA_EXCEEDED="quota-exceeded",Ih.UNAUTHENTICATED="unauthenticated",Ih.UNAUTHORIZED="unauthorized",Ih.UNAUTHORIZED_APP="unauthorized-app",Ih.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",Ih.INVALID_CHECKSUM="invalid-checksum",Ih.CANCELED="canceled",Ih.INVALID_EVENT_NAME="invalid-event-name",Ih.INVALID_URL="invalid-url",Ih.INVALID_DEFAULT_BUCKET="invalid-default-bucket",Ih.NO_DEFAULT_BUCKET="no-default-bucket",Ih.CANNOT_SLICE_BLOB="cannot-slice-blob",Ih.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",Ih.NO_DOWNLOAD_URL="no-download-url",Ih.INVALID_ARGUMENT="invalid-argument",Ih.INVALID_ARGUMENT_COUNT="invalid-argument-count",Ih.APP_DELETED="app-deleted",Ih.INVALID_ROOT_OPERATION="invalid-root-operation",Ih.INVALID_FORMAT="invalid-format",Ih.INTERNAL_ERROR="internal-error",Ih.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class Nh{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=Nh.makeFromUrl(t,e)}catch(s){return new Nh(t,"")}if(""===n.path)return n;throw r=t,new Eh(Th.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(t,e){let n=null;const r="([A-Za-z0-9.\\-_]+)";const s=new RegExp("^gs://"+r+"(/(.*))?$","i");function i(t){t.path_=decodeURIComponent(t.path)}const o=e.replace(/[.]/g,"\\."),a=[{regex:s,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://".concat(o,"/").concat("v[A-Za-z0-9_]+","/b/").concat(r,"/o").concat("(/([^?#]*).*)?$"),"i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp("^https?://".concat(e===bh?"(?:storage.googleapis.com|storage.cloud.google.com)":e,"/").concat(r,"/").concat("([^?#]*)"),"i"),indices:{bucket:1,path:2},postModify:i}];for(let c=0;c<a.length;c++){const e=a[c],r=e.regex.exec(t);if(r){const t=r[e.indices.bucket];let s=r[e.indices.path];s||(s=""),n=new Nh(t,s),e.postModify(n);break}}if(null==n)throw function(t){return new Eh(Th.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return n}}class Rh{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}function Oh(t,e,n,r){if(r<e)throw kh("Invalid value for '".concat(t,"'. Expected ").concat(e," or greater."));if(r>n)throw kh("Invalid value for '".concat(t,"'. Expected ").concat(n," or less."))}(Ch=Sh||(Sh={}))[Ch.NO_ERROR=0]="NO_ERROR",Ch[Ch.NETWORK_ERROR=1]="NETWORK_ERROR",Ch[Ch.ABORT=2]="ABORT";class xh{constructor(t,e,n,r,s,i,o,a,c,u,l,h=!0,d=!1){this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=i,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=l,this.retry=h,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((t,e)=>{this.resolve_=t,this.reject_=e,this.start_()})}start_(){const t=(t,e)=>{if(e)return void t(!1,new Mh(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=t=>{const e=t.loaded,n=t.lengthComputable?t.total:-1;null!==this.progressCallback_&&this.progressCallback_(e,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const e=n.getErrorCode()===Sh.NO_ERROR,s=n.getStatus();if(!e||function(t,e){const n=t>=500&&t<600,r=-1!==[408,429].indexOf(t),s=-1!==e.indexOf(t);return n||r||s}(s,this.additionalRetryCodes_)&&this.retry){const e=n.getErrorCode()===Sh.ABORT;return void t(!1,new Mh(!1,null,e))}const i=-1!==this.successCodes_.indexOf(s);t(!0,new Mh(i,n))})},e=(t,e)=>{const n=this.resolve_,r=this.reject_,s=e.connection;if(e.wasSuccessCode)try{const t=this.callback_(s,s.getResponse());void 0!==t?n(t):n()}catch(i){r(i)}else if(null!==s){const t=new Eh(Th.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");t.serverResponse=s.getErrorText(),this.errorCallback_?r(this.errorCallback_(s,t)):r(t)}else if(e.canceled){r(this.appDelete_?Dh():new Eh(Th.CANCELED,"User canceled the upload/download."))}else{r(new Eh(Th.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}};this.canceled_?e(0,new Mh(!1,null,!0)):this.backoffId_=function(t,e,n){let r=1,s=null,i=null,o=!1,a=0;function c(){return 2===a}let u=!1;function l(...t){u||(u=!0,e.apply(null,t))}function h(e){s=setTimeout(()=>{s=null,t(f,c())},e)}function d(){i&&clearTimeout(i)}function f(t,...e){if(u)return void d();if(t)return d(),void l.call(null,t,...e);if(c()||o)return d(),void l.call(null,t,...e);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),h(n)}let p=!1;function g(t){p||(p=!0,d(),u||(null!==s?(t||(a=2),clearTimeout(s),h(0)):t||(a=1)))}return h(0),i=setTimeout(()=>{o=!0,g(!0)},n),g}(t,e,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Mh{constructor(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}function Lh(t,e,n,r,s,i,o=!0,a=!1){const c=function(t){const e=encodeURIComponent;let n="?";for(const r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n=n.slice(0,-1),n}(t.urlParams),u=t.url+c,l=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(l,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(l,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(l,i),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(l,r),new xh(u,t.method,l,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o,a)}class Ph{constructor(t,e){this._service=t,this._location=e instanceof Nh?e:Nh.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new Ph(t,e)}get root(){const t=new Nh(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(t){const e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}(this._location.path)}get storage(){return this._service}get parent(){const t=function(t){if(0===t.length)return null;const e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===t)return null;const e=new Nh(this._location.bucket,t);return new Ph(this._service,e)}_throwIfRoot(t){if(""===this._location.path)throw function(t){return new Eh(Th.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)}}function Vh(t,e){const n=null==e?void 0:e.storageBucket;return null==n?null:Nh.makeFromBucketSpec(n,t)}class Fh{constructor(t,e,n,r,s,i=!1){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._url=r,this._firebaseVersion=s,this._isUsingEmulator=i,this._bucket=null,this._host=bh,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?Nh.makeFromBucketSpec(r,this._host):Vh(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,null!=this._url?this._bucket=Nh.makeFromBucketSpec(this._url,t):this._bucket=Vh(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){Oh("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){Oh("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const e=await t.getToken();if(null!==e)return e.accessToken}return null}async _getAppCheckToken(){if(Ut(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});if(t){return(await t.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Ph(this,t)}_makeRequest(t,e,n,r,s=!0){if(this._deleted)return new Rh(Dh());{const i=Lh(t,this._appId,n,r,e,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(i),i.getPromise().then(()=>this._requests.delete(i),()=>this._requests.delete(i)),i}}async makeRequestWithTokens(t,e){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,n,r).getPromise()}}const Uh="@firebase/storage",jh="0.14.0",Bh="storage";function qh(t=Kt(),e){const n=Ft(t=S(t),Bh).getImmediate({identifier:e}),r=c("storage");return r&&function(t,e,n,r={}){!function(t,e,n,r={}){t.host="".concat(e,":").concat(n);const s=h(e);s&&(d("https://".concat(t.host,"/b")),m("Storage",!0)),t._isUsingEmulator=!0,t._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken="string"==typeof i?i:f(i,t.app.options.projectId))}(t,e,n,r)}(n,...r),n}function zh(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new Fh(n,r,s,e,qt)}Vt(new C(Bh,zh,"PUBLIC").setMultipleInstances(!0)),Gt(Uh,jh,""),Gt(Uh,jh,"esm2020");export{qh as a,yh as b,vh as c,Xu as d,zc as e,Wu as f,Yc as g,Kc as h,zt as i,Ku as j,_h as k,wh as l,Ru as m,xu as n,Yu as o,Cu as q,Hu as s,Qu as u,ku as w};
